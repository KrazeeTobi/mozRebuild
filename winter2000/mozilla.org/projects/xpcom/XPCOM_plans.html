<HTML>
<HEAD>
<TITLE>XPCOM Plans</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT="0" MARGINWIDTH="0">

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" ALT="" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP><IMG
SRC="../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH="600" HEIGHT="58" VSPACE="0" HSPACE="0"></TD></TR></TABLE>

<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">


<TR>


<TD VALIGN="TOP" >
<TABLE BORDER="0" ><TR><TD BGCOLOR="#000000" VALIGN="TOP">
<TABLE BORDER="0" CELLSPACING="3"><TR><TD BGCOLOR="#DDDDDD" VALIGN="TOP">
<TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD NOWRAP COLSPAN=2><A HREF="../.././"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../mozorg.html"> At A Glance</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../feedback.html"> Feedback</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../get-involved.html"> Get Involved</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../community.html"> Newsgroups</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../MPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://www.mozilla.org/newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../docs/"><B> Developer Docs</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../ports/"> Ports</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../hacking/"> Hacking</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../source.html"> Get the Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../build/"> Build It</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../quality/"><B> Testing</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../binaries.html"> Download</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../bugs/"> Bugzilla</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../quality/bug-writing-guidelines.html"> Bug Writing</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../tools.html"><B> Tools</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://lxr.mozilla.org/seamonkey/"> View Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey"> Tree Status</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://cvs-mirror.mozilla.org/webtools/bonsai/cvsquery.cgi?treeid=default&amp;module=SeaMonkeyAll&amp;branch=HEAD&amp;branchtype=match&amp;dir=&amp;file=&amp;filetype=match&amp;who=&amp;whotype=match&amp;sortby=Date&amp;hours=2&amp;date=day&amp;mindate=&amp;maxdate=&amp;cvsroot=%2Fcvsroot"> New Checkins</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://bugzilla.mozilla.org/"> Submit A Bug</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../faq.html"><B> FAQ</B></A></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="http://www.mozilla.org/search.html"><B> Search</B></A></TD></TR>
</TABLE>
</TD></TR></TABLE>
</TD></TR></TABLE>
</TD>


<TD VALIGN="TOP">




	
		<link rel="StyleSheet" href="http://www.mozilla.org/projects/xpcom/Standard.css" type="text/css">
	

	
<h1>XPCOM Plans</h1>

<div class="author-note">
	<p>by <a href="http://ScottCollins.net/">Scott Collins</a><!-- /p -->
	<p>last modified 31 January 2000<!-- /p -->
</div>

<p>
	The latest public version of this document is available at
</p>
<ul>
	<li>
		&lt;<a href="http://www.mozilla.org/projects/xpcom/XPCOM_plans.html">http://www.mozilla.org/projects/xpcom/XPCOM_plans.html</a>&gt;
	</li>
</ul>
<p>
	I'll keep this document up to date as we complete old plans,
		and come up with new ones.
	Please direct all comments and contributions to
		<a href="news://news.mcom.com/netscape.public.mozilla.xpcom">news:netscape.public.mozilla.xpcom</a>
		and/or <a href="mailto:scc@netscape.com">Scott Collins &lt;scc@netscape.com&gt;</a>.
</p>

<h2>The Primary Goal: Shipping Mozilla and Communicator</h2>

<p>
	We want XPCOM to be perfect;
		but our primary goal has to be shipping a browser.
</p>

<h3>Good Enough?</h3>

<p>
	Wherever the cost, with respect to shipping a browser,
		of fixing or improving some XPCOM facility
		is greater than the cost of leaving it unchanged,
		the fix will have to wait.
	Hopefully, we'll be able to fix the things we think are most important,
		without negative impact on ongoing browser work.
	When we do, it will only be because the benefit of the fix excedes the cost.
</p>

<h2>The Secondary Goal: Improving XPCOM</h2>

<p>
	The overall plan to improve XPCOM revolves around making it
		smaller,
		simpler,
		cleaner,
		more tuned to the facilities we need,
		and more aligned with applicable standards.
	The lighter we keep XPCOM,
		the easier it will be to
		debug, port, and maintain;
		and the less the cost to the embedding application.
	To that end,
		there should be no facilities in XPCOM that aren't highly leveraged.
	Things that exist only for a single client's use must be examined and hopefully exterminated.
</p>

<p>
	A large fraction of XPCOMs facilities are aimed at C++ clients.
	We can expect embedding applications to exploit the Standard C++ Library.
	Where XPCOMs facilities overlap similar services provided by the Standard C++ Library
		we will want to transition our APIs and functionality to that of the standard.
	Eventually, clients can get the implementation from the Standard Library
		and our version can be removed.
</p>

<p>
	For those facilities not provided by the Standard Library,
		we will still want to make their APIs as compatible as reasonable with it,
		e.g., our containers should work with the standard algorithms.
</p>


<h3>The Role of XPCOM</h3>

<p>
	The XPCOM module roughly parallels the Standard C/C++ Libraries.
	It overlaps them significantly, but goes beyond them in capabilities.
	XPCOM sits above the Standard Libraries.
	It's role is to extend them with facilities tailored to
		[XP]COM development in general,
		and specifically the needs of Mozilla and Communicator.
	Like the Standard Libraries,
		XPCOM must be a fairly self-contained library,
		so as not to encumber clients with any unecessary external dependencies.
</p>


<h3>Changes to the Build Hierarchy</h3>

<p>
	There are things in XPCOM that don't belong there.
	There is likely to be code outside of XPCOM that should be in it.
	There is code above XPCOM that should be below it.
</p>

<ul>
	<li>
		<span class="editor-note">P3</span>
		I/O functionality (except for the filespec facility) probably <em>doesn't</em> belong in XPCOM;
		perhaps it should be moved to netwerk
	</li>

	<li>
		<span class="editor-note">P3</span>
		The `Twips' units routines (or perhaps all routines) in "nsUnitConversion.h" probably belong in layout.
	</li>

	<li>
		<span class="editor-note">P3</span>
		<span class="source-code">nsStringTokenizer</span> probably belongs in the parser.
	</li>

	<li>
		<span class="editor-note">5.1</span>
		3rd party code that doesn't use any services from our tree should be below XPCOM;
			particularly, code XPCOM could exploit,
		e.g.,
		<ul>
			<li>expat</li>
			<li>Berkeley db</li>
		</ul>
	</li>
</ul>


<h3>Changes to APIs, Functionality, and Implementations</h3>

<p>
	The following items are listed (very) roughly in their order of importance,
		i.e., fixing observers is the first thing I want to do.
	Completed items are rendered as <strike>strikethrough text</strike>.
</p>

<ul>
	<li>
		<strike>
			<span class="editor-note">P1</span>
			The ownership model between <span class="source-code">nsObserver</span>s and the things they observe is broken.
			References between observers and observable objects should be weak.
			[See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=18682">bug #18682</a>]
		</strike>
	</li>

	<li>
		<strike>
			<span class="editor-note">P1</span>
			The Service Manager and the Component Manager need to be unified.
			[See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=23736">bug #23736</a>]
		</strike>
	</li>

	<li>
		<span class="editor-note">P1</span>
		Various threading issues,
		e.g.,
		<ul>
			<li>Too many locks.  [See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=13009">bug #13009</a>]</li>
			<li>
				Not enough locks.
				[See bugs
					<a href="http://bugzilla.mozilla.org/show_bug.cgi?id=5795">#5795</a>,
					<a href="http://bugzilla.mozilla.org/show_bug.cgi?id=12914">#12914</a>, and
					<a href="http://bugzilla.mozilla.org/show_bug.cgi?id=12755">#12755</a>]
			</li>
		</ul>
	</li>
	
	<li>
		<strike>
			<span class="editor-note">P1</span>
			Get rid of remaining AppCores, in favor of components, and or modules.
		</strike>
		[See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=13021">bug #13021</a>]
		<span class="editor-note">
			This bug remains open as there are remnants of AppCores in the build system,
			though, according to the bug, not in the executable.
		</span>
	</li>

  <li>
		<span class="editor-note">P1</span>
		Change ProgIDs to CompanyName.ProductName.Version from &lt;component://...&gt;.
		[See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=26013">bug #26013</a>]
	</li>

  <li>
		<span class="editor-note">P1</span>
		Reimplement the category manager in C++.
		It is currently written in JavaScript which makes JavaScript a dependency for XPCOM.
		[See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=26011">bug #26011</a>]
	</li>

	<li>
		<span class="editor-note">P1</span>
		We would like to move to a scheme where no one writes <span class="source-code">QueryInterface</span>,
			and we save code-space with a table driven implementation.
		A first step is moving all QI implementations to the table-like macros already in place
			(and some slight modifications to those macros).
		[See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=23737">bug #23737</a>]
		<span class="editor-note">
			Work is progressing on this.
			See in particular, the new <span class="source-code">NS_INTERFACE_MAP_...</span> macros in
			  <a href="http://lxr.mozilla.org/seamonkey/source/xpcom/base/nsISupportsUtils.h">"nsISupportsUtils.h"</a>.
		</span>
	</li>

	<li>
		<span class="editor-note">P1</span>
		We need to use <span class="source-code">NS_GET_IID</span> instead of <span class="source-code">NS_DEFINE_IID</span>.
		[See bugs
		  <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=12181">#12181</a>, and
		  <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=25886">#25886</a>]
		<span class="editor-note">
			Work is progressing on this.
		</span>
	</li>

	<li>
		<span class="editor-note">P1.5</span>
		<span class="source-code">nsIPtr</span> is deprecated and needs to go away.
		[See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=23738">bug #23738</a>]
	</li>

	<li>
		<span class="editor-note">P2</span>
		Classes that parallel Standard Library classes should have compatible APIs, i.e., 
		<ul>
			<li>nsDeque [See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=18505">bug #18505</a>]</li>
			<li>nsString</li>
			<li>nsAVLTree</li>
			<li>nsHashtable</li>
			<li>our various array classes</li>
		</ul>
		In some cases, this might initially be provided by additional interfaces.
		In all cases, we want to transition the primary APIs toward the standard.
	</li>

	<li>
		<span class="editor-note">P2</span>
		Our various enumerator classes should be made compatible with the enumerators from
			the Standard C++ Library,
			so that we can apply the standard algorithms to our containers.
		This is probably best done with a C++ wrapper around an [XP]COM enumerator.
	</li>

	<li>
		<span class="editor-note">P2</span>
		Do we still require our own version of QuickSort?
		And if so, can we narrow it to only those platforms that need it?
	</li>

	<li>
		<strike>
			<span class="editor-note">P2</span>
			<span class="source-code">QueryInterface</span> must not be used as a factory.
			[See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=16543">bug #16543</a>]
		</strike>
	</li>

	<li>
		<span class="editor-note">P3</span>
		We need to check for aggregation in <span class="source-code">CreateInstance()</span>.
		[See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=16763">bug #16763</a>]
	</li>

	<li>
		<span class="editor-note">P3</span>
		Improve the performance of the registry.
		Explore the idea of using a separate registry.
	</li>

	<li>
		<span class="editor-note">P3</span>
		Fix misspelled class names.
		[See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=16951">bug #16951</a>]
	</li>

	<li>
		<span class="editor-note">P3</span>
		Convert remaining interfaces to IDL.
		[See <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=17705">bug #17705</a>]
	</li>

	<li>
		<span class="editor-note">5.1</span>
		If the build hierarchy were fixed,
			the Registry could exploit expat and dbm.
		It could avoid implementing its own file format and io;
			and in many cases, possibly avoid calling into components for registration.
		In any case, the process of registration can, I think, be simplified.
	</li>

	<li>
		<span class="editor-note">5.1</span>
		Should we provide type-safe templatized containers, e.g., over <span class="source-code">nsISupportsArray</span>?
	</li>

	<li>
		<span class="editor-note">5.1</span>
		We want to provide some mechanism for user-specific components in a multi-user environment.
	</li>

	<li>
		<span class="editor-note">5.1</span>
		Fix the shutdown issues that complicate life for embedding applications.
	</li>
</ul>

<h3>Things we need to Evangelize</h3>

<p>
	We need to keep up-to-date documentation, samples, and have brown-bags to keep people informed.
	We've been doing this, but it should be in the plan.
</p>

<ul>
	<li>
		General [XP]COM guidelines.
		[See, e.g.,
			<a href="http://lxr.mozilla.org/mozilla/source/xpcom/doc/xpcom-code-faq.html">XPCOM Code FAQ</a>,
			<a href="http://www.mozilla.org/scriptable/xpidl/idl-authors-guide/index.html">IDL Author's Guide</a>, and
			<a href="http://www.mozilla.org/projects/xpcom/QI.html">A Reference Implementation of <span class="source-code">QueryInterface</span></a>]
	</li>

	<li>
		Writing and using components and modules.
	</li>

	<li>
		Building ownership models that work [see <a href="http://www.mozilla.org/projects/xpcom/Ownership.html">Some COM Ownership Guidelines</a>], using
			raw pointers,
			<span class="source-code">nsCOMPtr</span> [see <a href="http://www.mozilla.org/projects/xpcom/nsCOMPtr.html">The <span class="source-code">nsCOMPtr</span> User's Manual</a>],
			<span class="source-code">nsIWeakReference</span> [see <a href="http://www.mozilla.org/projects/xpcom/weak_references.html"><span class="source-code">nsIWeakReference</span></a>],
			<span class="source-code">nsCWeakReference</span>,
			and (across threads) proxies [see <a href="http://www.mozilla.org/projects/xpcom/Proxies.html"><span class="source-code">nsISupports</span> Proxies</a>].
	</li>
</ul>


<div class="author-note">
	<hr>
	Copyright&copy; 1999, 2000 by the Mozilla organization; use is subject to the <a href="http://www.mozilla.org/NPL/">NPL</a>.
</div>
	



</TD>

</TR>
<TR>

<TD COLSPAN="2" ALIGN="RIGHT" VALIGN="TOP">
<FONT SIZE="-1">
Copyright &copy; 1998-2000 The Mozilla Organization.
<BR>
<A HREF="http://www.mozilla.org/webtools/bonsai/cvslog.cgi?file=mozilla-org/html/projects/xpcom/XPCOM_plans.html&amp;rev=&amp;root=/cvsroot/">Last modified February  1,  2000</A>.
</FONT>
</TD>
</TR>

</TABLE>
</BODY>
</HTML>
