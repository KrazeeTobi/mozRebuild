<HTML>
<!--This file created 11/16/99 7:29 PM by Claris Home Page version 3.0 30 Day Trial-->
<HEAD>
   <TITLE>The Tree Widget</TITLE>
   <META NAME=GENERATOR CONTENT="Claris Home Page 3.0 30 Day Trial">
   <X-CLARIS-WINDOW TOP=42 BOTTOM=757 LEFT=4 RIGHT=534>
   <X-CLARIS-TAGVIEW MODE=minimal>
</HEAD>
<BODY>
<P><TABLE CELLSPACING=0 WIDTH="100%">
   <TR>
      <TD BGCOLOR="#6699FF">
         <P><FONT SIZE="+1" FACE="Century Gothic" COLOR="#FFFFFF">The
         Tree Widget</FONT></P>
      </TD>
   </TR>
   <TR>
      <TD>
         <P>&#91;<A HREF="index.html">Table of Contents</A>&#93;
         &#91;<A HREF="buttons.html">Previous: Titled
         Buttons</A>&#93; &#91;<A HREF="tabs.html">Next: Tab
         Widget</A>&#93;</P>
         
         <P><B>Feature Owner:</B> <A HREF="mailto:hyatt@netscape.com">David
         Hyatt</A><BR>
         </P>
         
         <P><B>Change History:</B></P>
         
         <UL>
            <LI>11/16/99 - added section on drag and drop</LI>
            
            <LI>8/22/99 - Added info about the new selection APIs,
            and updated the treeallowevents info. onchange was turned
            into onselect.</LI>
         </UL>
         
         <P>The tree widget provides the ability to display multiple
         items in a tabular format. Each item is represented as a row
         in the table. Each row may consist of multiple <I>cells</I>.
         A tree widget has all the same components as an HTML table,
         and any users of this widget should be thoroughly familiar
         with the capabilites of <A HREF="http://www.w3.org/TR/REC-html40/struct/tables.html">
         HTML tables</A>. Trees can also respond to all of the same
         CSS properties as HTML tables, as documented in the
         <A HREF="http://www.w3.org/TR/REC-CSS2/tables.html">CSS2
         spec on tables</A>.</P>
         
         <P>The following tags are roughly analogous to their HTML
         table counterparts.</P>
         
         <P><TABLE BGCOLOR="#D0D0D0" WIDTH="80%" align=center>
            <TR>
               <TD BGCOLOR="#6699FF">
                  <P><FONT COLOR="#FFFFFF">Table</FONT></P>
               </TD>
               <TD BGCOLOR="#6699FF">
                  <P><FONT COLOR="#FFFFFF">Tree</FONT></P>
               </TD>
            </TR>
            <TR>
               <TD>
                  <P><TT>table</TT></P>
               </TD>
               <TD>
                  <P><TT>tree</TT></P>
               </TD>
            </TR>
            <TR>
               <TD>
                  <P><TT>caption</TT></P>
               </TD>
               <TD>
                  <P><TT>treecaption</TT></P>
               </TD>
            </TR>
            <TR>
               <TD>
                  <P><TT>colgroup</TT></P>
               </TD>
               <TD>
                  <P><TT>treecolgroup</TT></P>
               </TD>
            </TR>
            <TR>
               <TD>
                  <P><TT>col</TT></P>
               </TD>
               <TD>
                  <P><TT>treecol</TT></P>
               </TD>
            </TR>
            <TR>
               <TD>
                  <P><TT>thead</TT></P>
               </TD>
               <TD>
                  <P><TT>treehead</TT></P>
               </TD>
            </TR>
            <TR>
               <TD>
                  <P><TT>tbody</TT></P>
               </TD>
               <TD>
                  <P><TT>treechildren, treeitem</TT></P>
               </TD>
            </TR>
            <TR>
               <TD>
                  <P><TT>tfoot</TT></P>
               </TD>
               <TD>
                  <P><TT>treefoot</TT></P>
               </TD>
            </TR>
            <TR>
               <TD>
                  <P><TT>tr</TT></P>
               </TD>
               <TD>
                  <P><TT>treerow</TT></P>
               </TD>
            </TR>
            <TR>
               <TD>
                  <P><TT>td</TT></P>
               </TD>
               <TD>
                  <P><TT>treecell</TT></P>
               </TD>
            </TR>
         </TABLE>
         </P>
         
         <P>To insert a tree widget into a document, use the
         <FONT COLOR="#008000">tree</FONT> tag. This tag is analogous
         to the <FONT COLOR="#008000">table</FONT> tag in HTML.</P>
         
         <P>The tree widget can contain a caption, which can be
         specified using the <FONT COLOR="#008000">treecaption</FONT>
         tag.</P>
         
         <P>The tree's column information can be specified using the
         <FONT COLOR="#008000">treecolgroup</FONT> and
         <FONT COLOR="#008000">treecol</FONT> tags; these tags
         respond to all the same properties that the HTML
         <FONT COLOR="#008000">col</FONT> tags do. These column tags
         can be used to specify column widths and to apply styles to
         individual columns in the tree view. Tree column tags can
         respond to an additional CSS property,
         <FONT COLOR="#800080">column-layout</FONT>, which indicates
         whether or not this column's size is alterable using the
         tree's column resizing capabilities. It has values of fixed
         and flexible, with the default being flexible.
         <FONT COLOR="#FF0000">&#91;This is not yet
         implemented.&#93;</FONT></P>
         
         <P>A tree can contain headers, bodies, and footers, just as
         a table does. <FONT COLOR="#FF0000">&#91;Not yet
         implemented, but coming online soon, so pay
         attention.&#93;</FONT> A tree widget's body, unlike a
         table's body will constrain itself when the height of the
         table is constrained.</P>
         
         <P>The <FONT COLOR="#008000">treeitem</FONT> tag is used to
         declare a single item (along with that item's row and
         children) in the tree. The tree item contains one or more
         rows, which are specified using the
         <FONT COLOR="#FF0000">treerow</FONT> tag. Each row consists
         of one or more cells, which are specified using the
         <FONT COLOR="#008000">treecell</FONT> tag.</P>
         
         <P><TABLE BORDER=1 BGCOLOR="#D0D0D0" WIDTH="80%" align=center>
            <TR>
               <TD>
                  <PRE>
&lt;tree&gt;
  &lt;treehead&gt;
    &lt;treerow&gt;
      &lt;treecell&gt;Name&lt;/treecell&gt;
      &lt;treecell&gt;URL&lt;/treecell&gt;
    &lt;/treerow&gt;
  &lt;/treehead&gt;
  &lt;treechildren&gt;
    &lt;treeitem&gt;
	  &lt;treerow&gt;
        &lt;treecell&gt;Netscape Home Page&lt;/treecell&gt;
        &lt;treecell&gt;http://www.netscape.com&lt;/treecell&gt;
      &lt;/treerow&gt;
	&lt;/treeitem&gt;
  &lt;/treechildren&gt;
&lt;/tree&gt;
                  </PRE>
               </TD>
            </TR>
         </TABLE>
         </P>
         
         <P>Tree items are either open or closed, and their state is
         specified using the <FONT COLOR="#FF0000">open</FONT>
         attribute. This attribute, when set to true, indicates that
         the tree item's children should be displayed in the tree. If
         it is set to false, or if it isn't set at all, then the tree
         item's children are not displayed.</P>
         
         <P>A tree item's children are specified using the
         <FONT COLOR="#008000">treechildren</FONT> tag, which is
         placed within the parent
         <FONT COLOR="#008000">treeitem</FONT> tag. The
         <FONT COLOR="#008000">treechildren</FONT> tag contains tree
         items that represent the children of the parent node.</P>
         
         <P><TABLE BORDER=1 BGCOLOR="#D0D0D0" WIDTH="80%" align=center>
            <TR>
               <TD>
                  <PRE>
&lt;tree&gt;
  &lt;treehead&gt;
    &lt;treerow&gt;
      &lt;treecell&gt;Name&lt;/treecell&gt;
      &lt;treecell&gt;URL&lt;/treecell&gt;
    &lt;/treeitem&gt;
  &lt;/treerow&gt;
  &lt;treechildren&gt;
    &lt;treeitem&gt;
	  &lt;treerow&gt;
        &lt;treecell&gt;Netscape Bookmarks Folder&lt;/treecell&gt;
        &lt;treecell/&gt;
      &lt;/treerow&gt;
      &lt;treechildren&gt;
        &lt;treeitem&gt;
		  &lt;treerow&gt;
	        &lt;treecell&gt;Netscape Home Page&lt;/treecell&gt;
	        &lt;treecell&gt;http://www.netscape.com&lt;/treecell&gt;
		  &lt;/treerow&gt;
        &lt;/treeitem&gt;
      &lt;/treechildren&gt;
    &lt;/treeitem&gt;
  &lt;/treechildren&gt;
&lt;/tree&gt;
                  </PRE>
               </TD>
            </TR>
         </TABLE>
         </P>
         
         <P>The tree automatically handles selection, and it is
         capable of supporting single and multiple selection (through
         the use of CTRL/command and SHIFT modifier keys). The tree's
         selection is reflected into the content model. Tree items
         that are selected have an attribute called
         <FONT COLOR="#FF0000">selected</FONT> set to true. Tree rows
         that are selected have an attribute called
         <FONT COLOR="#FF0000">selectedrow</FONT> set. Tree cells
         that are selected have an attribute called
         <FONT COLOR="#FF0000">selectedcell</FONT> that is set to
         true. CSS can be applied using attribute selector rules,
         thus enabling the tree designer to control the look of the
         tree's selection.</P>
         
         <P>A <FONT COLOR="#0000FF">select</FONT> handler can be
         attached to the tree, and this handler will be invoked
         whenever the tree's selection changes. You can either add it
         as an attribute (e.g.,
         <FONT COLOR="#FF0000">onselect</FONT>) on the
         <FONT COLOR="#008000">tree</FONT> tag or add it using the
         DOM <FONT COLOR="#0000FF">addEventListener</FONT>
         method.</P>
         
         <P>The tree widget also supports hover feedback on items and
         cells. This hover feedback is also reflected into the
         content model. Tree items that are currently moused over
         have an attribute called <FONT COLOR="#FF0000">hover</FONT>
         set to true. Tree cells that are being moused over have an
         attribute called <FONT COLOR="#FF0000">hover</FONT> set to
         true. Tree rows also use <FONT COLOR="#FF0000">hover</FONT>.
         CSS can be applied using attribute selector rules, which
         enable control of the hover feedback effects for the tree.
         <FONT COLOR="#FF0000">&#91;This will probably change to use
         the :hover mechanism at some point, assuming some sort of
         bubbling mechanism for hover is determined.&#93;</FONT></P>
         
         <P>Because the tree handles selection, events that would
         normally go to the content inside the cell are intercepted
         by the cell. This behavior can be turned off on a cell by
         cell basis by setting the
         <FONT COLOR="#FF0000">treeallowevents</FONT> attribute on
         the cell. This attribute, when set to true, indicates that
         the cell is unselectable, and that the content inside should
         receive events (like mouse clicks and keystrokes).</P>
         
         <P>To selectively allow events to go to cell content (e.g.,
         a button inside a cell), the
         <FONT COLOR="#FF0000">treeallowevents</FONT> attribute can
         be placed on a node that is a descendant of the cell.</P>
         
         <P>The tree widget supports a selection API that can be used
         to modify its current selection. This API is outlined
         below.</P>
         
         <P><TABLE BORDER=1 BGCOLOR="#D0D0D0" WIDTH="80%" align=center>
            <TR>
               <TD>
                  <PRE>
interface XULTreeElement : XULElement {
  readonly attribute NodeList selectedItems;
  readonly attribute NodeList selectedCells;
                  
  void selectItem(in XULElement treeItem);
  void selectCell(in XULElement treeCell);
                  
  void clearItemSelection();
  void clearCellSelection();
                  
  void addItemToSelection(in XULElement treeItem);
  void removeItemFromSelection(in XULElement treeItem);
                  
  void addCellToSelection(in XULElement treeCell);
  void removeCellFromSelection(in XULElement treeCell);
                  
  void toggleItemSelection(in XULElement treeItem);
  void toggleCellSelection(in XULElement treeCell);
                  
  void selectItemRange(in XULElement startItem, in XULElement endItem);
  void selectCellRange(in XULElement startItem, in XULElement endItem);
                  
  void selectAll();
  void invertSelection();
};
                  </PRE>
               </TD>
            </TR>
         </TABLE>
         </P>
         
         <P>Content in a tree cell can be automatically indented
         based on the node's level in the tree by using the
         <FONT COLOR="#FF0000">treeindentation</FONT> tag. The
         indentation tag can have a
         <FONT COLOR="#800080">width</FONT> property applied to it
         using CSS, and this property is multiplied by the node's
         level of indentation to determine how much padding to
         insert. The default if no property is specified is 16 pixels
         per level. <FONT COLOR="#FF0000">&#91;Style support for
         treeindentation is not yet implemented.&#93;</FONT></P>
         
         <P><B>Answers to Common Questions</B></P>
         
         <P><B>How do I give column headers a visually distinct
         look?</B><BR>
         You can make a CSS rule like the following to apply a look
         only to cells inside the head of the table.</P>
         
         <P><FONT COLOR="#800080">treehead &gt; treerow &gt; treecell
         { ... }</FONT></P>
         
         <P><B>Can I set the widths of my columns using
         percentages?</B><BR>
         </P>
         
         <P>Yes. Click <A HREF="http://www.w3.org/TR/REC-html40/struct/tables.html#h-11.2.4.4">here</A>
         for details.</P>
         
         <P><B>I don't want the text in my tree cells to wrap. What
         do I do?</B><BR>
         </P>
         
         <P>Set the <FONT COLOR="#800080">whitespace</FONT> property
         on your tree cells in CSS to a value of nowrap. Then
         constrain the width of your tree (e.g., give your tree a
         width of 100%). Once you have done this, the contents of the
         cells will be clipped.</P>
         
         <P><B>I would like the text in my tree cells to be cropped
         in addition to being clipped. What do I do?</B><BR>
         </P>
         
         <P><FONT COLOR="#FF0000">&#91;Not yet
         implemented.&#93;</FONT> You will be able to specify this
         through CSS. If the <FONT COLOR="#800080">nowrap</FONT>
         property is set and an additional <FONT COLOR="#800080">
         cropstyle</FONT> property is set (whose value can be left,
         middle, or right), then the text in the cell can be made to
         crop.</P>
         
         <P>A temporary workaround to get this feature working would
         be to use titled buttons to hold the text. (See <A HREF="buttons.html">Titled
         Buttons</A> for details.) Titled buttons already know how to
         crop right by default when their widths are constrained.</P>
         
         <P><B>I want to use the same event handler for all items in
         my tree, but I don't want to define these handlers over and
         over on each node. What do I do?</B></P>
         
         <P>Take advantage of the DOM's event handling capabilities.
         You can allow events to bubble up to your
         <FONT COLOR="#008000">tree</FONT> node, and handle the
         events there. The target of an event that bubbles up can be
         retrieved using <FONT COLOR="#800080">evt.target</FONT>.</P>
         
         <P>When using bubbling on a tree view, it is important to
         remember that the events will bubble from child node to
         parent node. Don't think of it like a table, where the
         events will always go from cell to row to body. If a node is
         11 levels deep, then the event will bubble out through the
         node's parents before getting to the tree body. Be aware of
         this distinction when writing event-handling code.</P>
         
         <P><B>How do I make the tree's body scroll independently of
         the header/footer?</B><BR>
         Constrain the height of the tree and this overflow will
         happen automatically when there are too many items to fit in
         the displayable area. Boxes can be used to make the tree
         springy (and to make the tree be sized to the width and
         height of a window).</P>
         
         <P><B>How do I make clickable graphical cell contents like
         in Messenger (flags, checks, etc.)?</B><BR>
         </P>
         
         <P>Use <A HREF="buttons.html">Titled Buttons</A>. In the
         click handler for the button, set an attribute on the button
         to cycle through the various states. Use attribute selector
         rules for each possible attribute value to set up different
         images for each state of the button. If desired, the
         button's border can even be hidden using CSS.</P>
         
         <P><B>How do I hide columns?</B><BR>
         </P>
         
         <P>You can read about this capability <A HREF="http://www.w3.org/TR/REC-CSS2/tables.html#q4">here</A>.</P>
         
         <P><B>I want to do </B><FONT COLOR="#800080"><B>insert my
         feature here</B></FONT><B> with the tree, but I don't know
         where to start!</B><BR>
         It is important to remember that a tree is an extended
         table, and therefore many of its capabilities are inherited
         from tables. Make sure you read the CSS2 and HTML specs on
         tables (links are at the top of this page) to see if your
         question is answered there.</P>
         
         <H2><A NAME=DD></A>Tree Drag &amp; Drop</H2>
         
         <P>The main thing to remember during a tree drag is that the
         event <FONT COLOR="#CC0000">target</FONT> will be a tree
         cell, but all of the information about the drag is done at
         the tree item level. This requires going up two levels in
         the content tree from the target.</P>
         
         <H3>Tracking During The Drag</H3>
         
         <P>The tree item makes use of a DOM event capturer to
         annotate the item's content node with information about
         where the drag will go in order to draw the correct drop
         feedback.</P>
         
         <P>The tree needs a little help from the
         <FONT COLOR="#CC0000">ondragover</FONT> event handler to
         trigger the drop feedback magic. The capturer always
         annotates the tree item with various attributes, but it
         might not be valid to drop on the tree based on the contents
         of the drag. When the event handler determines that a drag
         is valid, it needs to touch the
         <FONT COLOR="#CC0000">dd-triggerrepaint</FONT> attribute on
         the tree item which triggers a repaint with the correct drop
         feedback. By not touching this attribute, the item will not
         redraw and this prevents the feedback from appearing. If you
         don't want drop feedback at all, this is how you'd
         accomplish it.</P>
         
         <H3><TABLE BORDER=1 BGCOLOR="#D0D0D0" WIDTH="80%" align=center>
            <TR>
               <TD>
                  <PRE>
                  
function DragOverTree ( event )
{
  var validFlavor = false;
  var dragSession = null;
                  
  var dragService = Components.classes&#91;"component://netscape/widget/dragservice"&#93;.getService();
  if ( dragService ) 
    dragService = dragService.QueryInterface(Components.interfaces.nsIDragService);
  if ( dragService ) {
    dragSession = dragService.getCurrentSession();
    if ( dragSession ) {
      if ( dragSession.isDataFlavorSupported("moz/toolbaritem") )
        validFlavor = true;
      else if ( dragSession.isDataFlavorSupported("text/plain") )
        validFlavor = true;
      //XXX other flavors here...
                  
      // touch the attribute on the rowgroup to trigger the repaint with the drop feedback.
      if ( validFlavor ) {
        var treeItem = event.target.parentNode.parentNode;
        treeItem.setAttribute ( "dd-triggerrepaint", 0 );
        dragSession.canDrop = true;
                  
        event.preventBubble();
      }
    }
  }
                  
} // DragOverTree</PRE>
               </TD>
            </TR>
         </TABLE>
         </H3>
         
         <H3>Determining Where To Drop</H3>
         
         <P>Instead of placing an
         <FONT COLOR="#CC0000">ondragdrop</FONT> event handler on
         every single tree item, it's easiest to place one on the
         topmost <FONT COLOR="#009900">tree</FONT> tag and use the
         <FONT COLOR="#CC0000">target</FONT> of the event to find the
         actual drop location. Remember that the tree cell is the
         actual target and you need to go up two levels to get the to
         correct tree item.</P>
         
         <P>The event capturer sets two attributes on the target tree
         item during the drag tracking which are useful when the user
         finally releases the mouse over the tree. The first is
         <FONT COLOR="#CC0000">dd-droplocation</FONT> which a boolean
         which when true indicates that the drop should go
         <B>before</B> this tree item. If it is false, the drop
         should go <B>after</B>. The second attribute,
         <FONT COLOR="#CC0000">dd-dropon</FONT>, tells if the drop
         should go <B>on (or into)</B> a container on the tree. When
         this is true, <FONT COLOR="#CC0000">dd-droplocation</FONT>
         is undefined.</P>
         
         <P>The tree item determines if something is a container by
         checking the <FONT COLOR="#CC0000">container</FONT>
         attribute of the content node.</P>
         
         <P>Here's a simple example which demonstrates how to get the
         before/after/on information for a handler registered on the
         tree as a whole.</P>
         
         <P><TABLE BORDER=1 BGCOLOR="#D0D0D0" WIDTH="80%" align=center>
            <TR>
               <TD>
                  <PRE>
                  
&lt;tree  id="bookmarksTree" ref="NC:BookmarksRoot" context="contextual"
   datasources="rdf:bookmarks rdf:files rdf:ftp rdf:localsearch rdf:internetsearch"
   ondragdrop="return DropOnTree(event);"&gt;</PRE>
               </TD>
            </TR>
         </TABLE>
         </P>
         
         <H3><TABLE BORDER=1 BGCOLOR="#D0D0D0" WIDTH="80%" align=center>
            <TR>
               <TD>
                  <PRE>
                  
function DropOnTree ( event )
{
  // id (url) is on the &lt;treeitem&gt; which is two levels above the &lt;treecell&gt; which is
  // the target of the event.
  var treeItem = event.target.parentNode.parentNode;
  var id = treeItem.getAttribute("id");
  var dropBefore = treeItem.getAttribute("dd-droplocation");
  var dropOn = treeItem.getAttribute("dd-dropon");
  dump("**** before is " + dropBefore + " on is " + dropOn + "\n");
  var beforeString = "before";
  if ( dropBefore == "false" )
    beforeString = "after";
  dump ( "*** tree drop " + beforeString + " target &#91;" + id + "&#93;\n" );
        
  event.preventBubble();
}
                  </PRE>
               </TD>
            </TR>
         </TABLE>
         </H3>
         
         <H3>Customizing Drop Feedback</H3>
         
         <P><FONT COLOR="#FF0000">&#91;Not yet implemented&#93;
         </FONT>The drop feedback marker bar is normally black, but
         can be customized on a particular toolbar via CSS. To do
         this, use the <FONT COLOR="#990066">:-moz-drop-marker</FONT>
         pseudoelement</P>
         
         <P>For example:</P>
         
         <P>&nbsp;<TABLE BORDER=1 BGCOLOR="#D0D0D0" WIDTH="80%" align=center>
            <TR>
               <TD>
                  <PRE>
                  
:-moz-drop-marker {
   color: blue;
}</PRE>
               </TD>
            </TR>
         </TABLE>
         </P>
         
         <P>
         
         <HR SIZE=1 solid>
         
         &#91;<A HREF="index.html">Table of Contents</A>&#93;
         &#91;<A HREF="buttons.html">Previous: Titled
         Buttons</A>&#93; &#91;<A HREF="tabs.html">Next: Tab
         Widget</A>&#93;
         
         <HR SIZE=1 solid>
         
         Contact us at <A HREF="mailto:xptoolkitstaff@netscape.com">xptoolkitstaff@netscape.com</A>.
         Want to complain about the new documentation? Email
         <A HREF="mailto:hyatt@netscape.com">Dave Hyatt</A>.</P>
         
         <P></P>
      </TD>
   </TR>
</TABLE>
</P>
</BODY>
</HTML>
