<HTML>
<HEAD>
<TITLE>Collation</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT="0" MARGINWIDTH="0">

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" ALT="" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP><IMG
SRC="../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH="600" HEIGHT="58" VSPACE="0" HSPACE="0"></TD></TR></TABLE>

<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">


<TR>


<TD VALIGN="TOP" >
<TABLE BORDER="0" ><TR><TD BGCOLOR="#000000" VALIGN="TOP">
<TABLE BORDER="0" CELLSPACING="3"><TR><TD BGCOLOR="#DDDDDD" VALIGN="TOP">
<TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD NOWRAP COLSPAN=2><A HREF="../.././"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../mozorg.html"> At A Glance</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../feedback.html"> Feedback</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../get-involved.html"> Get Involved</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../community.html"> Newsgroups</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../MPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://www.mozilla.org/newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../docs/"><B> Developer Docs</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../ports/"> Ports</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../hacking/"> Hacking</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../source.html"> Get the Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../build/"> Build It</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../quality/"><B> Testing</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../binaries.html"> Download</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../bugs/"> Bugzilla</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../quality/bug-writing-guidelines.html"> Bug Writing</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../tools.html"><B> Tools</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://lxr.mozilla.org/seamonkey/"> View Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey"> Tree Status</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://cvs-mirror.mozilla.org/webtools/bonsai/cvsquery.cgi?treeid=default&amp;module=SeaMonkeyAll&amp;branch=HEAD&amp;branchtype=match&amp;dir=&amp;file=&amp;filetype=match&amp;who=&amp;whotype=match&amp;sortby=Date&amp;hours=2&amp;date=day&amp;mindate=&amp;maxdate=&amp;cvsroot=%2Fcvsroot"> New Checkins</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://bugzilla.mozilla.org/"> Submit A Bug</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../faq.html"><B> FAQ</B></A></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="http://www.mozilla.org/search.html"><B> Search</B></A></TD></TR>
</TABLE>
</TD></TR></TABLE>
</TD></TR></TABLE>
</TD>


<TD VALIGN="TOP">




   
   
   



<center><b><font size=+3>Collation</font></b>
<br><b>by Naoki Hotta &lt;naoki@netscape.com></b>
<br><b>Last Modified: Feb. 12, '99</b></center>

<h3>
Description</h3>
The collation functions are intended to provide a set of simple, cross-platform
functions that Mozilla and Netscape developers can use to perform locale
sensitive collations.
<br>Two types of collation functions are necessary, a comparison function
which directly compares two strings and returns a result and a sort key
generation function.
<p>The caller first need to instanciate nsICollationFactory with a locale
(<a href="locale-model.html">nsILocale</a>). The factory will create a
collation interface (nsCollation) for a specified locale.
<br>Once the collation interface is available, locale sensitive string
comparison and sort key generation are possible.
<br>Use CompareString in order to compare two strings. Sort key is useful
for performance critical operation which requires comparison of a same
string many times (e.g. sorting). In order to create a sort key, the caller
need to allocate a memory which length is taken by GetSortKeyLen then call
CreateSortKey to generate a sort key. Call CompareSortKey to compare two
sort keys. Note that only the keys generated by the same instance can be
compared.
<br>Input strings for both generic comparison and a sort key creation should
be Unicode (UCS2). Sort keys are generated as an opaque byte buffer and
the length indicates a number of bytes. Collation strength should be specified
for both string comparison and sort key creation. Currently, case sensitiveness
can be specified by the selector. Comparison result to be given as an interger
(-1, 0, 1) which is identical to strcmp.
<h3>
API</h3>
<tt>typedef enum {</tt>
<br><tt>&nbsp; kCollationStrengthDefault = 0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// use the primary comparison for the given local - no flags)</tt>
<br><tt>&nbsp; kCollationCaseInsensitiveAscii = 1, // do not consider case
differences when doing the comparison i.e. A=a)</tt>
<br><tt>&nbsp; kCollationAccentInsenstive = 2,&nbsp;&nbsp;&nbsp;&nbsp;
// do not consider accent differences when doing the comparison a=&aacute;)</tt>
<br><tt>&nbsp; kCollationCaseSensitive = kCollationStrengthDefault,</tt>
<br><tt>&nbsp; kCollationCaseInSensitive = (kCollationCaseInsensitiveAscii
| kCollationAccentInsenstive)</tt>
<br><tt>} nsCollationStrength;</tt>
<p><tt>// Create a collation interface for an input locale.</tt>
<br><tt>//</tt>
<br><tt>class nsICollationFactory : public nsISupports {</tt>
<p><tt>public:</tt>
<p><tt>&nbsp; NS_IMETHOD CreateCollation(nsILocale* locale, nsICollation**
instancePtr) = 0;</tt>
<br><tt>};</tt>
<p><tt>// Locale sensitive collation interface</tt>
<br><tt>//</tt>
<br><tt>class nsICollation : public nsISupports {</tt>
<p><tt>public:</tt>
<p><tt>&nbsp; // compare two strings</tt>
<br><tt>&nbsp; // result is same as strcmp</tt>
<br><tt>&nbsp; NS_IMETHOD CompareString(const nsCollationStrength strength,</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const nsString&amp; string1, const nsString&amp; string2, PRInt32* result)
= 0;</tt>
<p><tt>&nbsp; // get a length (of character) of a sort key to be generated
by an input string</tt>
<br><tt>&nbsp; // length is a byte length</tt>
<br><tt>&nbsp; NS_IMETHOD GetSortKeyLen(const nsCollationStrength strength,</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const nsString&amp; stringIn, PRUint32* outLen) = 0;</tt>
<p><tt>&nbsp; // create sort key from input string</tt>
<br><tt>&nbsp; // length is a byte length, caller should allocate a memory
for a key</tt>
<br><tt>&nbsp; NS_IMETHOD CreateSortKey(const nsCollationStrength strength,</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const nsString&amp; stringIn, PRUint8* key, PRUint32 *outLen) = 0;</tt>
<p><tt>&nbsp; // compare two sort keys</tt>
<br><tt>&nbsp; // length is a byte length, result is same as strcmp</tt>
<br><tt>&nbsp; NS_IMETHOD CompareSortKey(const PRUint8* key1, const PRUint32
len1,</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const PRUint8* key2, const PRUint32 len2,</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRInt32* result) = 0;</tt>
<p><tt>&nbsp; // init this interface to a specified locale (should only
be called by collation factory)</tt>
<br><tt>&nbsp; //</tt>
<br><tt>&nbsp; NS_IMETHOD Initialize(nsILocale* locale) = 0;</tt>
<br><tt>};</tt>
<br>&nbsp;
<h3>
Example</h3>
Following example compares two string in two ways (with and without sort
key). Details omitted.
<p><tt>&nbsp; // create a nsILocale by nsILocaleFactory (see the <a href="http://www.mozilla.org/projects/intl/locale-model.html">spec</a>
or mozilla/intl/locale/test/nsLocaleTest.cpp)</tt>
<p><tt>&nbsp; // create a factory</tt>
<br><tt>&nbsp; res = nsRepository::CreateInstance(kCollationFactoryCID,
NULL, kICollationFactoryIID, (void**) &amp;f);</tt>
<p><tt>&nbsp; // get a collation interface instance</tt>
<br><tt>&nbsp; res = f->CreateCollation(locale, &amp;inst);</tt>
<p><tt>&nbsp; // compare string1 and string2</tt>
<br><tt>&nbsp; res = inst->CompareString(kCollationCaseSensitive, string1,
string2, &amp;result);</tt>
<p><tt>&nbsp; // get a length of a sort key for string1</tt>
<br><tt>&nbsp; res = inst->GetSortKeyLen(kCollationCaseInSensitive, string1,
&amp;keyLength1);</tt>
<p><tt>&nbsp; // allocate a buffer for a sort key</tt>
<br><tt>&nbsp; aKey1 = (PRUint8 *) new PRUint8[keyLength1];</tt>
<p><tt>&nbsp; // create a sort key for string1</tt>
<br><tt>&nbsp; res = inst->CreateSortKey(kCollationCaseSensitive, string1,
aKey1, &amp;keyLength1);</tt>
<p><tt>&nbsp; // create a sort key for string2</tt>
<br><tt>&nbsp; ...</tt>
<p><tt>&nbsp; // compare sort keys</tt>
<br><tt>&nbsp; res = t->CompareSortKey(aKey1, keyLength1, aKey2, keyLength2,
&amp;result);</tt>
<h3>
Undecided (or unimplemented) issues</h3>

<ul>
<li>
Input string is specifed as nsStrings, this may change (to whatever appropriate
for <a href="http://www.mozilla.org/scriptable/xpidl/">XPIDL</a>).</li>
</ul>





</TD>

</TR>
<TR>

<TD COLSPAN="2" ALIGN="RIGHT" VALIGN="TOP">
<FONT SIZE="-1">
Copyright &copy; 1998-1999 The Mozilla Organization.
<BR>
<A HREF="http://www.mozilla.org/webtools/bonsai/cvslog.cgi?file=mozilla-org/html/projects/intl/collation.html&amp;rev=&amp;root=/cvsroot/">Last modified February 12,  1999</A>.
</FONT>
</TD>
</TR>

</TABLE>
</BODY>
</HTML>
