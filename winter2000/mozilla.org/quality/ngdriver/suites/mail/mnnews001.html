<HTML>
<HEAD>
<TITLE>compose: nsINntpService interface</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT="0" MARGINWIDTH="0">

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" ALT="" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP><IMG
SRC="../../../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH="600" HEIGHT="58" VSPACE="0" HSPACE="0"></TD></TR></TABLE>

<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">


<TR>


<TD VALIGN="TOP" >
<TABLE BORDER="0" ><TR><TD BGCOLOR="#000000" VALIGN="TOP">
<TABLE BORDER="0" CELLSPACING="3"><TR><TD BGCOLOR="#DDDDDD" VALIGN="TOP">
<TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../../.././"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../mozorg.html"> At A Glance</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../feedback.html"> Feedback</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../get-involved.html"> Get Involved</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../community.html"> Newsgroups</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../MPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://www.mozilla.org/newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../../../docs/"><B> Developer Docs</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../ports/"> Ports</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../hacking/"> Hacking</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../source.html"> Get the Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../build/"> Build It</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../../../quality/"><B> Testing</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../binaries.html"> Download</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../bugs/"> Bugzilla</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../../quality/bug-writing-guidelines.html"> Bug Writing</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../../../tools.html"><B> Tools</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://lxr.mozilla.org/seamonkey/"> View Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey"> Tree Status</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://cvs-mirror.mozilla.org/webtools/bonsai/cvsquery.cgi?treeid=default&amp;module=SeaMonkeyAll&amp;branch=HEAD&amp;branchtype=match&amp;dir=&amp;file=&amp;filetype=match&amp;who=&amp;whotype=match&amp;sortby=Date&amp;hours=2&amp;date=day&amp;mindate=&amp;maxdate=&amp;cvsroot=%2Fcvsroot"> New Checkins</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://bugzilla.mozilla.org/"> Submit A Bug</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../../../faq.html"><B> FAQ</B></A></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="http://www.mozilla.org/search.html"><B> Search</B></A></TD></TR>
</TABLE>
</TD></TR></TABLE>
</TD></TR></TABLE>
</TD>


<TD VALIGN="TOP">




   <!-- Descrpt: Object.property/method
     Author: suresh@netscape.com
     Revs: 09/23/99
     ToDo:	1) Implement error trapping routine
	 		2) Get default newsserver from accountmanager
			3) Implement the other testcases if possible
			4) Be able to send message with test results in JustSend()
			
   - The contents of this file are subject to the Mozilla Public
   - License Version 1.1 (the "License"); you may not use this file
   - except in compliance with the License. You may obtain a copy of
   - the License at http://www.mozilla.org/MPL/
   - 
   - Software distributed under the License is distributed on an "AS
   - IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
   - implied. See the License for the specific language governing
   - rights and limitations under the License.
   -
   - The Original Code is Mozilla Communicator client code.
   -
   - The Initial Developer of the Original Code is Netscape Communications
   - Corporation.  Portions created by Netscape are Copyright (C) 1999
   - Netscape Communications Corporation.  All Rights Reserved.
   - 
   - Contributor(s):
   - Suresh Kasinathan
   - Par Pandit
   - Gerardo Kvaternik
      -->
<SCRIPT TYPE="text/javascript" SRC="../testlib.js">
</SCRIPT>

<SCRIPT TYPE="text/javascript">
var result = true;
</SCRIPT>




<!-- NGLayer code -->

<FORM name="results" action="/ngdriver/cgi-bin/writeresults.cgi" method="post">
<SCRIPT TYPE="text/javascript">

document.write('<input name="resultsfile" type="hidden" value="' + window.opener.document.resultsform.resultsfile.value + '">');

</SCRIPT>
<input type="hidden" name="textarea">
</FORM>

<center><b><font size=+2><font color="FF0000">TEST: nsINntpService interface</font></font></center>
<br>
<hr>
<center><b><font color="#3333FF"><font size=+1>The script embedded in this html file tests the
following calls</font></font></b></center>

<p><font size=+1>instanceofnntpservice = Components.classes['component://netscape/messenger/nntpservice'].getService();</font>
<br><font size=+1>interfaceofnntpservice = instanceofcompfields.QueryInterface(Components.interfaces.nsINntpService);</font>

<center>
<p><b><font color="#3333FF"><font size=+1>Here are the results</font></font></b>
</center>

<br>
<br>
<form name="testcasesform">
<TABLE BORDER CELLPADDING=5>
<TR>
<TD><input type="button" value="ConvertNewsgroupsString()" onClick="Do_ConvertNewsgroupsString();"></TD>
<TD><input type="button" value="PostMessage()" onClick="Do_PostMessage();"></TD>
<TD ROWSPAN=7>Output Results<BR>
       <TEXTAREA NAME="textarea" ROWS=20 COLS=28>This is the text area</TEXTAREA></TD>
<TD ROWSPAN=7 ALIGN=center VALIGN=center>
       <INPUT TYPE=button VALUE="Clear Output Results" NAME="clearbutton"></TD>
</TR>
<TR>
<TD><input type="button" value="RunNewsURL()" onClick="Do_RunNewsURL();"></TD>
<TD><input type="button" value="GetNewNews()" onClick="Do_GetNewNews();"></TD>
</TR>
<TR>
<TD><input type="button" value="CancelMessages()" onClick="Do_CancelMessages();"></TD>
<TD></TD>
</TR>
</TABLE>
</form>

<input type="button" value="SendResults" onclick="JustSend();">

<SCRIPT TYPE="text/javascript">
// Needed for testcases

var instanceofnntpservice; 
var interfaceofnntpservice; 

var instanceofcompfields;
var interfaceofcompfields;

var msgComposeService = Components.classes["component://netscape/messengercompose"].getService();
msgComposeService = msgComposeService.QueryInterface(Components.interfaces.nsIMsgComposeService);
var msgCompose = null;

var msgService = Components.classes['component://netscape/messenger/services/session'].getService(Components.interfaces.nsIMsgMailSession);
var accountManager = msgService.accountManager;
var defaultAccount = accountManager.defaultAccount;
var serverType = defaultAccount.incomingServer.type;
var serverUsername = defaultAccount.incomingServer.username;
var serverHostname = defaultAccount.incomingServer.hostName; 
var serverPrettyName = defaultAccount.incomingServer.prettyName;
var serverURI = defaultAccount.incomingServer.serverURI;
dump("Server Type is " + serverType + "\n");
var identity = defaultAccount.defaultIdentity;
var identityEmail = identity.email;

var mycompose = msgComposeService.InitCompose(window, null, 0, 0, null,identity);

//onerror = "handlerText";
var sFilename = "mnnews001.html";
var tc = 0;
dump("Before testcase\n");
aTestcases = new Array();

aTestcases[tc++] = new Testcase(sFilename,
                               "nsINntpService",
                               "Pass",
                               GetTheComposeSession(),
                               "Bug report required");        //Bug #, if any

writeResults(aTestcases);

function GetTheComposeSession() {

	instanceofnntpservice = Components.classes['component://netscape/messenger/nntpservice'].getService();
	interfaceofnntpservice = instanceofnntpservice.QueryInterface(Components.interfaces.nsINntpService);

	instanceofcompfields = Components.classes['component://netscape/messengercompose/composefields'].createInstance();
	interfaceofcompfields = instanceofcompfields.QueryInterface(Components.interfaces.nsIMsgCompFields);

	document.testcasesform.textarea.value = "Inside Initialize function";
	
	Do_ConvertNewsgroupsString();
	Do_RunNewsUrl ();
	Do_GetNewNews();
	Do_CancelMessages();
	// JustSend();
		
	if (result)
    	return ( "Pass" );
	else
		return ( "Fail");
}

// ----------------------------------------------------
function JustSend()
{
mycompose.compFields.SetFrom(identityEmail);
mycompose.compFields.SetTo(identityEmail);
mycompose.compFields.SetSubject("nsNntpService Results");
mycompose.compFields.SetCharacterSet("ISO-8859-1");
mycompose.compFields.SetBody(document.testcasesform.textarea.value);
dump("Starting Send");
var msgService = Components.classes['component://netscape/messenger/services/session'].getService(Components.interfaces.nsIMsgMailSession);
var accountManager = msgService.accountManager;
var defaultAccount = accountManager.defaultAccount;
var identity = defaultAccount.defaultIdentity;
mycompose.SendMsg(0, identity, null);
dump("Default identity is " + identity.email + "\n");
dump("Finish Send");
}

// ----------------------------------------------------
// string ConvertNewsgroupsString(in string newsgroupsStr);
function Do_ConvertNewsgroupsString()
{
var str;
// Need a way to get current news server
str = "news://news.mozilla.org/netscape.test";
if (interfaceofnntpservice) {
	try {
		var constr = interfaceofnntpservice.ConvertNewsgroupsString(str);
		document.testcasesform.textarea.value = document.testcasesform.textarea.value + "\n" + "ConvertNewsgroupsString passes";
		
	}
	catch (ex) {
		document.testcasesform.textarea.value = document.testcasesform.textarea.value + "\n" + "ConvertNewsgroupsString failes";
	}
    }
}

// ----------------------------------------------------
// [noscript] nsIURI PostMessage (in nsFilePath pathToFile, in string newsgroupNames, in nsIUrlListener aUrlListener);
function Do_PostMessage()
{
// The method currently uses a C++ parameter nsFilePath. It is labeled as [no script]
document.testcasesform.textarea.value = document.testcasesform.textarea.value + "\n" + "PostMessages cannot be tested";
}

// ----------------------------------------------------
// nsIURI RunNewsUrl (in string urlString, in string newsgroupName, in nsMsgKey aKey, in nsISupports aConsumer, in nsIUrlListener aUrlListener); 
function Do_RunNewsUrl()
{
document.testcasesform.textarea.value = document.testcasesform.textarea.value + "\n" + "RunNewsURL: No testcase yet";
}

// ----------------------------------------------------
// nsIURI GetNewNews (in nsINntpIncomingServer nntpServer, in string uri, in nsIUrlListener aUrlListener);
function Do_GetNewNews()
{
document.testcasesform.textarea.value = document.testcasesform.textarea.value + "\n" + "GetNewNews: No testcase yet";
}

// ----------------------------------------------------
// nsIURI CancelMessages (in string hostname, in string newsgroupname, in nsISupportsArray messages, in nsISupports aConsumer, in nsIUrlListener aUrlListener);
function Do_CancelMessages()
{
document.testcasesform.textarea.value = document.testcasesform.textarea.value + "\n" + "CancelMessage: No testcase yet";
}

</script>




</TD>

</TR>
<TR>

<TD COLSPAN="2" ALIGN="RIGHT" VALIGN="TOP">
<FONT SIZE="-1">
Copyright &copy; 1998-2000 The Mozilla Organization.
<BR>
<A HREF="http://www.mozilla.org/webtools/bonsai/cvslog.cgi?file=mozilla-org/html/quality/ngdriver/suites/mail/mnnews001.html&amp;rev=&amp;root=/cvsroot/">Last modified September 28,  1999</A>.
</FONT>
</TD>
</TR>

</TABLE>
</BODY>
</HTML>
