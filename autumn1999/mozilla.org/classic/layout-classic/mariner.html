<HTML>
<HEAD>
<TITLE>Mariner (Or : Why you should work on the current layout engine)</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT="0" MARGINWIDTH="0">

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" ALT="" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP><IMG
SRC="../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH="600" HEIGHT="58" VSPACE="0" HSPACE="0"></TD></TR></TABLE>

<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">


<TR>


<TD VALIGN="TOP" >
<TABLE BORDER="0" ><TR><TD BGCOLOR="#000000" VALIGN="TOP">
<TABLE BORDER="0" CELLSPACING="3"><TR><TD BGCOLOR="#DDDDDD" VALIGN="TOP">
<TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD NOWRAP COLSPAN=2><A HREF="../.././"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../mozorg.html"> At A Glance</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../feedback.html"> Feedback</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../get-involved.html"> Get Involved</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../community.html"> Newsgroups</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../MPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://www.mozilla.org/newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../docs/"><B> Developer Docs</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../ports/"> Ports</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../hacking/"> Hacking</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../source.html"> Get the Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../build/"> Build It</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../quality/"><B> Testing</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../binaries.html"> Download</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../bugs/"> Bugzilla</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../quality/bug-writing-guidelines.html"> Bug Writing</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../tools.html"><B> Tools</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://lxr.mozilla.org/seamonkey/"> View Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey"> Tree Status</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://cvs-mirror.mozilla.org/webtools/bonsai/cvsquery.cgi?treeid=default&amp;module=SeaMonkeyAll&amp;branch=HEAD&amp;branchtype=match&amp;dir=&amp;file=&amp;filetype=match&amp;who=&amp;whotype=match&amp;sortby=Date&amp;hours=2&amp;date=day&amp;mindate=&amp;maxdate=&amp;cvsroot=%2Fcvsroot"> New Checkins</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://bugzilla.mozilla.org/"> Submit A Bug</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../faq.html"><B> FAQ</B></A></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="http://www.mozilla.org/search.html"><B> Search</B></A></TD></TR>
</TABLE>
</TD></TR></TABLE>
</TD></TR></TABLE>
</TD>


<TD VALIGN="TOP">






<CENTER><B><FONT SIZE=+2>Mariner</FONT></B></CENTER>

<CENTER><B>(Or: Why you should work</B></CENTER>

<CENTER><B>on the current layout engine)</B></CENTER>

<CENTER>Chris Toshok &amp; Nisheeth Ranjan</CENTER>

<CENTER>&lt;<A HREF="mailto:toshok@netscape.com,nisheeth@netscape.com">toshok@netscape.com
&amp; nisheeth@netscape.com</A>></CENTER>

<H4><HR WIDTH="100%"></H4>

<TABLE CELLSPACING=0 CELLPADDING=2 COLS=1 WIDTH="100%" BGCOLOR="#FFFFCC">
<TR >
<TD ><B>Mariner and <A HREF="../../newlayout/">NGLayout</A> : 
Why do both?</B></TD>
</TR>
</TABLE>

<P>We all believe that <A HREF="../../newlayout/">NGLayout</A> will replace the current layout sources,
sometime around the end of this year.  Until then, though, there is
much that can still be squeezed out of the existing layout engine.
NGLayout will not be ready to be included into the mozilla source by the
time we want to release 5.0, so we've got at least another major (and probably
several maintenance) releases which will use the current layout engine.

<P>Mariner is the code name for performance and stability enhancements
to the layout/layers/style sheet code. The project changes the layout
engine to make the document model persist across resizes; so, each resize
in Mozilla causes a page reflow instead of a reload from the cache.
Now that we have a persistent document model, we are <A HREF="dom.html">working on implementing
a DOM interface to it</A>.
<P>
<TABLE CELLSPACING=0 CELLPADDING=2 COLS=1 WIDTH="100%" BGCOLOR="#FFFFCC"  >
<TR >
<TD ><B>Performance enhancements</B></TD>
</TR>
</TABLE>


<P>Mariner includes a lot of performance enhancements, mainly in three
areas:
<UL>
<LI>
<B>Text layout:</B> The algorithm used to find break positions within
text was improved. Also, the break positions were stored in a break
table that gets consulted for doing text reflow.</LI>
</UL>

<UL>
<LI>
<B>Table layout:</B> In table layout, each cell gets laid out onto
a rectangle of infinite width/height in the first pass. Then, once
all the minimum and maximum widths/heights of cells have been figured out,
a second pass of table layout occurs that lays out each cell's contents
into a bounded rectangle. In 4.0, the second pass of table layout
would reparse and relayout the cell from the HTML tags contained within
the cell. In mozilla, because of Mariner's persistent document model,
the second pass iterates over the model and adjusts the position and dimensions
of the cell's content to fit in the bounded rectangle. All the malloc
overhead incurred in the first pass for creating the document model is
not incurred in the second pass. This make overall table layout much
faster.</LI>
</UL>

<UL>
<LI>
<B>Resize/Reflow:</B> Since resizes cause a page reflow rather than
a reload from the cache, they are much faster.</LI>
</UL>

<TABLE CELLSPACING=0 CELLPADDING=2 COLS=1 WIDTH="100%" BGCOLOR="#FFFFCC"  >
<TR >
<TD ><B>Stability enhancements</B></TD>
</TR>
</TABLE>


<P>Many bugs related to resizing pages that have dynamic content on them
are fixed.

<P>
<TABLE CELLSPACING=0 CELLPADDING=2 COLS=1 WIDTH="100%" BGCOLOR="#FFFFCC"  >
<TR>
<TD><B>Mariner DOM</B></TD>
</TR>
</TABLE>

<P>Our current goal is to implement enough of the W3C spec to enable content
developers to do what they want to do now.  Work is underway to make the
<a href="http://lxr.mozilla.org/mozilla/source/lib/libdom/">DOM tree</a>
the authoritative source of all style and attribute data.  This will allow
all HTML attributes to be reflected (read and hopefully write) into the
<a href="dom.html">Level 1 DOM</a>.  We'll make as many of these
meaningfully mutable as possible.  If you'd like a quick hack, you can add
appropriate mutation of your favourite element or property.  Some of this work
will probably also make style sheets much better, as a nice side-effect.

<P>
<TABLE CELLSPACING=0 CELLPADDING=2 COLS=1 WIDTH="100%" BGCOLOR="#FFFFCC"  >
<TR>
<TD><B>You can help <I>(please :)</I></B></TD>
</TR>
</TABLE>


<P>Please send mail to the addresses at the top of the page - we need people
that aren't afraid to get their hands dirty working with some (admittedly)
convoluted code. Help in multibyte text layout would be wonderful,
and anyone willing to work on the <a href="dom.html">DOM</a> would
be welcome as well.

<P>Given that there are only two of us (with a third and fourth working on
CSS and one <a href="mailto:shaver@netscape.com">lazy slacker</a> doing
DOM work for XML and HTML) there
is <I>plenty</I> of room for others to help out and make a difference in
the stability, performance, and feature set of 5.0.

<!--
<P>
<TABLE CELLSPACING=0 CELLPADDING=2 COLS=1 WIDTH="100%" BGCOLOR="#FFFFCC"  >
<TR>
<TD><B>Current list of volunteers:</B></TD>
</TR>
</TABLE>

<P>Here's some people that have expressed interest in working with us:

<P><A HREF="mailto:weitsang@cs.cornell.edu">Wei Tsang Ooi</A>
<BR><A HREF="mailto:pazandak@OBJS.com">Paul Pazandak</A>
<BR><A HREF="mailto:shaver@netscape.com">Mike Shaver</A>

<P>We'll exchange e-mail between each other and maybe start a mailing list
once we have enough volunteers.
-->





</TD>

</TR>
<TR>

<TD COLSPAN="2" ALIGN="RIGHT" VALIGN="TOP">
<FONT SIZE="-1">
Copyright &copy; 1998-1999 The Mozilla Organization.
<BR>
<A HREF="http://www.mozilla.org/webtools/bonsai/cvslog.cgi?file=mozilla-org/html/classic/layout-classic/mariner.html&amp;rev=&amp;root=/cvsroot/">Last modified October 26,  1999</A>.
</FONT>
</TD>
</TR>

</TABLE>
</BODY>
</HTML>
