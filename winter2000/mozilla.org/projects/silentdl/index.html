<HTML>
<HEAD>
<TITLE>SilentDownload in Seamonkey </TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT="0" MARGINWIDTH="0">

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" ALT="" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP><IMG
SRC="../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH="600" HEIGHT="58" VSPACE="0" HSPACE="0"></TD></TR></TABLE>

<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">


<TR>


<TD VALIGN="TOP" >
<TABLE BORDER="0" ><TR><TD BGCOLOR="#000000" VALIGN="TOP">
<TABLE BORDER="0" CELLSPACING="3"><TR><TD BGCOLOR="#DDDDDD" VALIGN="TOP">
<TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD NOWRAP COLSPAN=2><A HREF="../.././"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../mozorg.html"> At A Glance</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../feedback.html"> Feedback</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../get-involved.html"> Get Involved</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../community.html"> Newsgroups</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../MPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://www.mozilla.org/newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../docs/"><B> Developer Docs</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../ports/"> Ports</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../hacking/"> Hacking</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../source.html"> Get the Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../build/"> Build It</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../quality/"><B> Testing</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../binaries.html"> Download</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../bugs/"> Bugzilla</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../quality/bug-writing-guidelines.html"> Bug Writing</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../tools.html"><B> Tools</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://lxr.mozilla.org/seamonkey/"> View Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey"> Tree Status</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://cvs-mirror.mozilla.org/webtools/bonsai/cvsquery.cgi?treeid=default&amp;module=SeaMonkeyAll&amp;branch=HEAD&amp;branchtype=match&amp;dir=&amp;file=&amp;filetype=match&amp;who=&amp;whotype=match&amp;sortby=Date&amp;hours=2&amp;date=day&amp;mindate=&amp;maxdate=&amp;cvsroot=%2Fcvsroot"> New Checkins</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://bugzilla.mozilla.org/"> Submit A Bug</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../faq.html"><B> FAQ</B></A></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="http://www.mozilla.org/search.html"><B> Search</B></A></TD></TR>
</TABLE>
</TD></TR></TABLE>
</TD></TR></TABLE>
</TD>


<TD VALIGN="TOP">








<center><b>SilentDownload in Seamonkey</b>
<br>Created: Dec 18, 1998
<br>Last updated: Jan 13, 1999
<br>Comments to: <a href="mailto:dougt@netscape.com">Doug Turner</a> 
</center>

<p>
<br><b>Overview</b></b>

<p>SilentDownload is a background transfer method that allows files to
be downloaded to the users machine without interfering with their network
performance. SilentDownload does this by only downloading while the network
library is not busy. In this way, users can "silently download" large files
over a period of time and be notified when the file transfer is complete.

<p>SilentDownload has a JavaScript API that enables web sites to "add"
new transfers to the SilentDownload que. These SilentDownload APIs all
go through a security verification in which the caller of the API has been
digitally signed and has permission to do an SilentDownload. Once a new
transfer has been added to the queue, it can only be removed by that signer
or the end user via a user interface.

<p>SilentDownload also will accessible from XPCOM. This means that any
where in Seamonkey, you manage SilentDownload. An example of this is a
possible interface in the context menu (the one that you get when you right
click) that allows users to add items to the SilentDownload que.

<p><b>A Quick Look</b>

<p>Suppose you wanted to deliver software to an end user. The current method is
to have the end user click on a link, or trigger a SmartUpdate. Both of these 
method display a progress dialog during the download and consume as much network 
bandwidth as they can. What SilentDownload offer is an alternative and more.

<p>SilentDownload can download anything, but it is meant to download native
installers, or preferably a SmartUpdate Install. Once this is done, a JavaScript
must be written similar to this:

<center><table BORDER COLS=1 WIDTH="100%" BGCOLOR="#CCCCCC" >
<tr>
<td>
<pre>
<tt>

au = SilentDownload.find("CoolSoftware")
if (au == null)
{
  au = new SilentDownloadTask();
  au.Init("CoolSoftware",
    "http://home.foo.com/download/5.1/SilentDownload.jar",
    "http://home.foo.com/download/5.1/SilentDownload.html"); 
}

switch (au.state)
{
  case SilentDownloadTask.SDL_ERROR:
    au.Remove();
    break;
  case SilentDownloadTask.SDL_COMPLETE:
    au.Remove();
    // open the downloaded jar file, which puts up the
    // UI and does the install break;
}

</tt>
</pre>
</td>
</tr>
</table></center>

<p>As you can see the script is very straight forward (and is partly psudo-code).
The first time the user runs this script, the query for CoolSoftware will
fail. Since au is NULL, we will create a new SilentDownloadTask. Then we
will initialize it by passing in a key value, the URL to download and the
script to callback to. The key value should be a human readable string.
This value can be presented to the user in UIs. The URL to download is
self Explanatory. The script to callback, or the callback script is script
which will be called when the state of a SilentDownloadTask changes or
when SilentDownload first starts up.

<p>Periodically SilentDownload will call a javascript that you passed into
the Init() function of SilentDownloadTask. This javascript usually has
the same format as able. It will try to find the key value using the Find()
function of SilentDownload. If it fails, the script will create a new SilentDownloadTask.
Once we know that we have a good SilentDownload task, we will check its
state value. This will tell us what is going on with this object.

<p>Most of the states of SilentDownloadTask are fine if you leave them
unhanded, but two are important. The first is SDL_COMPLETE. When the state
value of a task equals this, you know that the download is complete. You
can do just about anything you want here. For example, if it is a SmartUpdate
that you are download, you can open a new window is the download. The second
state that you should worry about is SDL_ERROR. When this appears, something
went wrong with the Download that is irrecoverable. For both of these cases
you should call the Remove() function of SilentDownloadTask which will
clean up your SilentDownloadTask().

<p>Once you have written this script and your software is packaged, you
must place it on a server that support Byte Ranges. If you are unfamiliar
with what type of server you have, please check with your administer. Also,
if you plan to use SmartUpdate jar files, be sure to set the MIME type
of JAR archives on the server to application/java-archive.

<p><b>APIs</b>

<p>SilentDownloadTask
<UL>
<p>Constructor. Creates a new SilentDownloadTask. The state of this is
set to SDL_NOT_INITED. 
</UL>

<p>SilentDownloadTask.Init(ID, download_URL, callbackJavascript_URL);
<UL>
<p>The following method sets up the SilentDownload download.
All the information that is passed to this method is stored in a persistent
store. The ID is a unique human readable string callbackJavascript_URL
and the download_URL are strings. The state of the SilentDownloadTask is
set to SDL_STARTED.
</UL>

<p>SilentDownloadTask.Suspend();
<UL>
<p>The following method suspends the SilentDownloadTask.
It is the responsibility of the download script writer to resume the SilentDownload
again. The state of SilentDownload object is set to SUSPEND.
</UL>

<p>SilentDownloadTask.Resume();
<UL>
<p>The following method resumes the SilentDownloadTask
(i.e. it starts downloading the data onto users disk in background). The
state of SilentDownload object is set to SDL_STARTED whenever it is downloading.
</UL>

<p>SilentDownloadTask.Remove();
<UL>
<p>The following method cleans up the data that is downloaded
and it also removes entries from persistent store for this object. This
should be called when you are all done with the SilentDownloadTask. Once
this is called, your javascript callback will not be called again.
</UL>

<p>SilentDownloadTask.DownloadNow();
<UL>
<p>The following method downloads the data immediately
without regard for the current network activity. The state of SilentDownload
object is set to DOWNLOADING_NOW.
</UL>

<p>SilentDownloadTask.ID
<UL>
<p>A read-only string that is the key by which SilentDownloadTask
are found.
</UL>

<p>SilentDownloadTask.URL
<UL>
<p>A read-only string which is the URL being downloaded.
</UL>

<p>SilentDownloadTask.Script
<UL>
<p>A read-only string which is the JavaScript callback
for the current SilentDownloadTask.
</UL>

<p>SilentDownloadTask.State
<UL>
<p>A read-only integer that hold the state information
about this SilentDownloadTask..
</UL>

<p>SilentDownloadTask.NextByte
<UL>
<p>The next byte of the file that SilentDownload will retrieve
during the next idle period.
</UL>

<p>SilentDownloadTask.OutFile
<UL>
<p>The file location where this file will be saved on the
users machine.
</UL>

<p>SilentDownloadTask.ErrorMsg
<UL>
<p>The last human readable string message.
</UL>

<p>SilentDownload
<UL>
<p>A state class that hold management functions and data
for all SilentDownload Tasks
</UL>

<p>SilentDownload.Find(id)
<UL>
<p>Returns a SilentDownloadTask that matches the parameter
ID. If none match null is returned.
</UL>

<p>SilentDownload.Range
<UL>
<p>The byte count to download during idle time.
</UL>

<p>SilentDownload.Interval
<UL>
<p>The number of microseconds between checking to idle
time. (Should I change to seconds?)


</UL>




</TD>

</TR>
<TR>

<TD COLSPAN="2" ALIGN="RIGHT" VALIGN="TOP">
<FONT SIZE="-1">
Copyright &copy; 1998-2000 The Mozilla Organization.
<BR>
<A HREF="http://www.mozilla.org/webtools/bonsai/cvslog.cgi?file=mozilla-org/html/projects/silentdl/index.html&amp;rev=&amp;root=/cvsroot/">Last modified January 15,  1999</A>.
</FONT>
</TD>
</TR>

</TABLE>
</BODY>
</HTML>
