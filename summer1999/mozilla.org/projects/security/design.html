<HTML>
<HEAD>
<TITLE>Component Security</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT=0 MARGINWIDTH=0>

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP ROWSPAN=2><IMG
SRC="../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH=600 HEIGHT=58 VSPACE=0 HSPACE=0></TD></TR></TABLE>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">

<TR>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>



<TD BGCOLOR="#DDDDDD" VALIGN=TOP><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>


<TR>

<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP COLSPAN=2>

<TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../..//"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../mission.html"> Our Mission</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../about.html"> Who We Are</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../get-involved.html"> Getting Involved</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../community.html"> Community</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../advocacy.html"> Editorials</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../news.html"> What's New</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../development.html"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../blue-sky/"> Blue Sky</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../status/"> Status</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../tools.html"> Tools</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../products.html"><B> Products</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../source.html"> Source Code</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../binaries.html"> Binaries</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../docs/"> Documentation</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../NPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../bugs/"> Bug Reports</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../quality/"> Quality</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../search.html"><B> Search</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../feedback.html"><B> Feedback</B></A></TD></TR>
</TABLE>
</TD>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD VALIGN=TOP>




   
   
   



<h1>
Component Security for Mozilla</h1>
<script>document.write('<a href="mailto:norris'+String.fromCharCode(64)+
                       'netscape.com">Norris Boyd</a><br>');</script>
<script>
        function lastMod() {
                var d = new Date(document.lastModified);
                return (d.getMonth()+1)+"/"+d.getDate()+"/"+d.getFullYear();
        }
        document.write(lastMod() + '<br>');
</script>

<hr>
<br>&nbsp;
<blockquote>Hackers point out that it is vendors, not they, who are responsible
for the gaping holes that permeate so many products. With companies releasing
software as fast as possible, proper security often gets lost in the rush
toward store shelves. "As complexity increases, the opportunity for vulnerability
increases," says Steven Foote, a senior vice president at the Hurwitz Group,
which analyzes strategic business applications.&nbsp; -- U.S. News, <a href="http://www.usnews.com/usnews/issue/990614/14hack.htm">Can
hackers be stopped?</a></blockquote>

<p><br>Mozilla will make increasing use of Internet technologies to implement
the browser itself. This has many benefits for modularity, cross-platform
development, and encouraging development by a wider range of people. However,
it also makes the process of ensuring browser security more challenging
because the lines distinguishing the trusted browser from the untrusted
content it displays have become blurred.
<h2>
Security Model</h2>
Mozilla should support the existing security model for JavaScript in web
content (see <a href="http://developer.netscape.com/docs/manuals/communicator/jssec/index.htm">JavaScript
Security in Communicator 4.x</a>), with the possible exception of
<a href="#signedScripts">signed
scripts</a>. Any <a href="#APIs">new APIs</a> accessible from web content
using Java or JavaScript should be reviewed for security.
<p>Unlike Communicator 4.x (or Mozilla classic), Mozilla makes heavy use
of web-style programming to build the browser itself. This is accomplished
by making powerful actions available to JavaScript, and means that the
security model for Mozilla must grow to support two kinds of code: untrusted
web content and trusted browser implementation code.
<p>Eventually we will need a full capabilities system similar to what Java
has reached in Java2. However, given the need to ship quickly, we should
implement a simpler binary trust model. All code used to implement the
browser should be given full privileges, while the privileges of any code
from off the net should be limited as it was in 4.x.
<p>I'm proposing the following limitations to the capabilities of web-based
code:
<ul>
<li>
No web-based XUL</li>

<li>
No direct access to RDF</li>

<li>
Chrome only runs from the local filesystem (i.e., no downloadable chrome,
only installable chrome)</li>

<li>
Limited access to XPConnect components--most components will not be accessible
from web content, and those that are accessible must undergo security review</li>

<li>
No access of web content to the surrounding chrome</li>
</ul>
These limitations serve to make the system simpler and more secure.
<h2>
Implementation</h2>

<h3>
Distinguishing types of code</h3>
There are two types of code in our security model: web content and browser
implementation code. How do we distinquish the two? The existing JavaScript
codebase contains support for associating a principal with every script
that is evaluated. Then during execution, a stack of principals corresponding
to the stack frame of the executing JavaScript can be retrieved. Thus at
any point security critical code can check to see if it has been called
by script, and if so, whether that script was privileged or not.
<p>When web JavaScript calls native code that then calls a privileged service
that might also have been accessed directly from script, the service will
look at the JavaScript stack and then reject the request. How can the native
code, which must be trusted, make sure that the request is granted? There
should also be a simple way to push and pop an entry on the JavaScript
stack from native code, probably in the form of a C++ class whose constructor
will push an entry and whose destructor will pop it. So the code of the
intervening native method might look like:
<blockquote>nsResult nsMyClass::myMethod() {
<br>&nbsp;&nbsp;&nbsp; nsPrivilegeEnabler enabler(cx, ALL_PRIVILEGES);&nbsp;&nbsp;&nbsp;
// enable privileges
<br>&nbsp;&nbsp;&nbsp; ...
<br>&nbsp;&nbsp;&nbsp; secureService->doSomething();&nbsp;&nbsp;&nbsp;
// this call will now pass
<br>&nbsp;&nbsp;&nbsp; ...
<br>&nbsp;&nbsp;&nbsp; return success;&nbsp;&nbsp;&nbsp; // the privilege
will be popped off the stack automatically when the destructor is run
<br>}</blockquote>
In practice, this type of code shouldn't need to be written often. Most
of our security protection will come from completely limiting the visibility
from web content of services used to implement the browser. But when we
do need to have a native method that can be called from scripts but needs
to perform a privileged action, the security critical code is highlighted
by the use of the nsPrivilegeEnabler class.
<br>&nbsp;
<h2>
Component Security Analysis</h2>

<h3>
DOM</h3>
The DOM should implement the security model from 4.x (at least the unsigned
part). Historically the DOM has been the area with the most public exploits,
so security implementation here will need careful review.
<p>There are several proposals for additions to the 4.x DOM security model.
Researchers from Bell Labs have proposed several new features, most notably
domain-specific policies. There's a similar proposal described and elaborated
in <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=858">Bugzilla bug
858</a>.
<h3>
XUL</h3>
Since XUL is used to implement chrome, it needs access to highly privileged
services. All code in chrome should be trusted, which means that installing
code into chrome is a privileged action. Note that skins don't contain
any code and should be safe to install without any heavy safeguards.
<p>XUL code can interact with web content. However, we must ensure that
web content cannot interact with privileged XUL code. The web content must
live in a sandbox that cannot be breached through prototype chains or by
the JavaScript "caller" property.
<h3>
RDF</h3>
Through the sidebar, RDF content can be retrieved directly from untrusted
servers and aggregated with other RDF content. We'll need a filter for
RDF that can remove potentially dangerous pieces like JavaScript event
handlers and link cancellation.
<p>Many RDF data sources reflect security assets. Most obvious is the filesystem,
but others like the chrome registry have security implications as well.
We should prohibit direct access to RDF from untrusted code.
<h3>
XPConnect</h3>
XPConnect allows JavaScript (and soon Java) to get access to native XPCOM
components that can perform privileged actions. John Bandhauer has implemented
support for restricting which components are visible through XPConnect.
Scripts running from web content should be limited to a small set of components,
each of which is reviewed for security.
<h3>
Sidebar</h3>
As mentioned earlier, the sidebar can retrieve RDF from untrusted servers
and aggregate it when using third party panes and site maps.
<h3>
Netlib and Necko</h3>
Currently protocols like "chrome:" and "resource:" are implemented by pluggable
protocol handlers. Any untrusted code will need to have limits on which
protocols it can access. Historically, this has been a source of many exploits
through protocols like "about:" and "javascript:".
<br>&nbsp;
<h2>
<a NAME="APIs"></a>APIs for Review</h2>

<h3>
New DOM APIs</h3>
Not sure what's here.... joki will help.
<h3>
Chrome registry API</h3>
This is an API that allows web pages to request adding XUL files to chrome.
<h3>
Third party panels API</h3>
This API allows third party web sites to add panels to the sidebar.
<br>&nbsp;
<h2>
<a NAME="signedScripts"></a>Signed Code</h2>

<h3>
Need for signed code</h3>
There's currently no one owning the CAPS code, which is needed to implement
signed scripts and applets. The CAPS code needs connections to the Cartman
security library as well as to Gecko and JavaScript.
<p>Until we have some way to complete implementation of signed code the
following needs will be unmet:
<ul>
<li>
Synchronizing the user's address book with Netcenter</li>

<li>
Tweaking users' preferences for Webmail (IMAP, etc.)</li>

<li>
Satisfying enterprise and government customers make use of this feature.
DOJ would like to restrict running JavaScript to only content that has
been signed.</li>
</ul>





</TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>


<TR>


<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=BOTTOM COLSPAN=2><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>
</TR>

<TR BGCOLOR="#000000">

<TD BGCOLOR="#000000" COLSPAN=5><BR></TD>

<TD BGCOLOR="#000000" VALIGN=TOP>

<FONT COLOR="#AAAAAA" SIZE="-1">
Copyright &copy; 1998-1999 The Mozilla Organization.
</FONT>

</TD>

<TD BGCOLOR="#000000" COLSPAN=2><BR></TD>
</TR>

</TABLE>
</BODY>
</HTML>
