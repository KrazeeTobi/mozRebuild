<HTML>
<HEAD>
<TITLE>ColorSync in Mozilla</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT="0" MARGINWIDTH="0">

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" ALT="" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP><IMG
SRC="../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH="600" HEIGHT="58" VSPACE="0" HSPACE="0"></TD></TR></TABLE>

<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">


<TR>


<TD VALIGN="TOP" >
<TABLE BORDER="0" ><TR><TD BGCOLOR="#000000" VALIGN="TOP">
<TABLE BORDER="0" CELLSPACING="3"><TR><TD BGCOLOR="#DDDDDD" VALIGN="TOP">
<TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD NOWRAP COLSPAN=2><A HREF="../.././"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../mozorg.html"> At A Glance</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../feedback.html"> Feedback</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../get-involved.html"> Get Involved</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../community.html"> Newsgroups</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../MPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://www.mozilla.org/newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../docs/"><B> Developer Docs</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../ports/"> Ports</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../hacking/"> Hacking</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../source.html"> Get the Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../build/"> Build It</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../quality/"><B> Testing</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../binaries.html"> Download</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../bugs/"> Bugzilla</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../quality/bug-writing-guidelines.html"> Bug Writing</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../tools.html"><B> Tools</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://lxr.mozilla.org/seamonkey/"> View Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey"> Tree Status</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://cvs-mirror.mozilla.org/webtools/bonsai/cvsquery.cgi?treeid=default&amp;module=SeaMonkeyAll&amp;branch=HEAD&amp;branchtype=match&amp;dir=&amp;file=&amp;filetype=match&amp;who=&amp;whotype=match&amp;sortby=Date&amp;hours=2&amp;date=day&amp;mindate=&amp;maxdate=&amp;cvsroot=%2Fcvsroot"> New Checkins</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://bugzilla.mozilla.org/"> Submit A Bug</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../faq.html"><B> FAQ</B></A></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="http://www.mozilla.org/search.html"><B> Search</B></A></TD></TR>
</TABLE>
</TD></TR></TABLE>
</TD></TR></TABLE>
</TD>


<TD VALIGN="TOP">



  



<BLOCKQUOTE>
  <P>&nbsp;</P>
  <P><B><BR>
  <FONT SIZE=+3>ColorSync in Mozilla<BR>
  </FONT><FONT SIZE=+1>A Project to build Cross-Platform Color Management
  into the Mozilla Browser<BR>
  </FONT></B></P>
  <P><BR>
  As web publishing and commerce continue to rise in importance, a way of
  managing colors from the source to the destination becomes an essential
  feature of a browser. Specifically, the source image that is kept on a
  web server will look different on various displays that access it as part
  of the html stream, unless something is done to compensate for the various
  viewing conditions. ColorSync is an Apple Computer technology that is widely
  adopted in the print and graphic arts industries, and it is designed to
  perform the necessary tasks of compensation for different devices. The
  combination of a browser and ColorSync means that not only can people visit
  sites such as art archives and see what the artist intended, they can order
  products from online catalogues and not be surprised with the color when
  it arrives in the mail.</P>
  <P>&nbsp;</P>
  <P><B><FONT SIZE=+1>ColorSync Building Blocks - ICC Profiles</FONT></B></P>
  <P>ColorSync relies on device &quot;profiles&quot; to be able to account
  for different device characteristics - these are files which have a format
  specified by the International Color Consortium - they contain data for
  a given device or class of devices.</P>
  <P>The following file formats support embedded ICC profiles:</P>
</BLOCKQUOTE>

<UL>
  <UL>
    <LI>TIFF
    <LI>JPEG
    <LI>GIF
    <LI>PNG
    <LI>PICT, and possibly more
  </UL>
</UL>

<BLOCKQUOTE>
  <P>Thus, a browser accepting files in these formats can detect embedded
  profiles and use them to match from the source device colors to the display.
  Support for this type of matching already exists in Internet Explorer 4.0.1.</P>
  <P>In addition, with extensions to the HTML &lt;IMG&gt; and &lt;BODY&gt;
  tags, profiles can be <I>associated</I> with images instead of having to
  be embedded within. Details of the additional HTML tags and a sample site
  testing browser use of images with profiles can be found at Apple's Colorsync
  web site at <A HREF="http://colorsync.apple.com/">colorsync.apple.com</A>.</P>
  <P>The benefits of profile association vs. embedding is that the profile
  can be downloaded once and used for multiple images on a page, or in a
  session. It also gives web site developers some flexibility, they don't
  need to rewrite all their images to embed profiles, they can make some
  simple additions to their HTML instead. GoLive's CyberStudio 3 allows for
  content developers to use either profile association or embedding to enable
  color management.</P>
  <P>&nbsp;</P>
  <P><B><FONT SIZE=+1>What has been added to Mozilla</FONT></B></P>
  <P>The new code that has been added implements color management for images
  that contain or reference ICC profiles, using ColorSync. It is <I>not</I>
  a public release of ColorSync code, rather it is code that calls ColorSync.
  ColorSync has been a component of MacOS for some time now - in the future
  it will run on other OSes as well. The new code checks for the existence
  of ColorSync on the OS, and if so will use its services as the browser
  encounters images with ICC profiles. As noted, images can either contain
  or reference ICC profiles. Therefore we first had to add smarts to the
  image decoders (e.g. JPEG) to look for embedded profiles. Secondly, we
  had to add new code to make requests over the net for ICC profiles referenced
  by URLs (or local files). This code keeps track of whether a profile has
  been received already and skips the download if so. Finally, code and user
  interface elements have been added to turn on/off these new features via
  preferences.</P>
  <P>&nbsp;</P>
  <P><B><FONT SIZE=+1>Current status of the project</FONT></B></P>
  <P>Apple and Mozilla/Netscape engineers discussed many of the issues involved
  in adding this functionality, with a rough spec drafted and revised. The
  timing was such that if the additions were to have any chance of being
  picked up into timely future versions of the browser, it had to be done
  quickly - so as the opportunities for outside help faded Apple bit the
  bullet and started writing code, after further consultations with various
  module owners.</P>
  <P>Since ColorSync now runs (alpha stage) on more than just the Mac platform,
  we decided to place as much of the functionality in the cross-platform
  image library as possible, with calls to the front end being used only
  as a hedge against our being able to deploy ColorSync everywhere Mozilla
  deploys. As the code currently stands, both the Mac and Win FEs have the
  same set of new IMGCB entry points, and the code therein is also identical.
  The X FE has stubs for these IMGCB entry points.</P>
  <P>Here's what has been done so far:</P>
</BLOCKQUOTE>

<UL>
  <UL>
    <LI>Embedded profile support for JPEG, GIF
    <LI>&lt;IMG... ICCPROFILE=...&gt; support
    <LI>&lt;BODY... ICCPROFILE=...&gt; support
    <LI>Preferences support : {no matching, match if profile, match to default}
    <LI>Printing works because the images are matched during decode time.
  </UL>
</UL>

<BLOCKQUOTE>
  <P>What's not there yet (for the future?)</P>
</BLOCKQUOTE>

<UL>
  <UL>
    <LI>Color World caching (code there, not tested so turned off)
    <LI>Embedded profiles in PNG
    <LI>Other color management features, like preview
  </UL>
</UL>

<BLOCKQUOTE>
  <P>Changes were made mostly to the image lib, expanded structs and new
  calls to a set of routines in a new file: icc_profile.c. I also had to
  change some code in layout, to parse the new IMG and BODY tags. Finally,
  in addition to the front end code and additional IMGCB entry points, we
  added new 'ppob' resources to the Mac resource file. This enables the new
  preferences, code was added to the image lib to read them.</P>
  <P>&nbsp;</P>
  <P><B><FONT SIZE=+1>What can you do?</FONT></B></P>
  <P>The list above mentions color world caching and profiles in PNG. The
  PNG spec for embedded ICC profiles has just been adopted by the PNG working
  group. It is available for download at the following sites:</P>
  <BLOCKQUOTE>
    <P><A HREF="http://www.cs.berkeley.edu/~amc/png/">http://www.cs.berkeley.edu/~amc/png/</A></P>
    <P><A HREF="http://www.cdrom.com/pub/png">http://www.cdrom.com/pub/png</A></P>
  </BLOCKQUOTE>
  <P>For this project, code was added to the jpeg and GIF reader routines
  in the imagelib - similar code would have to be added to the PNG reader.
  As far as &quot;color world&quot; caching goes, this is a similar optimization
  to image caching (in memory), and it means keeping around table information
  built from a set of ICC profiles with the idea of being able to use the
  information again. This is a good idea if the source (input) and destination
  (output) profiles are expected to be the same for multiple images - a valid
  assumption in some cases. There is code in the new file that is designed
  to implement this, but it is not turned on yet.</P>
  <P>Finally, here is a brief, undetailed list of some other things that
  could possibly be done:</P>
</BLOCKQUOTE>

<UL>
  <UL>
    <LI>Profile embedding/association in composer
    <LI>Figure out how to get AVID (Mac) for MWContext
    <LI>Print preview with ColorSync
    <LI>Gamut-check mode
    <LI>Display list of profiles embedded or assiocated on the current page
    (I'll probably have to implement this at some point just for debugging)
  </UL>
</UL>

<BLOCKQUOTE>
  <P>If you're interested in helping further ColorSync support in Mozilla,
  by all means contact me or others in Mozilla.org. Thanks.</P>
  <P>&nbsp;</P>
  <P>Eric Broadbent <BR>
  <A HREF="mailto:ebb3@apple.com">ebb3@apple.com</A><BR>
  August 31, 1998</BLOCKQUOTE>




</TD>

</TR>
<TR>

<TD COLSPAN="2" ALIGN="RIGHT" VALIGN="TOP">
<FONT SIZE="-1">
Copyright &copy; 1998-1999 The Mozilla Organization.
<BR>
<A HREF="http://www.mozilla.org/webtools/bonsai/cvslog.cgi?file=mozilla-org/html/projects/colorsync/index.html&amp;rev=&amp;root=/cvsroot/">Last modified September  9,  1998</A>.
</FONT>
</TD>
</TR>

</TABLE>
</BODY>
</HTML>
