<HTML>
<HEAD>
<TITLE>Debugging Mozilla on Linux FAQ</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT=0 MARGINWIDTH=0>

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP ROWSPAN=2><IMG
SRC="../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH=600 HEIGHT=58 VSPACE=0 HSPACE=0></TD></TR></TABLE>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">

<TR>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>



<TD BGCOLOR="#DDDDDD" VALIGN=TOP><IMG ALT=""
SRC="../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP><IMG ALT=""
SRC="../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>


<TR>

<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP COLSPAN=2>

<TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="..//"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../mission.html"> Our Mission</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../about.html"> Who We Are</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../get-involved.html"> Getting Involved</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../community.html"> Community</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../advocacy.html"> Editorials</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../news.html"> What's New</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../development.html"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../blue-sky/"> Blue Sky</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../status/"> Status</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../tools.html"> Tools</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../products.html"><B> Products</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../source.html"> Source Code</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../binaries.html"> Binaries</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../docs/"> Documentation</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../NPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../bugs/"> Bug Reports</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../quality/"> Quality</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../search.html"><B> Search</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../feedback.html"><B> Feedback</B></A></TD></TR>
</TABLE>
</TD>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD VALIGN=TOP>






<center><b><font size=+1>Debugging Mozilla on Linux FAQ</font></b>
<br><font size=-1>last modified:</font><SCRIPT>document.write(document.lastModified)</SCRIPT></center>

<hr WIDTH="100%">
<br>Contents:
<ul>
<li>
<a href="#introduction">Introduction</a></li>

<li>
<a href="#debugging">Q: How do I debug 5.0
on Linux?</a></li>

<li>
<a href="#gdb">Q: How do I use ddd / gdb?</a></li>

<li>
<a href="#fastdebugging">Q:
The debugger is slow. How can I make it faster?</a></li>

<li>
<a href="#breakpoints">Q:
ddd/gdb won't let me set a break point. Why not?</a></li>

<li>
<a href="#aborts">Q: The application
is aborting. Where do I set the break point to find out where it
is exiting?</a></li>

<li>
<a href="#strace">Q: What is strace
and how do I use it?</a></li>

<li>
<a href="#SIG32">Q: What should I do about the SIG32 I'm getting
on RH 6.0?</a></li>

<li>
<a href="#LD_BIND_NOW">Q: How do I use LD_BIND_NOW env variable?</a></li>
<li>
<a href="#questions">Q: I have questions.  Who do I ask?</a></li>
<li>
<a href="#comments">Q: I have comments about this FAQ.  Who do I send them to?</a></li>
<li>
<a href="#additions">Q: I want to add to this FAQ.  Who do I send my additions to?</a></li>
</ul>

<hr WIDTH="100%">
<b><a NAME="introduction"></a>Introduction:</b>
<p>This document is to help those Mac and Windows people debug Mozilla
on Linux. This is a work in progress.
<br>
<hr WIDTH="100%">
<b>
<br><a NAME="debugging"></a>Question:
How do I debug 5.0 on Linux?
</b>
<p>$ cd mozilla/dist/bin
<br>$ ./mozilla-apprunner.sh -g
<p>If you are new to debugging on Linux, I recommend using ddd.
ddd is a graphical debugger that runs on top of gdb. You may still
find yourself doing gdb command from within ddd.
<br>
<hr WIDTH="100%">
<b>
<br><a NAME="gdb"></a>Question: How
do I use ddd / gdb?
</b>
<p>Start here:
<p>http://www.gnu.org/manual/gdb-4.17/html_mono/gdb.html
<br>http://www.cs.tu-bs.de/softech/ddd/ddd-tips.html
<br>http://www.cs.tu-bs.de/softech/ddd/ddd-faq.html
<br>
<hr WIDTH="100%">
<b>
<br><a NAME="fastdebugging"></a>Question:
the debugger (gdb/ddd) is slow. How can I make it faster?
</b>
<p>add this line to your $HOME/.gdbinit file:
<br>set auto-solib-add 0
<p>This will cause gdb to lazily read symbol tables. (If you are using this option with glibc 2.1, please see <a href="#Question:  SIG32">What should I do about the SIG32 I'm getting in RH 6.0?</a>)
<p>Example:
<p>I'm debugging apprunner. I interrupt the process.
Looking at the stack trace, I see this:
<p>(gdb) where
<p>#0 0x4085e7d0 in ?? () from /lib/libc.so.6
<br>#1 0x4066cbf0 in ?? () from /usr/lib/libglib-1.2.so.0
<br>#2 0x4066c634 in ?? () from /usr/lib/libglib-1.2.so.0
<br>#3 0x4066c979 in ?? () from /usr/lib/libglib-1.2.so.0
<br>#4 0x4059bf3a in ?? () from /usr/lib/libgtk-1.2.so.0
<br>#5 0x40222a19 in ?? () from /builds/seth/MOZILLA/06.23.1999/04.30/mozilla/dist/bin/libwidgetgtk.so
<br>#6 0x4015617d in ?? () from /builds/seth/MOZILLA/06.23.1999/04.30/mozilla/dist/bin/libnsappshell.so
<br>#7 0x804aa00 in main (argc=2, argv=0xbffffa04) at nsAppRunner.cpp:670
<br>#8 0x407cecb3 in ?? () from /lib/libc.so.6
<p>To load the symbol tables, I'd do this on the gdb console:
<p>(gdb) shar libwidgetgtk.so
<br>(gdb) shar libnsappshell.so
<br>(gdb) shar libc.so.6
<br>(gdb) shar libglib-1.2.so.0
<br>(gdb) shar libgtk-1.2.so.0
<p>Now, if I do "where" again to see the stack trace, I get this:
<p>(gdb) where
<p>#0 0x4085e7d0 in __poll (fds=0x83171f8, nfds=3, timeout=19) at
../sysdeps/unix/sysv/linux/poll.c:45
<br>#1 0x4066cbf0 in g_main_poll ()
<br>#2 0x4066c634 in g_main_iterate ()
<br>#3 0x4066c979 in g_main_run ()
<br>#4 0x4059bf3a in gtk_main ()
<br>#5 0x40222a19 in nsAppShell::Run (this=0x80c35e0) at nsAppShell.cpp:237
<br>#6 0x4015617d in nsAppShellService::Run (this=0x80b4a80) at nsAppShellService.cpp:428
<br>#7 0x804aa00 in main (argc=2, argv=0xbffffa04) at nsAppRunner.cpp:670
<br>#8 0x407cecb3 in __libc_start_main (main=0x8049abc &lt;main>,
argc=2, argv=0xbffffa04, init=0x804956c &lt;_init>, fini=0x804b738 &lt;_fini>,
rtld_fini=0x4000a350, stack_end=0xbffff9fc) at ../sysdeps/generic/libc-start.c:78
<p>Advanced tricks:
<br>1) you don't have to type the full library name to load it
<p>"shar msg" will load any libraries (used by the process you are debugging)
that match this pattern lib*msg*
<p>(gdb) shar msg
<br>Reading symbols from /builds/seth/MOZILLA/06.23.1999/04.30/mozilla/dist/bin/libmsgbaseutil.so...done.
<br>Reading symbols from /builds/seth/MOZILLA/06.23.1999/04.30/mozilla/dist/bin/components/libmsgimap.so...done.
<br>Reading symbols from /builds/seth/MOZILLA/06.23.1999/04.30/mozilla/dist/bin/components/libmsgnews.so...done.
<br>Reading symbols from /builds/seth/MOZILLA/06.23.1999/04.30/mozilla/dist/bin/components/libmsgcompose.so...done.
<br>Reading symbols from /builds/seth/MOZILLA/06.23.1999/04.30/mozilla/dist/bin/components/libmsgdb.so...done.
<p>2) ramiro mozilla/tools/debug/gdb/solib.gdbinit
<p>I added some macros to load symbols from chunks of code that im
<br>interested in - as opposed to the whole damn thing.
<br>For rdf, mailnews, etc, you will need new entries.
<p><a href="http://x21.deja.com/=dnc/[ST_rn=ps]/getdoc.xp?AN=465346259&CONTEXT=930633898.1554514020&hitnum=0">thanks to Arun Sharma for this tip.</a>
<p>
<hr WIDTH="100%">
<b>
<br><a NAME="breakpoints"></a>Question:
I can't set a break point in 'nsNntpService::~nsNntpService(void)'.
Why won't gdb let me?
</b>
<p>
<hr WIDTH="100%">
<b>
<br><a NAME="strace"></a>Question:
What is strace and how do I use it?
</b>
<p>strace is your friend.  more on this later.
<br>
<hr WIDTH="100%">
<br><a NAME="aborts"></a>Question:
Where do I break to track down aborts?
<p>PR_ASSERT() vs NS_ASSERTION() on Linux.
<p>(gdb) b abort
<br>(gdb) b exit
<br>
<hr WIDTH="100%">
<b>
<br><a NAME="SIG32"></a>Question: Why do I keep stopping
with SIG32? How do I stop that?</b>
<p>for rh 6.0, you may need to add this line to your $HOME/.gdbinit file:
<br>handle SIG32 nostop
<p>
<p> With the landing of Necko, mozilla is a multi-threaded application on Unix.
 Unfortunately, this confuses pthreads when run under gdb on glibc 2.1 with the <a href="#Question: faster debugging">auto-solib-add</a> option.
<p> The solution is to have libpthread.so loaded when the first thread gets
created. One trick to do this is to set a breakpoint in main() and then load libpthread at this point:
<pre>
gdb ./apprunner 
GNU gdb 4.17.0.11 with Linux support
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i386-redhat-linux"...
(gdb) tbreak main
Breakpoint 1 at 0x804b289: file nsAppRunner.cpp, line 808.
(gdb) run
Starting program: .../mozilla/dist/bin/./apprunner 

Breakpoint 1, main (argc=1, argv=0xbffff8a4) at nsAppRunner.cpp:808
808	    rv = NS_InitXPCOM(NULL);
(gdb) sha pthread
Reading symbols from /lib/libpthread.so.0...done.
(gdb) cont
</pre>
You can also add these lines to your .gdbinit:
<pre>
def prun
  tbreak main
  run
  sha pthread
  cont
end
</pre>
And then simply type "prun" instead of "run" to run apprunner.
<br>
<hr WIDTH="100%">
<br><b><a NAME="LD_BIND_NOW"></a>Question: How do I use the
LD_BIND_NOW environment variable?</b>
<p>You might want to add information about environment. I always
have this
<br>set:
<p>export LD_BIND_NOW=1
<p>or, if you are using tcsh as your shell:
<p>setenv LD_BIND_NOW 1
<p>The LD_BIND_NOW=1 keeps the dynamic linker from lazily linking symbols.
<br>This means that when you're walking through code you never suddenly
end up in the dynamic loader hunting for a symbol.
<br>from Christopher Blizzard &lt;blizzard@redhat.com>
<hr WIDTH="100%">
<b> <br><a NAME="questions"></a>Question: I have questions.  </b>
<p>post your questions to this newsgroup:<br>
<p><a href="news://news.mozilla.org/netscape.public.mozilla.unix">news://news.mozilla.org/netscape.public.mozilla.unix</a>
<p>If you are trying to debug Mozilla on UNIX, we'll gladly help.
<hr WIDTH="100%">
<b> <br><a NAME="comments"></a>Question: I have comments.  </b>
<p>post your constructive comments to this newsgroup:<br>
<p><a href="news://news.mozilla.org/netscape.public.mozilla.unix">news://news.mozilla.org/netscape.public.mozilla.unix</a>
<p><i>whining will be ignored.</i>
<hr WIDTH="100%">
<b> <br><a NAME="additions"></a>Question: I want to add to this FAQ.  Who I send my additions to?</b>
<p>post your additions to this newsgroup:<br>
<p><a href="news://news.mozilla.org/netscape.public.mozilla.unix">news://news.mozilla.org/netscape.public.mozilla.unix</a> or send mail to <a href="mailto:sspitzer@netscape.com">sspitzer@netscape.com</A>.




</TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>


<TR>


<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM><IMG ALT=""
SRC="../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM><IMG ALT=""
SRC="../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=BOTTOM COLSPAN=2><IMG ALT=""
SRC="../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>
</TR>

<TR BGCOLOR="#000000">

<TD BGCOLOR="#000000" COLSPAN=5><BR></TD>

<TD BGCOLOR="#000000" VALIGN=TOP>

<FONT COLOR="#AAAAAA" SIZE="-1">
Copyright &copy; 1998-1999 The Mozilla Organization.
</FONT>

</TD>

<TD BGCOLOR="#000000" COLSPAN=2><BR></TD>
</TR>

</TABLE>
</BODY>
</HTML>
