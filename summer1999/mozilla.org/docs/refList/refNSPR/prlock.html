<HTML>
<HEAD>
<TITLE>NSPR 2.0: Locks</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT=0 MARGINWIDTH=0>

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP ROWSPAN=2><IMG
SRC="../../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH=600 HEIGHT=58 VSPACE=0 HSPACE=0></TD></TR></TABLE>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">

<TR>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>



<TD BGCOLOR="#DDDDDD" VALIGN=TOP><IMG ALT=""
SRC="../../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP><IMG ALT=""
SRC="../../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>


<TR>

<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP COLSPAN=2>

<TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../..//"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../mission.html"> Our Mission</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../about.html"> Who We Are</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../get-involved.html"> Getting Involved</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../community.html"> Community</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../advocacy.html"> Editorials</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../news.html"> What's New</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../development.html"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../blue-sky/"> Blue Sky</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../status/"> Status</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../tools.html"> Tools</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../products.html"><B> Products</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../source.html"> Source Code</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../binaries.html"> Binaries</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../docs/"> Documentation</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../NPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../bugs/"> Bug Reports</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../quality/"> Quality</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../search.html"><B> Search</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../feedback.html"><B> Feedback</B></A></TD></TR>
</TABLE>
</TD>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD VALIGN=TOP>







<A HREF="contents.html">[Contents]</A> <A HREF="prinit.html">[Previous]</A> <A HREF="prcvar.html">[Next]</A> <A HREF="last.html">[Last]</A>
<HR>
<A NAME="1007162">
<P></A><CENTER><H2>Chapter 5<BR><A NAME="1007115">
Locks</H2>
</A></CENTER>
<A NAME="1019522">
This chapter describes the NSPR API for creation and manipulation of a mutex of type <A HREF="prlock.html#1018659"><CODE>PRLock</CODE></A>.<P></A>
<A NAME="1019529">
<A HREF="prlock.html#1018633">Lock Type</A><br><A HREF="prlock.html#1018718">Lock Functions</A><P></A>
<A NAME="1018526">
In NSPR, a mutex of type <A HREF="prlock.html#1018659"><CODE>PRLock</CODE></A> controls locking, and associated condition variables communicate changes in state among threads. When a programmer associates a mutex with an arbitrary collection of data, the mutex provides a protective monitor around the data. <P></A>
<A NAME="1018984">
In general, a monitor is a conceptual entity composed of a mutex, one or more condition variables, and the monitored data. Monitors in this generic sense should not be confused with monitors used in Java programming. In addition to <A HREF="prlock.html#1018659"><CODE>PRLock</CODE></A>, NSPR provides another mutex type, <A HREF="prmon.html#421412"><CODE>PRMonitor</CODE></A>, which is reentrant and can have only one associated condition variable. <CODE>PRMonitor</CODE> is intended for use with Java and reflects the Java approach to thread synchronization. <P></A>
<A NAME="1018405">
For an introduction to NSPR thread synchronization, including locks and condition variables, see <A HREF="printro.html#1015494">Chapter 1, "Introduction to NSPR."</A><P></A>
<A NAME="1019344">
For reference information on NSPR condition variables, see <A HREF="prcvar.html#1007115">Chapter 6, "Condition Variables."</A><P></A>

<A NAME="Lock Type"></A>
<A NAME="1018633">
<H2> Lock Type</H2>
</A>

<A NAME="Head3;"></A>
<A NAME="1018659">
<H4> PRLock</H4>
</A>

<A NAME="1018673">
A mutual exclusion lock.<P></A>
<A NAME="Head4;"></A>
<A NAME="1018660">
<H5> Syntax</H5>
</A>

<A NAME="1018671">
<PRE>#include &lt;prlock.h&gt;</PRE></A><A NAME="1018681">
<PRE>typedef struct PRLock PRLock;</PRE></A><A NAME="Head4;"></A>
<A NAME="1018675">
<H5> Description</H5>
</A>

<a name="1018677">
NSPR represents a lock as an opaque entity to clients of the functions described in this 
chapter. Functions that operate on locks do not have timeouts and are not interruptible.
</blockquote>
</a>

<A NAME="Lock Functions"></A>
<A NAME="1018718">
<H2> Lock Functions</H2>
</A>
<ul><P>
<A NAME="1019665">
<LI><A HREF="prlock.html#1018661"><CODE>PR_NewLock</CODE></A> creates a new lock object.</LI>
</A><P>
<A NAME="1019676">
<LI><A HREF="prlock.html#1018626"><CODE>PR_DestroyLock</CODE></A> destroys a specified lock object.</LI>
</A><P>
<A NAME="1019672">
<LI><A HREF="prlock.html#1018627"><CODE>PR_Lock</CODE></A> locks a specified lock object.</LI>
</A><P>
<A NAME="1018789">
<LI><A HREF="prlock.html#1018630"><CODE>PR_Unlock</CODE></A> unlocks a specified lock object.</LI>
</A></ul>
<A NAME="Head3;"></A>
<A NAME="1018661">
<H4> PR_NewLock</H4>
</A>

<A NAME="1018707">
Creates a new lock.<P></A>
<A NAME="Head4;"></A>
<A NAME="1018686">
<H5> Syntax</H5>
</A>

<A NAME="1018696">
<PRE>#include &lt;prlock.h&gt;</PRE></A><A NAME="1018689">
<PRE>PRLock* PR_NewLock(void);</PRE></A><A NAME="Head4;"></A>
<A NAME="1019728">
<H5> Returns<br></H5>
</A>

<A NAME="1019729">
The function returns one of the following values:<P></A>
<ul><P>
<A NAME="1019735">
<LI>If successful, a pointer to the new lock object.</LI>
</A><P>
<A NAME="1019747">
<LI>If unsuccessful (for example, the lock cannot be created because of resource constraints), <CODE>NULL</CODE>.</LI>
</A></ul><A NAME="Head4;"></A>
<A NAME="1018690">
<H5> Description</H5>
</A>

<a name="1018702">
<CODE>PR_NewLock</CODE> creates a new opaque lock 
</blockquote>
</a>

<A NAME="Head3;"></A>
<A NAME="1018626">
<H4> PR_DestroyLock</H4>
</A>

<A NAME="1018870">
Destroys a specified lock object.<P></A>
<A NAME="Head4;"></A>
<A NAME="1018842">
<H5> Syntax</H5>
</A>

<A NAME="1018843">
<PRE>#include &lt;prlock.h&gt;</PRE></A><A NAME="1018849">
<PRE>void PR_DestroyLock(PRLock *lock);</PRE></A><A NAME="Head4;"></A>
<A NAME="1019844">
<H5> Parameter</H5>
</A>

<a name="1019850">
<CODE>PR_DestroyLock</CODE> has one parameter:<P><B></B>
<TABLE BORDER="0">
<TR><TD VALIGN=baseline ALIGN=left><A NAME="1019847">
<PRE>lock</PRE></A><TD VALIGN=baseline ALIGN=left><A NAME="1019849">
A pointer to a lock object.</A></P>

</TABLE>
<TABLE>
<TR><TD>
</TABLE>

</blockquote>
</a>
<A NAME="Head4;"></A>
<A NAME="1019851">
<H5> Caution</H5>
</A>

<A NAME="1019596">
The caller must ensure that no thread is currently in a lock-specific function. Locks do not provide self-referential protection against deletion.<P></A>

<A NAME="Head3;"></A>
<A NAME="1018627">
<H4> PR_Lock</H4>
</A>

<A NAME="1018878">
Locks a specified lock object.<P></A>
<A NAME="Head4;"></A>
<A NAME="1018881">
<H5> Syntax</H5>
</A>

<A NAME="1018889">
<PRE>#include &lt;prlock.h&gt;</PRE></A><A NAME="1018882">
<PRE>void PR_Lock(PRLock *lock);</PRE></A><A NAME="Head4;"></A>
<A NAME="1018883">
<H5> Parameter</H5>
</A>

<a name="1018901">
<CODE>PR_Lock</CODE> has one parameter:<P><B></B>
<TABLE BORDER="0">
<TR><TD VALIGN=baseline ALIGN=left><A NAME="1018898">
<PRE>lock</PRE></A><TD VALIGN=baseline ALIGN=left><A NAME="1018900">
A pointer to the lock object to be locked.</A></P>

</TABLE>
<TABLE>
<TR><TD>
</TABLE>

</blockquote>
</a>
<A NAME="Head4;"></A>
<A NAME="1019617">
<H5> Description</H5>
</A>

<A NAME="1019638">
When <CODE>PR_Lock</CODE> returns, the calling thread is "in the monitor," also called "holding the monitor's lock." Any thread that attempts to acquire the same lock blocks until the holder of the lock exits the monitor. Acquiring the lock is not an interruptible operation, nor is there any timeout mechanism.<P></A>

<A NAME="Head3;"></A>
<A NAME="1018630">
<H4> PR_Unlock</H4>
</A>

<A NAME="1018909">
Releases a specified lock object. Releasing an unlocked lock results in an error.<P></A>
<A NAME="Head4;"></A>
<A NAME="1018910">
<H5> Syntax</H5>
</A>

<A NAME="1018911">
<PRE>#include &lt;prlock.h&gt;</PRE></A><A NAME="1018912">
<PRE>PRStatus PR_Unlock(PRLock *lock);</PRE></A><A NAME="Head4;"></A>
<A NAME="1018913">
<H5> Parameter</H5>
</A>

<a name="1018919">
<CODE>PR_Unlock</CODE> has one parameter:<P><B></B>
<TABLE BORDER="0">
<TR><TD VALIGN=baseline ALIGN=left><A NAME="1018916">
<PRE>lock</PRE></A><TD VALIGN=baseline ALIGN=left><A NAME="1018918">
A pointer to the lock object to be released.</A></P>

</TABLE>
<TABLE>
<TR><TD>
</TABLE>

</blockquote>
</a>
<A NAME="Head4;"></A>
<A NAME="1018906">
<H5> Returns</H5>
</A>

<A NAME="1018932">
The function returns one of the following values:<P></A>
<ul><P>
<A NAME="1018933">
<LI>If successful, <CODE>PR_Success</CODE>.</LI>
</A><P>
<A NAME="1018934">
<LI>If unsuccessful (for example, if the caller does not own the lock), <CODE>PR_FAILURE</CODE>. </LI>
</A><a name="1018927">

</blockquote>
</a>
</ul>
<P><HR>
<A HREF="contents.html">[Contents]</A> <A HREF="prinit.html">[Previous]</A> <A HREF="prcvar.html">[Next]</A> <A HREF="last.html">[Last]</A>
<P ALIGN=right>

<FONT SIZE=-2><I>Last Updated: Mon Jul 13 17:32:18 PDT 1998</I></FONT>

<HR SIZE=4>

<P> <CENTER>Copyright © 1998
<A HREF="http://home.netscape.com/misc/contact_info.html"
TARGET=_top>Netscape Communications Corporation</A></FONT>
</CENTER>
<P>
<P>






</TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>


<TR>


<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM><IMG ALT=""
SRC="../../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=BOTTOM COLSPAN=2><IMG ALT=""
SRC="../../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>
</TR>

<TR BGCOLOR="#000000">

<TD BGCOLOR="#000000" COLSPAN=5><BR></TD>

<TD BGCOLOR="#000000" VALIGN=TOP>

<FONT COLOR="#AAAAAA" SIZE="-1">
Copyright &copy; 1998-1999 The Mozilla Organization.
</FONT>

</TD>

<TD BGCOLOR="#000000" COLSPAN=2><BR></TD>
</TR>

</TABLE>
</BODY>
</HTML>
