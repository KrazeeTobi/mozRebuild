<HTML>
<HEAD>
<TITLE>mozilla.org</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT=0 MARGINWIDTH=0>

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP ROWSPAN=2><IMG
SRC="../../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH=600 HEIGHT=58 VSPACE=0 HSPACE=0></TD></TR></TABLE>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=TOP><IMG ALT=""
SRC="../../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ROWSPAN=2>

<BR><TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../..//"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../mission.html"> Our Mission</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../about.html"> Who We Are</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../get-involved.html"> Getting Involved</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../community.html"> Community</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../advocacy.html"> Editorials</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../news.html"> What's New</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../development.html"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../blue-sky/"> Blue Sky</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../projects.html"> Projects</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../source-code.html"><B> Source Code</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../source.html"> Getting It</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../docs/"> Documentation</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../NPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../bugs/"> Bugs</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../search"><B> Search</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../feedback.html"><B> Feedback</B></A></TD></TR>
</TABLE><BR>

</TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=TOP><IMG ALT=""
SRC="../../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ROWSPAN=2>
<P><BR>



   <TITLE>NSRP 2.0: Windows 3.1 special cases
</TITLE>


<A HREF="contents.html">[Contents]</A> <A HREF="prmwait.html">[Previous]</A>
<A HREF="last.html">[Next]</A> <A HREF="last.html">[Last]</A>
<HR>
<CENTER>
<H2>
<A NAME="Win16SpecialCases"></A>Appendix B:<BR>
Windows 3.1 Special Cases</H2></CENTER>
This chapter describes platform specific features supporting Windows 3.1
[Note: The term Win16 is used interchangeable with Windows 3.1 or Windows
3.11 for Workgroups.] This chapter is specific to Win16 and does not apply
to other platforms supported for NSPR 2.0.

<H2>
<A NAME="commandLine"></A>Handling stdio for command line applications.</H2>
Win16 provides an API for writing in a Windowed environment. That API should
be used when developing a GUI application. A command line or console application
requires a different approach. On Win16, a command line application is
actually run in a Windowed environment. The environment intercepts printf()
and similar functions and displays the output in a wrapper window. The
Microsoft C compiler, Version 1.52, calls this environment QuickWin. NSPR
2.0 for Win16 was developed using the Watcom C/C++ Compiler, Version 11.0a;
this compiler provides a similar environment.

<P>When a command line application uses the printf() library call, all
is well. The output is displayed in the wrapper (QuickWin) window. If the
application uses PR_Printf(), then the call is to the NSPR 2.0 .DLL. In
the .DLL environment, NSPR does not have ready access to the wrapper window
that is directly available to the application program (the .EXE). To get
text displayed in the wrapper window, NSPR provides a module (w16stdio.c)
to be linked with the application program's .EXE file. By linking the command
line application with the w16stdio.obj file, messages written using NSPR's
"printf" interfaces will be displayed in the wrapper window.
<H4>
<A NAME="PR_STDIO_INIT"></A>PR_STDIO_INIT</H4>
Initialize NSPR to write to stdio in command line applications.
<H5>
Syntax</H5>

<PRE>#include &lt;prwin16.h>

void PR_STDIO_INIT( void );</PRE>

<H5>
Parameter</H5>
void
<H5>
Returns</H5>
void
<H5>
Description</H5>
PR_STDIO_INIT() is a macro that registers the functions provided in w16stdio.c
with the NSPR 2.0 .DLL. Thereafter, calls to PR_Printf() and related functions
will cause stdio output to be displayed in the wrapper window. PR_STDIO_INIT()
should be called in the command line application before any calls that
would try to write to stdio.

<P>PR_STDIO_INIT() should not be called from GUI applications.

<P>PR_STDIO_INIT() evaluates to a No-Operation on platforms other than
Win16.
<H2>
<A NAME="CallbackFunctions"></A>Callback functions for applications using
NSPR 2.0</H2>
Win16 provides separate heap spaces for each executable (.EXE) and load
library (.DLL). Should a load library acquire storage on behalf of an executable,
when the executable subsequently frees that storage, heap corruption may
occur. To circumvent this, NSPR provides linkages and wrapper functions
so that some functions that acquire storage on behalf of the executable
can be called consistently from the environment of the executable.
<BR>
<H3>
<A NAME="CallbackRegStructure"></A>Callback Method Registration Structure</H3>

<H4>
<A NAME="PRMethodCallbackStr"></A>PRMethodCallbackStr</H4>
The <TT>PRMethodCallbackStr</TT> structure contains a list of address of functions
to be called from the NSPR executable. These functions are provided (optionally)
by NSPR in module w16callb.c. The module w16callb.c should be statically
linked with the user application executable.
<H3>
<A NAME="CallbackFunctions"></A>Callback Functions</H3>

<H4>
<A NAME="pr_init_callbacks"></A>PR_INIT_CALLBACKS</H4>
Register NSPR provided call back functions.
<H5>
Syntax</H5>

<PRE>#include &lt;prwin16.h>

void PR_INIT_CALLBACKS( void );</PRE>

<H5>
Parameter</H5>
void
<H5>
Returns</H5>
void
<H5>
Description</H5>
Registers a set of NSPR provided callback functions for the defined set
of functions to be executed in the application's .EXE environment.
<H4>
<A NAME="callbackMalloc"></A>_PL_W16CallBackMalloc</H4>
Wrap a call to malloc().
<H5>
Syntax</H5>

<PRE>#include &lt;prwin16.h>

void *_PL_W16CallBackMalloc(size_t size);</PRE>

<H5>
Parameter</H5>

<TABLE COLS=2 WIDTH="100%" >
<TR ALIGN=LEFT VALIGN=TOP>
<TD WIDTH="10%"><B><TT>size</TT></B>
</TD>

<TD ALIGN=LEFT VALIGN=BASELINE>Size argument to be passed to malloc().</TD>
</TR>
</TABLE>

<H5>
Returns</H5>
Pointer to storage of size <B>size</B> or NULL.
<H5>
Description</H5>
Call malloc().
<H4>
<A NAME="callbackCalloc"></A>_PL_W16CallBackCalloc</H4>
Wrap a call to calloc().
<H5>
Syntax</H5>

<PRE>
#include &lt;prwin16.h>

void *_PL_W16CallBackCalloc(size_t n, size_t size);
</PRE>

<H5>
Parameter</H5>

<TABLE COLS=2 WIDTH="100%" >
<TR ALIGN=LEFT VALIGN=TOP>
<TD WIDTH="10%"><B><TT>n</TT></B>
</TD>

<TD ALIGN=LEFT VALIGN=BASELINE>number of objects argument to be passed
to calloc().</TD>
</TR>

<TR>
<TD>
<TT><B>size</B></TT>
</TD>

<TD>Size argument to be passed to calloc()</TD>
</TR>
</TABLE>

<H5>
Returns</H5>
Pointer to storage of size ( n * size ) or NULL.
<H5>
Description</H5>
Call calloc().
<H4>
<A NAME="callbackReAlloc"></A>_PL_W16CallBackRealloc</H4>
Wrap a call to realloc().
<H5>
Syntax</H5>

<PRE>#include &lt;prwin16.h></PRE>

<PRE>void *_PL_W16CallBackRealloc(void *old_blk, size_t size);</PRE>

<H5>
Parameter</H5>

<TABLE COLS=2 WIDTH="100%" >
<TR ALIGN=LEFT VALIGN=TOP>
<TD WIDTH="10%"><B><TT>old_blk</B></TT>
</TD>

<TD ALIGN=LEFT VALIGN=BASELINE>Pointer to old block of storage passed
to realloc().</TD>
</TR>

<TR>
<TD>
<B><TT>size</B></TT>
</TD>

<TD>Size argument to be passed to realloc().</TD>
</TR>
</TABLE>

<H5>
Returns</H5>
Pointer to new storage or <TT>NULL</TT>.
<H5>
Description</H5>
Call realloc().
<H4>
<A NAME="callbackFree"></A>_PL_W16CallBackFree</H4>
Wrap a call to free().
<H5>
Syntax</H5>

<PRE>#include &lt;prwin16.h></PRE>

<PRE>void _PL_W16CallBackFree(void *ptr);</PRE>

<H5>
Parameter</H5>

<TABLE COLS=2 WIDTH="100%" >
<TR ALIGN=LEFT VALIGN=TOP>
<TD WIDTH="10%"><B><TT>ptr</TT></B>
</TD>

<TD ALIGN=LEFT VALIGN=BASELINE>Pointer to be passed to free().</TD>
</TR>
</TABLE>

<H5>
Returns</H5>
void
<H5>
Description</H5>
Call free().
<H4>
<A NAME="callbackGetenv"></A>_PL_W16CallBackGetenv</H4>
Wrap a call to getenv().
<H5>
Syntax</H5>

<PRE>#include &lt;prwin16.h></PRE>

<PRE>void *_PL_W16CallBackGetenv(const char *name);</PRE>

<H5>
Parameter</H5>

<TABLE COLS=2 WIDTH="100%" >
<TR ALIGN=LEFT VALIGN=TOP>
<TD WIDTH="10%"><B><TT>name</TT></B>
</TD>

<TD ALIGN=LEFT VALIGN=BASELINE>argument to be passed to getenv().</TD>
</TR>
</TABLE>

<H5>
Returns</H5>
Pointer to environment variable referenced by name or NULL.
<H5>
Description</H5>
Call getenv().
<H4>
<A NAME="callbackPutenv"></A>_PL_W16CallBackPutenv</H4>
Wrap a call to putenv().
<H5>
Syntax</H5>

<PRE>#include &lt;prwin16.h></PRE>

<PRE>PRIntn _PL_W16CallBackPutenv(const char *assoc);</PRE>

<H5>
Parameter</H5>

<TABLE COLS=2 WIDTH="100%" >
<TR ALIGN=LEFT VALIGN=TOP>
<TD WIDTH="10%"><B><TT>assoc</TT></B>
</TD>

<TD ALIGN=LEFT VALIGN=BASELINE>Argument to putenv().</TD>
</TR>
</TABLE>

<H5>
Returns</H5>
zero if successful, else -1.
<H5>
Description</H5>
Call putenv().
<H4>
<A NAME="callbackStrftime"></A>_PL_W16CallBackStrftime</H4>
Wrap a call to strftime().
<H5>
Syntax</H5>

<PRE>#include &lt;prwin16.h></PRE>

<PRE>PRSize _PL_W16CallBackStrftime(
    char *s,
    size_t len,
    const char *fmt,
    const struct tm *p);</PRE>

<H5>
Parameter</H5>

<TABLE COLS=2 WIDTH="100%" >
<TR ALIGN=LEFT VALIGN=TOP>
<TD WIDTH="10%"><B><TT>s</TT></B>
</TD>

<TD ALIGN=LEFT VALIGN=BASELINE>Output string.</TD>
</TR>

<TR>
<TD>
<B><TT>len</TT></B>
</TD>

<TD>size of string s.</TD>
</TR>

<TR>
<TD>
<B><TT>fmt</B></TT>
</TD>

<TD>format string</TD>
</TR>

<TR>
<TD>
<B><TT>p</B></TT>
</TD>

<TD>pointer to struct tm</TD>
</TR>
</TABLE>
All arguments are passed to strftime().
<H5>
Returns</H5>
The return value from the call to strftime().
<H5>
Description</H5>
Call strftime().
<H2>
<A NAME="ExceptionContext"></A>C++ Exception Context</H2>
GUI applications written using Microsoft's MFC library have to deal with
exceptions thrown by the runtime environment. These exceptions are specific
to a thread. The application's exception context must be associated with
the NSPR thread on which the exception occurs and must be handled. To associate
the exception context and to restore it across thread switches, NSPR 2.0
provides the following functions.

<H4>
<A NAME="SET_exceptionContext"></A>PR_W16SetExceptionContext</H4>
Set the exception context for a Win16 MFC application thread.
<H5>
Syntax</H5>

<PRE>#include &lt;prwin16.h>

void PR_W16SetExceptionContext(void *context);</PRE>

<H5>
Parameter</H5>
An MFC exception context.
<H5>
Returns</H5>
void
<H5>
Description</H5>
The function preserves the exception context argument and associates it
with the current thread.
<H4>
<A NAME="GET_exceptionContext"></A>PR_W16GetExceptionContext</H4>
Get the exception context for a Win16 MFC application thread.
<H5>
Syntax</H5>

<PRE>#include &lt;prwin16.h>

void *PR_W16SetExceptionContext(void);</PRE>

<H5>
Parameter</H5>

<H5>
Returns</H5>
An exception context or a null pointer.
<H5>
Description</H5>
The exception context previously set by <TT>PR_W16SetExceptionContext()</TT> for
the current thread.
<BR>The API defined for Windows 3.1 is specific to that platform.
<H5>

<HR WIDTH="100%"></H5>
<A HREF="contents.html">[Contents]</A> <A HREF="prmwait.html">[Previous]</A>
<A HREF="plhash.html">[Next]</A> <A HREF="last.html">[Last]</A>
<DIV ALIGN=right><I><FONT SIZE=-2>Last Updated: Wed Jul 15 11:16:44 PDT 1998</FONT></I>
<HR SIZE=4></DIV>

<CENTER>Copyright &copy; 1998 <A HREF="http://home.netscape.com/misc/contact_info.html" TARGET="_top">Netscape
Communications Corporation</A></CENTER>





<P><BR>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>
<TR>


<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM><IMG ALT=""
SRC="../../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=BOTTOM><IMG ALT=""
SRC="../../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>
</TR>

<TR>

<TD BGCOLOR="#000000" COLSPAN=6><BR></TD>

<TD BGCOLOR="#000000" VALIGN=TOP>

<FONT COLOR="#AAAAAA" SIZE="-1">
Copyright &copy; 1998 Netscape Communications Corporation.
</FONT>
</FONT>
</TD>

<TD BGCOLOR="#000000" COLSPAN=2><BR></TD>
</TR>

</TABLE>
<P>
</BODY>
</HTML>
