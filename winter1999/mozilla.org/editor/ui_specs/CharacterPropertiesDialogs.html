<HTML>
<HEAD>
<TITLE>Character Properties Dialogs</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT=0 MARGINWIDTH=0>

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP ROWSPAN=2><IMG
SRC="../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH=600 HEIGHT=58 VSPACE=0 HSPACE=0></TD></TR></TABLE>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=TOP><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ROWSPAN=2>

<BR><TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../..//"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../mission.html"> Our Mission</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../about.html"> Who We Are</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../get-involved.html"> Getting Involved</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../community.html"> Community</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../advocacy.html"> Editorials</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../news.html"> What's New</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../development.html"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../blue-sky/"> Blue Sky</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../projects.html"> Projects</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../status/"> Status</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../tools.html"> Tools</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../products.html"><B> Products</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../source.html"> Source Code</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../binaries.html"> Binaries</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../docs/"> Documentation</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../NPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../bugs/"> Bug Reports</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../search.html"><B> Search</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../feedback.html"><B> Feedback</B></A></TD></TR>
</TABLE><BR>

</TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=TOP><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ROWSPAN=2>
<P><BR>




   
   



<h1>
Character Property Dialogs</h1>

<div align=right><font size=-1>Last updated 1/26/99 by Charles Manske</font>
<br><font size=-1>(<a href="mailto:cmanske@netscape.com">cmanske@netscape.com</a>)</font></div>

<p><br>There are four Tabbed Dialog Panes that make up a related set. When
a single image is selected or the user is inserting an image, the first
pane is the <a href="ImageDialogs.html#ImageProperties">Image Properties</a>
pane, followed by the <a href="#LinkProperties">Link</a> and <a href="#ParagraphProperties">Paragraph</a>
panes. Otherwise, the first pane is the Character Properties. In addition
to the behaviors specified here, all four of these property panes behave
according the the rules common to all "<a href="Composer_5_Dialogs.html#MultipaneDialogs">multipane
or tabbed dialogs</a>."
<h2>
1.&nbsp;<a NAME="CharacterProperties"></a>Character Properties</h2>

<table BORDER=0 CELLSPACING=2 CELLPADDING=2 >
<tr VALIGN=TOP>
<td>Windows:</td>

<td>Mac:</td>

<td>UNIX:</td>
</tr>

<tr VALIGN=TOP>
<td><img SRC="PropsCharTab_W.gif" BORDER=0 height=387 width=461></td>

<td></td>

<td></td>
</tr>
</table>

<h3>
Invoke</h3>

<ul>Menu: Format | Character Properties
<br>Note that the current selection must not be one of these single HTML
objects: Image, Target, Horizontal Line, or HTML Tag.
<br>In those cases, the Format menu will contain the properties command
for the specific object instead of the default "Character Properties."</ul>

<h3>
Initialization</h3>

<ol>
<li>
Fill in the Font Face combobox.</li>

<ol>
<li>
The first list item is "Variable Width." This is used to represent the
default or "no FACE attribute is set" state. The font used will be the
<i>viewer's
</i>default
browser "variable width font"</li>

<li>
The second item is "Fixed Width," used to indicate text having the "TT"
character style</li>

<li>
The next <b>n</b> items are the list of <b>n</b> OS-specific system fonts.
If possible, include a separator in the list between the 2nd and 3rd items
to differentiate the "real" fonts from the default values. There must be
a limit on the number of font face items allowable (100 is used for Windows.)
If the total number of fonts exceeds this limit, then add an item "Other..."
which should bring up an OS-specific font picker that can handle all the
installed fonts. The OS font list should be sorted alphabetically, but
leave the "variable" and "fixed" items at the top.</li>

<li>
Add the last item: "Don't change," used to undo a font selected (i.e.,
it "unselects" the font face.)</li>

<li>
This control is a true combobox -- it has an editbox field where the user
can type any font face name.</li>
</ol>

<li>
Fill the Font Size combobox. The contents of this list depend on the preference
"editor.fontsize_mode":</li>

<ol>
<li>
Mode = 1: Display just the list of HTML font sizes (-2, -1, 0, 1, 2, 3,
4)</li>

<li>
Mode = 2: Display just the list of font converted point sizes. Each HTML
size value is converted to the local font point size, which depends on
the default base size of the author's "Variable Width Font" and "Fixed
Width Font" from their preferences. The conversion of the HTML size to
point size should be independent of the OS [<i>I need to find out if that
is true in 4.x code</i>.] For example, in Windows, if the default variable
width font is 12pt, then the list of sizes is 8, 10, 12, 14, 18, 36. If
the base size is 10, the list is 7, 8, 10, 12, 15, 20, 30. For modes 1
and 2, the control should be a "drop-down listbox," which only allows the
user to select from values in the list.</li>

<li>
Mode = 3: The list has two parts: The upper part is identical to Mode 1.
The lower part is a fixed list of actual point sizes, to be used with the
"POINT-SIZE" HTML attribute: 8, 9, 10, 11, 12, 14, 16, 18, 20, 22, 24,
26, 28, 36, 48, 72. The dialog control should be a true combobox with an
"editbox" field. This allows setting any arbitrary POINT-SIZE.</li>
</ol>

<li>
<a NAME="GetCharacterAttributes"></a>Get the character attributes of the
current selection. This is complicated by the fact that different attributes
may be set in different parts of the selected text. Thus the dialog must
be able to convey this "mixed" or "indeterminate" state for each attribute.
This is accomplished by using 3-state checkboxes and using "Don't change"
in a combobox or radio button group.</li>
</ol>

<blockquote>&nbsp;
<table BORDER COLS=2 WIDTH="80%" >
<tr>
<th WIDTH="100">HTML Attribute</th>

<th>Dialog Control Setting</th>
</tr>

<tr VALIGN=TOP>
<td>FONT FACE</td>

<td>
<ul>
<li>
If none of the selected text has any FACE or TT attributes, select the
"Variable Width" item</li>

<li>
If all text has TT, select the "Fixed Width" item</li>

<li>
If all text has a font face name, display that name in the editbox part
of the combobox, even if that name doesn't match one in the list.</li>

<li>
If only part of the text has TT or a particular FACE value, leave the combobox
unselected (the editbox is empty) to indicate the mixed state. Also display
the text "The selection contains more than one font" in the message area
below the font face combobox.</li>
</ul>
</td>
</tr>

<tr VALIGN=TOP>
<td>FONT COLOR</td>

<td>
<ul>
<li>
If the same color is set for all selected text, set the color swatch in
the Font Color Picker control to the that color and set the radio buttons
to the left of the color picker to "Use color"</li>

<li>
If no color is set, Set the color swatch in the Font Color Picker control
to the current browser's default font color and set the radio buttons to
"Don't change"</li>

<br><i>Note: the current version sets it to "Use color" I think this is
wrong.</i>
<li>
If a color is set for only part of the text (mixed state), don't set the
color swatch in the color picker and set the radio buttons to select "Don't
change"</li>
</ul>
</td>
</tr>

<tr VALIGN=TOP>
<td>FONT SIZE
<br>FONT POINT-SIZE</td>

<td>Initialization of the Font Size combobox depends on the preference
"editor.fontsize_mode":
<br>The combobox should be a "dropdown list" without an edit field for
Modes 1 and 2.
<br>The combobox should allow user editing of the point size for Mode 3.
<ul>
<li>
For all modes: If all text has the same SIZE attribute value, select the
appropriate item in the combobox</li>

<li>
Modes 1 and 2:</li>

<ul>
<li>
If none or only part of the text has a particular SIZE value, leave the
combobox unselected (empty box)</li>

<li>
Ignore the POINT-SIZE attribute</li>
</ul>

<li>
Mode 3:</li>

<ul>
<li>
If all of the text has the same POINT-SIZE attribute value, show that value
in the editbox even if it doesn't match a point value in the list.</li>

<li>
If none or part of the text has a particular SIZE or POINT-SIZE value,
leave the editbox empty.</li>
</ul>
</ul>
Set the message to the right of the font size combobox depending on the
size mode:
<ul>
<li>
Text for Mode 1 or 2:</li>

<br>"The font size is based on your font preference settings.
<br>The font may not appear in this size in other browser windows."
<li>
Text for Mode 3</li>

<br>"Most web pages use relative font size scale (-2 to +4).
<br>Absolute point size will display correctly only in Navigator 4.0 +"</ul>
</td>
</tr>

<tr VALIGN=TOP>
<td>B, I, U, STRIKE, SUP, SUB, BLINK, NOBR</td>

<td>
<ul>
<li>
If a particular attribute is set for all text, select the appropriate checkbox
and set the checkbox style to the normal 2-state checkbox.</li>

<li>
If a particular attribute is not set for all text, uncheck the appropriate
checkbox and set the checkbox style to the normal 2-state checkbox.</li>

<li>
If part of the text has an attribute,&nbsp; and set the checkbox style
to the 3-state type set the initial state to show the mixed (3rd) state
of the checkbox</li>
</ul>
</td>
</tr>
</table>
</blockquote>

<h3>
Dialog Rules</h3>

<blockquote>&nbsp;
<table BORDER COLS=2 WIDTH="80%" >
<tr>
<th WIDTH="100">User Action</th>

<th>Response</th>
</tr>

<tr VALIGN=TOP>
<td>Change the selected item in the font face combobox (except "Other"
and "Don't change")</td>

<td>Change the message under the font face combobox to describe the selected
font:
<ul>
<li>
If selected item is "Variable Width", use text:</li>

<br>"Displays the Variable Width font of the viewer's browser"
<li>
If item is "Fixed Width", use:</li>

<br>"Displays the Fixed Width font of the viewer's browser"
<li>
If item is a font name that matches one the "font group" fonts, use:</li>

<br>"Displays a similar-looking font on all computers"
<li>
If any other OS-specific font is selected, use:</li>

<br>"This font displays correctly only when the viewer has this font installed"
<li>
If the "Other..." or "Don't change" items are selected, remove the message
under the combobox or display an empty string.</li>
</ul>
</td>
</tr>

<tr VALIGN=TOP>
<td>Edit the font name in the combobox or select the "Don't change" item
at the bottom of the list</td>

<td>Remove the message (by displaying an empty string under the font face
combobox.)</td>
</tr>

<tr VALIGN=TOP>
<td>Check the Superscript or Subscript checkbox</td>

<td>The Superscript and Subscript attributes should be mutually exclusive,
thus if one of these checkboxes is checked, automatically uncheck the opposite
attribute.</td>
</tr>
</table>
</blockquote>

<h3>
Actions</h3>

<blockquote>&nbsp;
<table BORDER COLS=2 WIDTH="80%" >
<tr>
<th WIDTH="100">User Action</th>

<th>Response</th>
</tr>

<tr VALIGN=TOP>
<td>Select the "Other..." item in the Font Face combobox</td>

<td>Popup the OS-specific font selector to let the user select any font
installed in the system. The resulting font face name should be displayed
in the font face editbox if user closed the font selector with "OK".</td>
</tr>

<tr VALIGN=TOP>
<td>Click on the Color Picker button</td>

<td>Popup the <a href="ColorPickerWidget.html">Color Picker Widget</a></td>
</tr>

<tr VALIGN=TOP>
<td>Click the "Remove Style Settings" button</td>

<td>Clear all checkboxes in the "Style" group.</td>
</tr>

<tr VALIGN=TOP>
<td>Click the "Remove All Settings" button</td>

<td>
<ol>
<li>
Clear all checkboxes in the "Style" group</li>

<li>
Clear the font FACE, COLOR, and&nbsp; SIZE attributes</li>

<ol>
<li>
Font Face combobox should show "Variable Width"</li>

<li>
Font Color should show the default browser color in the color button and
check the "Use color" checkbox</li>

<li>
The font size combobox should select the third item in the list, which
is "0" for modes 1 and 3, or the point size that maps to the "0" HTML SIZE
for mode 2.</li>
</ol>
</ol>
</td>
</tr>

<tr VALIGN=TOP>
<td>Click on Apply or OK</td>

<td>
<ol>
<li>
Get the value from the font size combobox's edit field and validate it</li>

<ul>
<li>
A blank value (resulting from an initialization that is multiple fonts
or the user selected "Don't change") means we should ignore size attributes</li>

<li>
If value is in the range -2 through 4, consider it to be an SIZE attribute
value, not a POINT-SIZE value.</li>

<li>
If we are in mode 3:</li>

<ul>
<li>
Accept a number between 5 and 1000 as a POINT-SIZE value</li>

<li>
For numbers outside of the accepted range or the editbox didn't contain
a valid number:</li>

<ol>
<li>
Popup the <a href="MiscDialogs.html#NumericRangeError">Numeric Range Error</a>
dialog using -2 as the minimum and 1000 as the maximum.</li>

<li>
Set the focus and select all text in the font size combobox to show where
the error occured.</li>
</ol>
</ul>
</ul>

<li>
Get all other dialog control settings and convert to the appropriate attribute.</li>

<ul>
<li>
Use the blank (i.e. "Don't change") in a combobox or the 3rd checkbox state
to suppress making any change to a particular attribute.</li>

<li>
If a checkbox is unchecked, remove the relevant attribute.</li>

<li>
If "Variable Width" is selected in the font face combobox, remove the FACE
and TT attributes.</li>

<li>
If "Fixed Width" is selected in the font face combobox, remove the FACE
attribute and set the TT attribute instead.</li>

<li>
If the FACE attribute is set, remove the TT attribute.</li>
</ul>

<li>
Apply attributes to all text elements in the original selection.</li>
</ol>
</td>
</tr>
</table>
</blockquote>

<h2>

<hr ALIGN=LEFT WIDTH="100%">2.&nbsp;<a NAME="LinkProperties"></a>Link Properties</h2>

<table BORDER=0 CELLSPACING=2 CELLPADDING=2 >
<tr VALIGN=TOP>
<td>Windows:</td>

<td>Mac:</td>

<td>UNIX:</td>
</tr>

<tr VALIGN=TOP>
<td>Appearance when some text is selected when invoked:
<br><img SRC="PropsLinkTab_W.gif" BORDER=0 height=387 width=461>
<p><a NAME="InsertLinkScreenShot"></a>Link Source region when no text is
selected (inserting a new link):
<br><img SRC="PropsLinkNew_W.gif" height=82 width=461>
<p><a NAME="LinkedImageScreenShot"></a>Top region when an image is selected
or will be inserted:
<br><img SRC="PropsLinkImage_W.gif" height=134 width=460>
<br>&nbsp;</td>

<td></td>

<td></td>
</tr>
</table>

<h3>
Invoke</h3>

<ul>
<li>
Menu: Format | Character Properties, then click on the Link tab.</li>

<br>If the insert point (caret) or left edge point of the selection is
inside of text that is a link, selecting "Character properties" will automatically
put the focus in the Link dialog pane.
<li>
When creating a link:</li>

<ul>
<li>
Menu: Insert Link.</li>

<li>
In the popup context menu: "Insert New Link" or "Create Link Using Selected"</li>

<li>
Click on the "Link" toolbar button</li>
</ul>
</ul>

<h3>
Initialization</h3>

<ol>
<li>
Get the current selection in the document</li>

<ul>
<li>
If selection is just an image or we are inserting an new image</li>

<ol>
<li>
The first pane is the <a href="ImageDialogs.html#ImageProperties">Image
Properties</a>, as shown in the <a href="#LinkedImageScreenShot">screen
shot</a> above.</li>

<li>
In the "Link Source" group area, display the label "Linked Image".</li>

<li>
Hide the editbox used to enter text when creating a new link (the "source
text editbox.")</li>

<li>
<a NAME="SetupLinkedImage"></a>Set the "Linked Image" URL string:</li>

<ol>
<li>
Get the image URL (the SRC attribute) for the image element.</li>

<ul>
<li>
If an image URL exists, display it as static text under the "Linked Image"
label. (This is in exactly the same location as the hidden editbox used
to enter new link text.)</li>

<li>
If no image name exists yet (we must be inserting a new image), display
the text "(No image URL supplied)" instead. <i>Note: this is an suggested
enhancement. In the current implementation, we act as if there's no image
and show the Linked text label and editbox instead. This doesn't seem correct.</i></li>
</ul>

<li>
If an image exists and it is already a link, get the URL for that link
and show it in the editbox in the "Link to" region. This editbox is used
to edit the HREF value of the link tag, so I will refer to it as the "HREF
editbox."</li>
</ol>
</ol>

<li>
If selection is not an image and we are not inserting an image:</li>

<ol>
<li>
The first pane is the <a href="#CharacterProperties">Character Properties</a>.</li>

<li>
Setup the "Link Source" controls:</li>

<ul>
<li>
If there is selected text:</li>

<ol>
<li>
Display the text label "Linked text"</li>

<li>
Get the selected text (plain text without any character attributes) and
display it as static text under the label, but truncate it to a size to
fit on one line of the dialog. (This is the same text control used to show
the image URL if the link is an image.)</li>
</ol>

<li>
No selected text (Caret is visible instead, so we are inserting a new link.
See the <a href="#InsertLinkScreenShot">screen shot</a> above.)</li>

<ol>
<li>
Display the label "Enter text to display for a new link"</li>

<li>
Hide the static text control that is used to show the linked text or linked
image URL.</li>

<li>
Show the "source text editbox" where user can enter text for the link.
(The location is exactly the same as the hidden static text.)</li>
</ol>
</ul>
</ol>
</ul>

<li>
If the insert point (caret or left edge of selection) is in an existing
link, show the URL for that link in the HREF editbox.</li>

<li>
<a NAME="SetupTargetList"></a>Setup the Targets (named anchor) list</li>

<ul>
<li>
If there is an existing link URL that is a local file:</li>

<ol>
<li>
Search that file for all target tags (&lt;A NAME="MyTarget">) and fill
the listbox with the target names (if any).</li>

<li>
If at least one target was found, set the text label above the listbox
to: "Select a named target in the specified file (optional)"</li>

<li>
Select "Selected File" in the radio button group to the right of the listbox</li>
</ol>

<li>
<a NAME="SetupPageTargets"></a>For any other condition, use the current
document:</li>

<ol>
<li>
Fill the listbox with the targets from the current document</li>

<li>
If at least one target was found, set the text label above the listbox
to: "Select a named target in the current page (optional)"</li>

<li>
Select "Current Page" in the radio button group to the right of the listbox</li>
</ol>

<li>
If no targets were found for either the current document or a local file,
set the label above the listbox to "(No targets in selected file)" and
select the "Current Page" radio button.</li>
</ul>

<li>
<a NAME="SetupRemoveLinkButton"></a>Set the enable/disable state of the
"Remove Link" button:</li>

<ul>
<li>
If the document selection contains any links or the HREF editbox is not
empty, enable the button.</li>

<li>
If the HREF editbox is empty and the document selection does not contain
any links, disable the button.</li>
</ul>

<li>
Save the current contents in the HREF editbox as the "last good HREF."</li>
</ol>

<h3>
Dialog Rules</h3>

<blockquote>&nbsp;
<table BORDER COLS=2 WIDTH="80%" >
<tr>
<th WIDTH="100">User Action</th>

<th>Response</th>
</tr>

<tr VALIGN=TOP>
<td>Select the "Current page" or "Selected file" radio button</td>

<td>
<ul>
<li>
If the current radio button selected is "Current page" and the user selected
"Selected file",&nbsp; get the link URL from the editbox and try to <a href="#SetupTargetList">build
the target list</a> as described above. Note that if the current URL is
not a valid local file, this will end up defering to the current document,
so to the user it will seem like they can't click on the "Selected file"
button because the "Current page" radio button will be automatically re-selected.</li>

<li>
If the current radio button selected is "Selected file" and the user selected
"Current page", get the link URL from the editbox and try to <a href="#SetupPageTargets">build
the target list from the current document</a> as described above.</li>
</ul>
</td>
</tr>

<tr VALIGN=TOP>
<td>Select a target from the Targets listbox</td>

<td>Get the selected target name from the list
<ul>
<li>
If the "Current page" radio button is set, simply append the hash character
at the beginning of the string and use that as the link URL editbox contents.</li>

<li>
If "Selected file" radio button is set:</li>

<ol>
<li>
Get the link URL editbox contents</li>

<li>
Strip any existing target from the URL (everything after the "#").&nbsp;</li>

<li>
Append a "#" character if no existing target was found.</li>

<li>
Append the selected target name and reset the link URL editbox contents
to the new string.</li>
</ol>
</ul>
</td>
</tr>

<tr VALIGN=TOP>
<td>Change the link URL:
<ul>
<li>
Edit the text, select a filename using the "Choose File" button, or</li>

<li>
Use the "Remove Link" button.</li>
</ul>
</td>

<td>
<ol>
<li>
Get the text from the URL editbox and strip any whitespace from the beginning
and end</li>

<li>
<a href="#SetupTargetList">Rebuild the Target list</a> as described above.</li>

<li>
<a href="#SetupRemoveLinkButton">Reset the "Remove Link"</a> button's enable
state as described above.</li>
</ol>
</td>
</tr>

<tr VALIGN=TOP>
<td>Click on the "Link" tab to switched to this pane from another pane</td>

<td>If the first pane is the Image Properties,&nbsp; <a href="#SetupLinkedImage">update
the "Linked image" string</a> as described above.</td>
</tr>

<tr VALIGN=TOP>
<td>
<ul>
<li>
User changes focus from HREF editbox, or</li>

<li>
After selecting a file with "Choose File" button, or</li>

<li>
User tries to change to a different tabbed pane.</li>
</ul>
</td>

<td><a NAME="ValidateHREF"></a>Validate the contents of the HREF editbox:
<ol>
<li>
Remove excess whitespace from beginning and end of string</li>

<li>
Convert string to URL format. Strings typed in local file format (e.g.,
"d:\specs\Composer.html") are converted into the file URL format ( "file:///d|specs/Composer.html")
if they are fully qualified (i.e., the drive letter is included.) Windows
backslashes "\" are always changed to web/UNIX style forward slashes "/".&nbsp;</li>

<li>
Convert URL to be relative to the current document's URL. For example:
Assume document URL is "http://webgroup/ComposerEngSpec.html"&nbsp; A link
enterred as "http://anyplace/anyfile.html" or "TableSpec.html" will be
not be changed. A link URL such as "http://webgroup/docs/MoreSpecs.html"
would be changed to "../docs/MoreSpecs.html".</li>

<li>
This conversion returns a result code that tells us if the relativized
URL is on the same device as the document URL. If it is not, for example,
using the above document URL but the link is to "file:///d|SpecsComposer.html",
and the editor preference "editor.publish_keep_links" is set, then warn
the user using a simple Yes/No dialog with this message:</li>

<br>"file:///d|SpecsComposer.html&nbsp;&nbsp; <i><font size=-1>&lt;fill
in user's URL here</font></i>
<br>is on a different device than the current page.
<br>Link will not work if page is accessed remotely.
<br>Do you want to use this link anyway?"
<li>
Set the HREF editbox contents:</li>

<ul>
<li>
If user answered "No" to the different-device inquiry or there was some
other error, copy the "last good HREF" to the HREF editbox.&nbsp;</li>

<li>
Otherwise, copy the validated URL to the both the HREF editbox and the
"last good HREF string."&nbsp;</li>
</ul>

<li>
To avoid duplicated validations, maintain a boolean to monitor whether
or not the HREF editbox has been validated since its contents were last
changed.</li>
</ol>
</td>
</tr>
</table>
</blockquote>

<h3>
Actions</h3>

<blockquote>&nbsp;
<table BORDER COLS=2 WIDTH="80%" >
<tr>
<th WIDTH="100">Click Button</th>

<th>Response</th>
</tr>

<tr VALIGN=TOP>
<td>Choose File</td>

<td>Popup the OS-specific Open File dialog and let user select a file.&nbsp;
Use the caption "Link to File" for this dialog. If they do not cancel from
that dialog, <a href="#ValidateHREF">validate the entry</a> (as described
above) and display the user's filename URL in the HREF editbox if it is
valid.</td>
</tr>

<tr VALIGN=TOP>
<td>Remove Link</td>

<td>
<ol>
<li>
Clear the contents of the HREF editbox</li>

<li>
Execute the "Remove Link" command (as in the Edit menu) on the selected
text in the document.</li>

<li>
<a href="#SetupRemoveLinkButton">Reset the "Remove Link"</a> button's enable
state as described above.</li>
</ol>
</td>
</tr>

<tr VALIGN=TOP>
<td>Extra HTML</td>

<td>Popup the <a href="MiscDialogs.html#Extra HTML Dialog">Extra HTML</a>
dialog and save the resulting string as the "extra HTML" for the HREF element.</td>
</tr>

<tr VALIGN=TOP>
<td>OK or Apply</td>

<td>
<ol>
<li>
Get and <a href="#ValidateHREF">validate the URL</a> from the HREF editbox.</li>

<li>
Remove any existing Anchor tags (or in DOM: HTMLLinkElements) within the
current selection</li>

<li>
Insert new source elements:</li>

<ul>
<li>
If we have inserted an image (done by the <a href="ImageDialogs.html#ImageProperties">Image
Properties pane</a>, <i>whoose "Apply" method must be executed first!</i>),
set the selection as that image.</li>

<li>
If we are using the source text editbox, get that text&nbsp; and insert
it into the document at the current insert point. Set the selection as
this text.</li>
</ul>

<li>
Surround the selection in a new Anchor tag (or HTMLLinkElement) using the
new HREF value.</li>

<li>
If OK was used and we inserted an image or text, unselect the insertion
and place the caret after the inserted element(s).&nbsp;</li>

<li>
If we inserted new source text, be sure there is a non-linked space before
and after the inserted text block and that the new caret position is to
the right of a non-linked space at the end. This is currently achieved
by always padding the inserted block with spaces, but I suggest we should
also check before and after the insertion to avoid 2 spaces at the link
borders.</li>
</ol>
</td>
</tr>
</table>
</blockquote>

<h3>
Enhancements</h3>

<blockquote>
<li>
Reconsider the inclusion or design of the "Remove Link" button. We currently
use this button to remove links within the page as well as the trivial
use of just clearing the HREF editbox. It is the only place where a button
other than "Apply" changes properties in the page. Should we continue this
behavior?</li>
</blockquote>

<h2>

<hr ALIGN=LEFT WIDTH="100%">3.&nbsp;<a NAME="ParagraphProperties"></a>Paragraph
Properties</h2>

<table BORDER=0 CELLSPACING=2 CELLPADDING=2 >
<tr VALIGN=TOP>
<td>Windows:</td>

<td>Mac:</td>

<td>UNIX:</td>
</tr>

<tr VALIGN=TOP>
<td><img SRC="PropsParaTab_W.gif" BORDER=0 height=387 width=461></td>

<td></td>

<td></td>
</tr>
</table>

<h3>
Invoke</h3>

<h3>
Initialization</h3>

<ol>
<li>
Get the current paragraph and list style of the current selection and save
as local variables ("current paragraph style" and "current list style").
Currently, this is whatever the settings are at the left edge of the selection
(we ignore styles in other paragraphs in the selection). We should consider
changing this as described in Enhancements.</li>

<li>
Fill the Paragraph style combobox list with available paragraph styles.
We currently support Normal (BR or P), Headings 1 through 6 (H1 - H6),
Address (ADDRESS), Preformated (PRE), List item (LI), Term name (DT), and
Definition (DD)</li>

<li>
Fill the Additional style list with 3 items: Default (no attribute), List
(LL), and Blockquote (BLOCKQUOTE).</li>

<br><i>Suggested change: </i>Replace this listbox with a checkbox that
is labeled: "Indent the paragraph using Blockquote"
<li>
Fill the List Style combobox list with "Bulleted (Unnumbered) list" (UL),
"Numbered List" (OL), and "Definition list" (DL).</li>

<br>Note: The 4.x versions also include "Directory list" and "Menu list"
but these were dropped in the initial 5.0 redesign.
<li>
<a NAME="InitListStyle"></a>Set the selected item in the List style combobox
from the current list style (UL, OL, or DL.)</li>

<br>If we are not in a Bullet, Numbered, or Definition list, disable the
list style combobox and show no selected item.
<li>
<a NAME="InitBlockquote"></a>Set the selected item in the Additional style
combobox (<i>or the state of the "Indent paragraph using blockquote" checkbox)</i></li>

<ul>
<li>
If the list style is set (it is OL, UL, or DL), select "List"</li>

<br><i>Using suggested change: </i>Uncheck the Blockquote checkbox
<li>
If the paragraph is in a BLOCKQUOTE, select "Blockquote"</li>

<br><i>Using suggested change: C</i>heck the Blockquote checkbox
<li>
If the paragraph is not in a list or a blockquote, select "Default"</li>

<br><i>Using suggested change: </i>Uncheck the Blockquote checkbox</ul>

<li>
<a NAME="InitParagraphStyle"></a>Set the selected item in the Paragraph
style combobox according to the current paragraph style, and enforce the
following rules:</li>

<ul>
<li>
If the current list style is Bullet or Unnumbered list, the current paragraph
style must be "List item" (LI)</li>

<li>
If there current list style is Definition, the paragraph must be either
a "Term name" (DT) or "Definition" (DD) style</li>

<br>(If it is not currently "Definition", change it to "Term name".)
<li>
A paragraph in a blockquote can have any paragraph style except for list-specific
types: List item, Term name, or Definition</li>

<br>(If current style is one of those list styles, change it to "Normal")</ul>

<li>
<a NAME="InitBulletStyle"></a>Initialize the Bullet Style listbox and Start
number editbox:</li>

<ul>
<li>
If the List style is "Bullet List":</li>

<ol>
<li>
Set the text above the bullet style combobox to "Bullet style:"</li>

<li>
Fill combobox with "Automatic", "Solid circle", "Open circle", and "Solid
square"</li>

<li>
Disable the editbox to the right of the "Starting number" static text</li>
</ol>

<li>
If the List style is "Numbered List":</li>

<ol>
<li>
Set the text above the bullet style combobox to "Number style:"</li>

<li>
Fill the combobox with "Automatic", "1, 2, 3...", "I, II, III..." (upper
case Roman numerals), "i, ii, iii..." (lower case Roman numerals), "A,
B, C...", and "a, b, c..."</li>

<li>
Enable the "Starting number" editbox</li>

<li>
First time only: Get the current Starting Number (START) value from the
numbered list (OL) tag and save locally as the "current starting number"</li>

<br>If it is not set, use set it to the default = 1.
<li>
Fill starting number editbox with the current starting number.</li>
</ol>
</ul>

<li>
Set the alignment radio button according to the current alignment. Again,
we currently only consider the alignment attribute at the left edge of
the selection. Should we scan all paragraphs in the selection?</li>
</ol>

<h3>
Dialog Rules</h3>

<blockquote>&nbsp;
<table BORDER COLS=2 WIDTH="80%" >
<tr>
<th WIDTH="100">User Action</th>

<th>Response</th>
</tr>

<tr VALIGN=TOP>
<td>Change selected item in the Paragraph style combobox</td>

<td>
<ol>
<li>
Set the current paragraph style to the selected item</li>

<li>
Change the current list style if necessary:</li>

<ul>
<li>
If the new paragraph style is "List Item", the list style must be either
Bullet list or Numbered list. (If it is anything other than Numbered, change
it to Bullet style.)</li>

<li>
If the new paragraph style is "Term name" or "Definition", the list style
must be "Definition"</li>
</ul>

<li>
Update the <a href="#InitBlockquote">Additional style</a>, <a href="#InitListStyle">List
style</a>, and <a href="#InitBulletStyle">Bullet style</a> comboboxes as
described above</li>
</ol>
</td>
</tr>

<tr VALIGN=TOP>
<td>Change selected item in the Additional style combobox
<br>(or change the Blockquote checkbox)</td>

<td>In the current implementation with the "Additional style" combobox:
<ul>
<li>
Select "Blockquote":</li>

<ol>
<li>
Change the current paragraph style if necessary: If it is "List item",
"Term name" or "Definition", change it to "Normal"</li>

<li>
Update the <a href="#InitParagraphStyle">Paragraph style</a>, <a href="#InitListStyle">List
style</a>, and <a href="#InitBulletStyle">Bullet style</a> comboboxes as
described above.</li>
</ol>

<li>
Select "Default" or "List":</li>

<ol>
<li>
Change the current list style if necessary:</li>

<ul>
<li>
If "Default" was selected, set current list style to "none".</li>

<li>
If "List" was selected and the current list style is "none", set it to
Bullet List.</li>
</ul>

<li>
Update the <a href="#InitParagraphStyle">Paragraph style</a>, <a href="#InitListStyle">List
style</a>, and <a href="#InitBulletStyle">Bullet style</a> comboboxes as
described above.</li>
</ol>
</ul>
<i>Suggested improvement using "Blockquote" checkbox instead:</i>
<ul>
<li>
If checkbox is now checked (and it wasn't before), do all steps above for
"Select Blockquote".</li>

<li>
If checkbox is now unchecked (and it was before), set the list style to
"none".</li>

<br>&nbsp;
<p>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<p>Update the <a href="#InitParagraphStyle">Paragraph style</a>, <a href="#InitListStyle">List
style</a>, and <a href="#InitBulletStyle">Bullet style</a> comboboxes as
described above.</ul>
</td>
</tr>

<tr VALIGN=TOP>
<td>Change selected item in the List style combobox</td>

<td>
<ol>
<li>
Set the "current list style" to the selected item</li>

<li>
Change the paragraph style if necessary:</li>

<ul>
<li>
If the new list style is Bullet or Unnumbered, the paragraph style must
be a List item</li>

<li>
If the new list style is Definition, the paragraph style must be "Term
name" or "Definition"</li>

<br>(If the current paragraph style is anything other than Definition,
change it to Term name.)</ul>

<li>
Update the <a href="#InitParagraphStyle">Paragraph style</a>, <a href="#InitBlockquote">Additional
style</a>, and <a href="#InitBulletStyle">Bullet style</a> comboboxes as
described above.</li>
</ol>
</td>
</tr>
</table>
</blockquote>

<h3>
Actions</h3>

<blockquote>&nbsp;
<table BORDER COLS=2 WIDTH="80%" >
<tr>
<th WIDTH="100">Click Button
<br>User Action</th>

<th>Response</th>
</tr>

<tr VALIGN=TOP>
<td>OK or Apply</td>

<td>
<ol>
<li>
Get the new Paragraph style, Additional style, and List style from the
comboboxes (or checkbox state)</li>

<br>If the above rules have been followed, further testing for compatability
should not be necessary.
<li>
By comparing the original Paragraph and List styles to the new states,
determine the changes that need to be made to the document:</li>

<ul>
<li>
If we are changing from an existing list or blockquote to style = "none",
remove all lists and blockquotes. This is essentially outdenting or deletion
of all "container" tags (or DOM nodes that are list or blockquote elements)
until the paragraph is no longer a child of a list element.</li>

<li>
If we are changing from a list style (OL, UL, or DL) to Blockquote, change
all parent list tags to the Blockquote style. This must be done to enforce
the rule that only certain paragraph styles are allowed within lists, so
we don't want to have a Blockquote as a child of a list.</li>

<li>
If we are changing from Blockquote to any list style, or from Numbered
to Bullet, or from Bullet to Numbered, change the existing List or Blockquote
tag into the new List style. (Or delete 1 level and insert one new list
tag of the new type.)</li>

<br>Note that a list is allowed to be nested inside of a Blockquote, but
not vice versa.
<li>
If changing from a Bullet or Numbered list to a Definition list, or from
a Definition list to a Bullet or Numbered list:</li>

<ol>
<li>
Outdent to remove all existing list levels.</li>

<li>
Insert one tag of the new type as the parent of the paragraph</li>
</ol>

<li>
If we were not in a list before (list type = "none") and we are changing
to a List or Blockquote style, insert one tag of the new type as the parent
of the paragraph.</li>
</ul>

<li>
Set the paragraph style for all paragraphs in the current selection. This
also involves appropriate deletion and insertion of paragraph elements
that are parents of the selected text and image element.</li>

<li>
Get the new Alignment value from the radio buttons and set the alignment
for current selection. To reduce unecessary tags, if "Left" is selected,
clear the alignment style, since the default alignment is left, except
when paragraph is in a Table Header tag (TH). In this case, we must explicitly
set the "Left" alignment since the default is "Center" for this tag.</li>

<br><i>Note: We should examine this behavior carefully when using HTML
4 and style sheets since these default assumptions might not hold any more.</i></ol>
</td>
</tr>
</table>
</blockquote>

<h3>
Enhancements</h3>

<ol>
<li>
We currently get the starting paragraph and list types only for the left
edge of the selection. We should probably get the style for the full range
selected, which would require us to deal with "mixed states" as we do with
the <a href="#GetCharacterAttributes">Character attributes</a>. This would
necessitate having a "Don't change" item in the paragraph and list styles
comboboxes.</li>

<li>
The current implementation, especially the use of the "Additional style"
combobox, is complicated by the somewhat confusing rules of HTM. For example,
the paragraph styles for each list type are constrained as described above,
but the Blockquote is kind of a hybrid. Internally, it is similar to a
list style in that it causes indentation and is a "parent" container of
the paragraph(s). But it doesn't have the strict containment limitations
as does the Bullet, Numbered, and Definition lists. The current implementation
allows those rules to be reinforced at the expense of some clarity to the
user. Since the main purpose for the combobox is to support Blockquote,&nbsp;
we might instead use a <a href="#InitBlockquote">checkbox as described
above</a>. The downside of this is that it may not be entirely clear to
the user why this checkbox is being turned off automatically (when a list
style is selected), and it might not be clear that they have to select
either "List item", "Term name", or "Definition" for the paragraph style
before the List style and Bullet style comboboxes are enabled. At least
with the current implemetation, the existence of the "List" item in the
Additional style combobox is an additional way to enable the list comboboxes.
Here is a screen shot with this new checkbox:</li>

<br><img SRC="PropsParaTabNew_W.gif" height=318 width=441>
<li>
This screen shot also shows an "Indent level" editbox and static text,
which might also be a useful addition. It is simply the number of nested
&lt;BLOCKQUOTE> levels of the paragraph. This would allow indenting or
outdenting multiple levels at a time.</li>
</ol>





<P><BR>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>
<TR>


<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>
</TR>

<TR>

<TD BGCOLOR="#000000" COLSPAN=6><BR></TD>

<TD BGCOLOR="#000000" VALIGN=TOP>

<FONT COLOR="#AAAAAA" SIZE="-1">
Copyright &copy; 1998 The Mozilla Organization.
</FONT>

</TD>

<TD BGCOLOR="#000000" COLSPAN=2><BR></TD>
</TR>

</TABLE>
<P>
</BODY>
</HTML>
