<HTML>
<HEAD>
<TITLE>New Layout: View System</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT=0 MARGINWIDTH=0>

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP ROWSPAN=2><IMG
SRC="../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH=600 HEIGHT=58 VSPACE=0 HSPACE=0></TD></TR></TABLE>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=TOP><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ROWSPAN=2>

<BR><TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../..//"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../mission.html"> Our Mission</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../about.html"> Who We Are</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../get-involved.html"> Getting Involved</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../community.html"> Community</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../advocacy.html"> Editorials</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../news.html"> What's New</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../development.html"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../blue-sky/"> Blue Sky</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../projects.html"> Projects</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../source-code.html"><B> Source Code</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../source.html"> Getting It</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../docs/"> Documentation</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../NPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../bugs/"> Bugs</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../search"><B> Search</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../feedback.html"><B> Feedback</B></A></TD></TR>
</TABLE><BR>

</TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=TOP><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ROWSPAN=2>
<P><BR>






<HR WIDTH="100%"><h2>New Layout: View
System</h2>
Author: <a href="mailto:michaelp@netscape.com">Michael 
Plitkins</a> <BR>
Last update: 1May98
<HR WIDTH="100%">
<BR>
<TABLE COLS=1 WIDTH="70%" >
<TR BGCOLOR="#FFFFCC">
<TD><B>Overview</B></TD>
</TR>
</TABLE>
 The NGLayout views subsystem 
is designed to support arbitrary positioning, sizing and depth sorting of overlapping 
rectangles of content in a platform independent fashion. Most NGLayout rendering 
operations begin by "damaging" a portion of the area currently being displayed 
on an output device and then walking over a view tree in z depth order allowing 
each view to repair parts of the damaged area they occupy. Event handling within 
NGLayout also goes through the view system giving view objects the first opportunity 
to handle event processing (within each view, there is generally content represented 
by layout Frames that do most of the real event processing). View update operations 
can either happen in an offscreen buffer or directly on the output device depending 
onthe complexity of the anticipated update. Timed refreshes also occur allowing 
many damage requests to be processed as a single update to the output device. 
In addition to representing specially positioned content, a view may also represent 
an underlying platform native window through it's association with the Widget 
subsystem. The Widgets can be used to represent application controls such as scrollbars 
and top level windows and content objects such as HTML form elements. See the 
Widgets documentation for further information. <BR>

<BR>
<TABLE COLS=1 WIDTH="70%" >
<TR BGCOLOR="#FFFFCC">
<TD><B>Major Components</B></TD>
</TR>
</TABLE>
Currently, there are three different
classes within the view system. Naturally, more can be added as deemed
necessary:
<UL>
<LI>
Basic View class responsible for positioning,
sizing, painting and event handling as a container for underlying content.</LI>

<LI>
Scrolling View which has a private child
view representing a scrollbar and additional methods for handling the scrolling
of one more view that the owner of the scrolling view can add as a child
of the scrolling view.</LI>

<LI>
View Manager which coordinates all operations
done to/through the view hierarchy including:</LI>

<UL>
<LI>
child view insertion, removal and sorting.</LI>

<LI>
event handling.</LI>

<LI>
painting.</LI>

<LI>
view state changes (position, size,
clip rect, z index, visibility)</LI>
</UL>
</UL>

<TABLE COLS=1 WIDTH="70%" >
<TR BGCOLOR="#FFFFCC">
<TD><B>Implementation</B></TD>
</TR>
</TABLE>
1. View Manager.
<BLOCKQUOTE> Applications
create views and then added them to the view hierarchy through the view
manager. From that point on, the application requests that changes be made
to views via the view manager. This allows the view manager to "do the
right thing" when views are changed. Typically this means minimizing damage
repair area and frequency. As mentioned previously, views are arranged
in a hierarchy. The relationship of sibling views is maintained through
either an absolute z index for each view, or above/below relative to another
view. When the view hierarchy is traversed, views are encountered in top
down order and from nearest z to furthest z.

<P> The view manager
contains a "compositor" which processes the view tree at rendering time
to optimally paint the damaged area. This involves determining if any of
the layers are "transparent" and then doing back-to-front/front-to-back
view processing to repair the damage. Views currently have an opacity property
that the compositor will use to alpha blend views together.</BLOCKQUOTE>
2. View class.
<BLOCKQUOTE> This
is the base view class and the one generally created by content that requires
a view. Examples of such content are CSS positioned elements, Communicator
4 layers, objects that require Widgets such as form elements, etc. Since
views are designed to act as containers for content, there is a link to
that content which can be set and queried with the Get/SetFrame() methods.
When views need to paint or have events handled that do not relate to the
view, the frame's Paint() and HandleEvent() methods are called.

<P> In general, views
hold state, but don't do much in terms of changing or manipulating other
objects. That job is left to the view manager.

<P> Child views are
not clipped to the boundaries of their parent views unless a cliprect is
specifically set on a view. A clip rect clips the content displayed by
a view and any of it's children.</BLOCKQUOTE>
3. Scrolling view.
<BLOCKQUOTE> The scrolling 
  view, which is used as the root level view for NGLayout documents, is essentially 
  designed to act as a container which expects that it's size will be smaller 
  than the views that it contains. It also assumes that the application will want 
  to be able to scroll over the area that is "inside" of it. As such it will automatically 
  sprout scrollbars when the scrolling view is too small to display all of it's 
  contents. It has additional APIs over the standard view to allow the application 
  to get and set the offset into the visible content area and to recompute the 
  size of the scrollbar thumb and position based on the sizes of the objects that 
  it contains.</BLOCKQUOTE>

<TABLE COLS=1 WIDTH="70%" >
<TR BGCOLOR="#FFFFCC">
<TD><B>Dependencies</B></TD>
</TR>
</TABLE>

<UL>
<LI>
Currently the view system is tied to
the layout system in two places. The first is the previously mentioned
Set/GetFrame() method in the view class. The second is layout's Presentation
Context which the view manager holds onto and then passes to the Frames
in their Paint() methods.</LI>

<LI>
Since views may have Widgets associated
with them, and as views change shape they need to tell the Widgets about
these changes, there is a dependency on the Widget library.</LI>

<LI>
Much of what the view manager does involves
output refresh management so it has knowledge of the graphics system.</LI>

<LI>
Eventually there will be a tie to the
DOM/JavaScript for event handling.</LI>

<LI>
We would like to be able to alpha blend
views together.</LI>
</UL>

<TABLE COLS=1 WIDTH="70%" >
<TR BGCOLOR="#FFFFCC">
<TD><B>Roadmap</B></TD>
</TR>
</TABLE>
The top priority is to flesh out the
compositor so that we can begin displaying more complex documents (CSS-p,
layers, etc.) and help to move the layout and style systems toward completion.

<P>Events and the DOM/JavaScript are
the next highest priority. As it stands today, all events originate with
Widgets attached to views. The widgets inform the views that events have
taken place and the views either swallow the events if they don't directly
relate to the content (such as a top-level window resize), or pass them
on to the frames for processing. JavaScript will most likely need to intervene
before events go to frames (for filtering/modification) and after the frames
are done with them (in case the frame altered the event).

<P>In order to create any sort of editor
on top of the whole system, the view manager will need to participate in
the management of selection and an insertion point caret.

<P>Currently, all damage requests to
the view manager are coalesced into a single rect which contains the entire
damage area. This needs to be improved so that we create a region composed
of disparate rects when that would be more efficient. The graphics system
needs to provide a working region class first though.
<BR>
<TABLE COLS=1 WIDTH="70%" >
<TR BGCOLOR="#FFFFCC">
<TD><B>Known Bugs</B></TD>
</TR>
</TABLE>

<UL>
<LI>
Scrolling views do not sprout a horizontal
scrollbar.</LI>

<LI>
Event handling has not been completely
fleshed out. We need to see exactly what the needs of the DOM/JavsScript
are in order to figure out exactly what the event flow will look like.</LI>

<LI>
The compositor has a ways to go before
it is real. Some code can probably be lifted from Mozilla.</LI>

<LI>
Lack of support for regions by the graphics
system means that the view manager region support isn't there either.</LI>

<LI>
There are still some squirrelly little
rendering errors when scrolling and resizing.</LI>
</UL>




<P><BR>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>
<TR>


<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>
</TR>

<TR>

<TD BGCOLOR="#000000" COLSPAN=6><BR></TD>

<TD BGCOLOR="#000000" VALIGN=TOP>

<FONT COLOR="#AAAAAA" SIZE="-1">
Copyright &copy; 1998 Netscape Communications Corporation.
</FONT>
</FONT>
</TD>

<TD BGCOLOR="#000000" COLSPAN=2><BR></TD>
</TR>

</TABLE>
<P>
</BODY>
</HTML>
