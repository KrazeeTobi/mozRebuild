<HTML>
<HEAD>
<TITLE>Autoconf for Mozilla</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT=0 MARGINWIDTH=0>

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP ROWSPAN=2><IMG
SRC="../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH=600 HEIGHT=58 VSPACE=0 HSPACE=0></TD></TR></TABLE>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=TOP><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ROWSPAN=2>

<BR><TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../..//"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../mission.html"> Our Mission</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../about.html"> Who We Are</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../get-involved.html"> Getting Involved</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../community.html"> Community</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../advocacy.html"> Editorials</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../news.html"> What's New</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../development.html"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../blue-sky/"> Blue Sky</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../projects.html"> Projects</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../source-code.html"><B> Source Code</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../source.html"> Getting It</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../docs/"> Documentation</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../NPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../bugs/"> Bugs</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../search"><B> Search</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../feedback.html"><B> Feedback</B></A></TD></TR>
</TABLE><BR>

</TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=TOP><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ROWSPAN=2>
<P><BR>



<font size="6">
<center>Autoconf for Mozilla<br>
<font size="2">Last updated: <i>8/25/98</i>
</center>
<hr>
<font size="3">
<P>
As of 8/19/1998, autoconf support is in the main <a href="http://www.mozilla.org/cvs.html">Mozilla CVS</a> tree.  If you are not interested in using cvs, grab the patches against the release tarball from below.<br>
<h2> Building with CVS</h2>
The <TT>AUTOCONF_1_0</tt> branch has been merged with the <TT>HEAD</TT> branch.  If you wish to see what changes were made to accomodate autoconf, click <a href="http://cvs-mirror.mozilla.org/webtools/bonsai/cvsquery.cgi?module=MozillaSource&branch=AUTOCONF_1_0&branchtype=match&dir=&file=&filetype=match&who=&whotype=match&sortby=Date&hours=2&date=all&mindate=&maxdate=&cvsroot=%2Fcvsroot">here</a>.
<P>
You do <strong>NOT</strong> need to set the old build's environment variables when using autoconf.<br>
The process should look something like:
<pre>
cvs -z3 co MozillaSource 
cd mozilla
autoconf
mkdir obj-`./build/autoconf/config.guess`
cd obj-`./build/autoconf/config.guess`
../configure
make
</pre>
If you are using a fresh tree, don't worry about messages like:</br>
<p><tt>
cvs checkout: move away mozilla/base/macbuild/base.mcp; it is in the way
</tt><p>

<h2> Building with the release tarball</h2>
You will need *both* the moz-autoconf tar and diff files.
<P>
<strong>Files:</strong>
<P>
Latest:
<li> <a href="moz-autoconf-1998073000.tar.gz">moz-autoconf tar 1998073000</a>
<li> <a href="moz-autoconf-1998073000.diff">moz-autoconf diffs 1988073000</a>
<P>
<strong>Process:</strong>
<P>
You will need to grab the 19980728 tarball from <a href="http://www.mozilla.org/download-mozilla.html">Mozilla Downloads</a>.  Untar the mozilla-1990728.tar.gz file. Untar the moz-autoconf tar file in the same directory.  Then apply the moz-autoconf patch from that same directory.<P>
The entire process should look something like:
<pre>
cd /usr/src
tar -xvBpzf ~/mozilla-19980728.tar.gz
tar -xvBpzf ~/moz-autoconf.tar.gz
patch -p0 -s -b --suffix=.ac < ~/moz-autoconf.diff
cd mozilla
mkdir obj-`./config.guess`
cd obj-`./config.guess`
../configure
make
</pre>
<P>
<h2>Notes:</h2>
You will need autoconf 2.12 (which requires GNU m4) or higher to use autoconf with mozilla.<br>
<ul>
If you use gnomefe-ac, you do <strong>NOT</strong> need to apply the Patches file.<br>
qtfe-ac requires Qt 1.40 or greater.<br>
gnomefe-ac builds against the gnome 0.20 release + gnome-config. <br>
</ul>
<P>
Misc files:
<li> <a href="moz-pngheader.diff">patch for pngconf.h</a>
<li> <a href="qglobal.patch">patch for qglobal.h</a> Removes hardcoded DEBUG define.
<li> <a href="qtfe-ac-1998073000.tar.gz">QTFE-1998073000 with autoconf support</a>
<li> <a href="gnomefe-ac-1998073000.tar.gz">GNOMEFE-1998073000 with autoconf support</a>
<li> <a href="gnome-config">gnome-config script</a>
<P>
Building in the srcdir is disallowed as it causes problems if you want to later build in a subdir for a different configuration.  You should create a subdirectory, obj-`./config.guess`.  This is where you should actually run the build.  From this directory, run ../configure.
<P>
<h2>Maintenance</h2>
For those interested in maintaining autoconf related files, I suggest you first familiarize yourself with the <a href="http://www.cygnus.com/~ian/configure/">configure system</a>.  And reading the <a href="http://home.seawood.org/cgi-bin/info2www?autoconf">info pages</a> wouldn't hurt either.<P>
Transitioning from the old build system is fairly straightforward.  The most obvious change you will see is that the old system placed the object files in platform specific directories in the source tree while autoconf places the object files into a platform specific object tree that mimics the source tree.  Under the old system, there is the $DEPTH variable which specifies how far into the tree from the top you are.  Since autoconf uses separate object trees, $DEPTH's meaning could change depending upon whether you needed a derived file (anything not contained in CVS) or a specific source file.  Because of this, there are 2 standard autoconf variables that are used along with $DEPTH to determine which file is being referenced.<br>
<li><strong>$topsrcdir</strong> refers to the location that the configure script actually resides (in this case, mozilla/).
<li><strong>$srcdir</strong> refers to the source directory that corresponds to the object directory the Makefile is in.
<li><strong>$DEPTH</strong> is only used to reference files relative to the top of the object tree.
<P>
Any files at are explicitly referenced with a relative path should $(srcdir) prepended to them.  The most obvious example of such files are the header files (which are currently installed into a separated directory).  For long lists of files, I generally use:
<pre>
EXPORTS := $(addprefix ($srcdir)/, $(EXPORTS))
</pre>
<P>
The current build system relies heavily upon platform specific defines.  The autoconf build relies primarily upon functionality specific defines.  The platform specific config/*.mk files will eventually be modified to define -DHAVE_somefunc instead of -Dplatform (which should be done by the compiler anyway) for the non-autoconf cases.  In each platform.mk, there should be an ifdef USE_AUTOCONF that overrides the hardcoded values with the appropriate autoconf variables (see Linux.mk).
<P> 
Currently, there is one configure script for the entire mozilla client.  For a "proper" autoconf setup, one could argue there needs to be one per module so that each module can be completely independent.  Since all of the modules are currently not completely independent, separate configure scripts would be overkill.  However, the NSPR module is used by other products and is treated as a separate entity with its own set of config files.  One goal of this project is to also move the platform specific knowledge to a central place.  This allows others to become aware of the issues surrounding certain problems as well. (Like the problems with qsort under solaris which are only documented in xp_qsort.c.)
<P>

<h2>Options</h2>
The following mozilla options supported by configure:
<P><TABLE>
<TR><TD VALIGN=TOP>--with-jpeg
  </TD><TD VALIGN=TOP>Use the system jpeg library if available (broken)</TD></TR>
<TR><TD VALIGN=TOP>--with-png
  </TD><TD VALIGN=TOP>Use the system png library if available (broken)</TD></TR>
<TR><TD VALIGN=TOP>--with-zlib
  </TD><TD VALIGN=TOP>Use the system zlib library if available (broken)</TD></TR>
<TR><TD VALIGN=TOP>--enable-fe=<I>FE1,FE2</I>
  </TD><TD VALIGN=TOP>Use the FE frontends and check dependencies</TD></TR>
<TR><TD VALIGN=TOP>--enable-crypto
  </TD><TD VALIGN=TOP>Enable use of SSL for https (untested)</TD></TR>
<TR><TD VALIGN=TOP>--enable-netcast
  </TD><TD VALIGN=TOP>Enable use of netcast (untested)</TD></TR>
<TR><TD VALIGN=TOP>--enable-java
  </TD><TD VALIGN=TOP>Enable java support (untested)</TD></TR>
<TR><TD VALIGN=TOP>--enable-oji
  </TD><TD VALIGN=TOP>Enable use of Open JVM Interface (untested)</TD></TR>
<TR><TD VALIGN=TOP>--enable-debug
  </TD><TD VALIGN=TOP>Override CFLAGS & DEFINES with debug options</TD></TR>
<TR><TD VALIGN=TOP>--enable-profile
  </TD><TD VALIGN=TOP>Enable mozilla profiling (Solaris only)</TD></TR>
<TR><TD VALIGN=TOP>--enable-mailnews
  </TD><TD VALIGN=TOP>Enable mail & news features (broken)</TD></TR>
<TR><TD VALIGN=TOP>--disable-editor
  </TD><TD VALIGN=TOP>Disable composer</TD></TR>
<TR><TD VALIGN=TOP>--disable-asserts
  </TD><TD VALIGN=TOP>Disable error asserts during debugging</TD></TR>
<TR><TD VALIGN=TOP>--disable-async-dns
  </TD><TD VALIGN=TOP>Disable separate dns thread</TD></TR>
<TR><TD VALIGN=TOP>--enable-shack
  </TD><TD VALIGN=TOP>HTML-embeddable native widgets (experimental)</TD></TR>
<TR><TD VALIGN=TOP>--disable-shared
  </TD><TD VALIGN=TOP>Disable building of internal shared libs</TD></TR>
<TR><TD VALIGN=TOP>--disable-static
  </TD><TD VALIGN=TOP>Disable building of internal static libs (broken)</TD></TR>
<TR><TD VALIGN=TOP>--enable-tests
  </TD><TD VALIGN=TOP>Enable test stubs</TD></TR>
<TR><TD VALIGN=TOP>--enable-homedir=<I>$val</I>
  </TD><TD VALIGN=TOP>Set mozilla user dir to $val (broken)</TD></TR>
</TABLE>






<P><BR>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>
<TR>


<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>
</TR>

<TR>

<TD BGCOLOR="#000000" COLSPAN=6><BR></TD>

<TD BGCOLOR="#000000" VALIGN=TOP>

<FONT COLOR="#AAAAAA" SIZE="-1">
Copyright &copy; 1998 Netscape Communications Corporation.
</FONT>
</FONT>
</TD>

<TD BGCOLOR="#000000" COLSPAN=2><BR></TD>
</TR>

</TABLE>
<P>
</BODY>
</HTML>
