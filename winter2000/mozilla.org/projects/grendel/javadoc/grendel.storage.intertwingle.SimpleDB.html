<HTML>
<HEAD>
<TITLE>mozilla.org</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT="0" MARGINWIDTH="0">

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" ALT="" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP><IMG
SRC="../../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH="600" HEIGHT="58" VSPACE="0" HSPACE="0"></TD></TR></TABLE>

<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">


<TR>


<TD VALIGN="TOP" >
<TABLE BORDER="0" ><TR><TD BGCOLOR="#000000" VALIGN="TOP">
<TABLE BORDER="0" CELLSPACING="3"><TR><TD BGCOLOR="#DDDDDD" VALIGN="TOP">
<TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../.././"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../mozorg.html"> At A Glance</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../feedback.html"> Feedback</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../get-involved.html"> Get Involved</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../community.html"> Newsgroups</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../MPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://www.mozilla.org/newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../../docs/"><B> Developer Docs</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../ports/"> Ports</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../hacking/"> Hacking</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../source.html"> Get the Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../build/"> Build It</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../../quality/"><B> Testing</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../binaries.html"> Download</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../bugs/"> Bugzilla</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../../../quality/bug-writing-guidelines.html"> Bug Writing</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../../tools.html"><B> Tools</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://lxr.mozilla.org/seamonkey/"> View Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey"> Tree Status</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://cvs-mirror.mozilla.org/webtools/bonsai/cvsquery.cgi?treeid=default&amp;module=SeaMonkeyAll&amp;branch=HEAD&amp;branchtype=match&amp;dir=&amp;file=&amp;filetype=match&amp;who=&amp;whotype=match&amp;sortby=Date&amp;hours=2&amp;date=day&amp;mindate=&amp;maxdate=&amp;cvsroot=%2Fcvsroot"> New Checkins</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://bugzilla.mozilla.org/"> Submit A Bug</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../../../faq.html"><B> FAQ</B></A></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="http://www.mozilla.org/search.html"><B> Search</B></A></TD></TR>
</TABLE>
</TD></TR></TABLE>
</TD></TR></TABLE>
</TD>


<TD VALIGN="TOP">

<!-- Automatically generated with polardoc Version 1.0.4 on Tue Sep 08 11:22:09 PDT 1998 -->
<!-- grendel.storage.intertwingle.SimpleDB | Do not remove or edit this line! -->


<TITLE>
  Class grendel.storage.intertwingle.SimpleDB
</TITLE>


<A NAME="_Top_"></A>
<PRE>
<A HREF="Packages.html">All Packages</A>  <A HREF="Package-grendel.storage.intertwingle.html">This Package</A>  <A HREF="Tree.html">Class Hierarchy</A>  <A HREF="Search.html">Class Search</A>  <A HREF="AllNames.html">Index</A>
</PRE>
<HR SIZE=1 ALIGN=left WIDTH="98%">
<H1>
     Class grendel.storage.intertwingle.SimpleDB
</H1>
<PRE>
<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.Object.html#_Top_">java.lang.Object</A>
   |
   +----<A HREF="grendel.storage.intertwingle.BaseDB.html#_Top_">grendel.storage.intertwingle.BaseDB</A>
           |
           +----grendel.storage.intertwingle.SimpleDB
</PRE>
<DL>
<P>
Simplistic implementation of a RDF-ish database.  This is basically a
  massive hashtable hack.  Almost certainly we shouldn't ship this, but it
  ought to be good enough to play with for a while.

  <p>

  Here's how it works:

  <p>

  There are five files.  One is the "store", and it stores the data.  All
  data is accessed via a hash table, so each entry in the store contains
  one or two pointers to other entries with the same hash.  ("two" is in
  the case where there are two hash tables into the same data.)
  <p>
  The other four files are head pointers into the hashtable, for various
  hashes.
  <p>
  Random strings are stored in the store.  They get hashed using
  String.hashCode(), the hash value is masked off to HASHMASK, and the
  first pointer to the hashtable appear in the "strhead" file.  Each
  entry consists of a pointer to the next string with the same hashcode, and
  then a refcount, and then the UTF version of the string itself.
  <p>
  Assertions are stored in the store.  Each assertion is three strings:
  name, slot, and value.  The strings are first put into the store, and
  then the assertion is recorded by writing down the location of the
  strings.  Each assertion is hashed twice: once by combining the name and
  slot, and once by combining the value and slot.  So, each assertion records
  the next value for both hash tables, followed by the three string
  locations.  So, each assertion costs 20 bytes on disk, not counting the
  string storage.  The "head[]" files are the first pointers for each
  hashtable.
  <p>
  Finally, a free list of unused chunks in the store are kept.  The
  "freehead" file points to the first free entry of a given size; each
  free entry points to the next free entry of the same size.
<P>
</DL>
<HR SIZE=1 ALIGN=left WIDTH="98%">
<A NAME="_Summary_"></A>
<PRE>
public final class  <STRONG>SimpleDB</STRONG>
     extends grendel.storage.intertwingle.<A HREF="grendel.storage.intertwingle.BaseDB.html#_Top_">BaseDB</A>
{
          // Fields 8
     private static final int <A HREF="#HASHMASK">HASHMASK</A>;
     private static final int <A HREF="#MAXALLOC">MAXALLOC</A>;
     private static final int <A HREF="#MINALLOC">MINALLOC</A>;
     private RandomAccessFile <A HREF="#freehead">freehead</A>;
     private RandomAccessFile[] <A HREF="#head">head</A>;
     private RandomAccessFile <A HREF="#store">store</A>;
     private File <A HREF="#storename">storename</A>;
     private RandomAccessFile <A HREF="#strhead">strhead</A>;

          // Constructors 1
     public <A HREF="#SimpleDB(java.io.File)">SimpleDB</A>(File) throws IOException;

          // Methods 11
     private int <A HREF="#LookupString(java.lang.String, boolean)">LookupString</A>(String, boolean) throws IOException;
     private void <A HREF="#addStringRef(int)">addStringRef</A>(int) throws IOException;
     private int <A HREF="#alloc(int)">alloc</A>(int) throws IOException;
     public synchronized void <A HREF="#assert(java.lang.String, java.lang.String, java.lang.String)">assert</A>(String, String, String) throws IOException;
     public synchronized void <A HREF="#dump(java.io.PrintStream)">dump</A>(PrintStream) throws IOException;
     private void <A HREF="#dumpString(int)">dumpString</A>(int) throws IOException;
     public synchronized Enumeration <A HREF="#findAll(java.lang.String, java.lang.String, boolean)">findAll</A>(String, String, boolean) throws IOException;
     public synchronized String <A HREF="#findFirst(java.lang.String, java.lang.String, boolean)">findFirst</A>(String, String, boolean) throws IOException;
     private void <A HREF="#free(int, int)">free</A>(int, int) throws IOException;
     private void <A HREF="#removeStringRef(int)">removeStringRef</A>(int) throws IOException;
     public synchronized void <A HREF="#unassert(java.lang.String, java.lang.String, java.lang.String)">unassert</A>(String, String, String) throws IOException;

          // Inner Classes 1
     class <A HREF="grendel.storage.intertwingle.SimpleDB.AllEnumerator.html#_Top_">AllEnumerator</A>
}
</PRE>
<P>
<HR SIZE=1 ALIGN=left WIDTH="98%">
<CENTER><BR><H2>Fields</H2></CENTER>
<BR><H3> <A NAME="storename"><FONT COLOR="#FF00FF">&#149;</FONT> storename</A></H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> storename
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="store"><FONT COLOR="#FF00FF">&#149;</FONT> store</A></H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.RandomAccessFile.html#_Top_">RandomAccessFile</A> store
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="head"><FONT COLOR="#FF00FF">&#149;</FONT> head</A></H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.RandomAccessFile.html#_Top_">RandomAccessFile</A>[] head
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="strhead"><FONT COLOR="#FF00FF">&#149;</FONT> strhead</A></H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.RandomAccessFile.html#_Top_">RandomAccessFile</A> strhead
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="freehead"><FONT COLOR="#FF00FF">&#149;</FONT> freehead</A></H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.RandomAccessFile.html#_Top_">RandomAccessFile</A> freehead
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="MINALLOC"><FONT COLOR="#0000FF">&#149;</FONT> MINALLOC</A></H3>
<PRE>
   private static final int MINALLOC
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="MAXALLOC"><FONT COLOR="#0000FF">&#149;</FONT> MAXALLOC</A></H3>
<PRE>
   private static final int MAXALLOC
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="HASHMASK"><FONT COLOR="#0000FF">&#149;</FONT> HASHMASK</A></H3>
<PRE>
   private static final int HASHMASK
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<P>
<HR SIZE=1 ALIGN=left WIDTH="98%">

<CENTER><BR><H2>Constructors</H2></CENTER>
<BR><H3><A NAME="SimpleDB"><FONT COLOR="#FFCC00">&#149;</FONT></A>
<A NAME="SimpleDB(java.io.File)">SimpleDB</A> </H3>
<PRE>
   public SimpleDB(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> f)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
</BLOCKQUOTE> <BR>

<HR SIZE=1 ALIGN=left WIDTH="98%">

<CENTER><BR><H2>Methods</H2></CENTER>
<BR><H3><A NAME="alloc"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="alloc(int)">alloc</A> </H3>
<PRE>
   private int alloc(int length)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="free"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="free(int, int)">free</A> </H3>
<PRE>
   private void free(int ptr, 
                     int length)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="LookupString"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="LookupString(java.lang.String, boolean)">LookupString</A> </H3>
<PRE>
   private int LookupString(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> str, 
                            boolean create)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="addStringRef"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="addStringRef(int)">addStringRef</A> </H3>
<PRE>
   private void addStringRef(int loc)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="removeStringRef"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="removeStringRef(int)">removeStringRef</A> </H3>
<PRE>
   private void removeStringRef(int loc)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="assert"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="assert(java.lang.String, java.lang.String, java.lang.String)">assert</A> </H3>
<PRE>
   public synchronized void assert(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> name, 
                                   <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> slot, 
                                   <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> value)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="unassert"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="unassert(java.lang.String, java.lang.String, java.lang.String)">unassert</A> </H3>
<PRE>
   public synchronized void unassert(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> name, 
                                     <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> slot, 
                                     <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> value)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="findFirst"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="findFirst(java.lang.String, java.lang.String, boolean)">findFirst</A> </H3>
<PRE>
   public synchronized <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> findFirst(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> name, 
                                        <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> slot, 
                                        boolean reverse)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="findAll"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="findAll(java.lang.String, java.lang.String, boolean)">findAll</A> </H3>
<PRE>
   public synchronized <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.util.Enumeration.html#_Top_">Enumeration</A> findAll(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> name, 
                                           <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> slot, 
                                           boolean reverse)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="dumpString"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="dumpString(int)">dumpString</A> </H3>
<PRE>
   private void dumpString(int loc)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="dump"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="dump(java.io.PrintStream)">dump</A> </H3>
<PRE>
   public synchronized void dump(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.PrintStream.html#_Top_">PrintStream</A> out)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<HR SIZE=1 ALIGN=left WIDTH="98%">

<PRE>
<A HREF="Packages.html">All Packages</A>  <A HREF="Package-grendel.storage.intertwingle.html">This Package</A>  <A HREF="Tree.html">Class Hierarchy</A>  <A HREF="Search.html">Class Search</A>  <A HREF="AllNames.html">Index</A>
</PRE>
<FONT SIZE=-1>
<I>Freshly brewed Java API Documentation automatically generated with <A HREF="http://www.ualberta.ca/~tgee/polardoc">polardoc</A> Version 1.0.4
<BR>
</I></FONT>




</TD>

</TR>
<TR>

<TD COLSPAN="2" ALIGN="RIGHT" VALIGN="TOP">
<FONT SIZE="-1">
Copyright &copy; 1998-2000 The Mozilla Organization.
<BR>
<A HREF="http://www.mozilla.org/webtools/bonsai/cvslog.cgi?file=mozilla-org/html/projects/grendel/javadoc/grendel.storage.intertwingle.SimpleDB.html&amp;rev=&amp;root=/cvsroot/">Last modified December 25,  1998</A>.
</FONT>
</TD>
</TR>

</TABLE>
</BODY>
</HTML>
