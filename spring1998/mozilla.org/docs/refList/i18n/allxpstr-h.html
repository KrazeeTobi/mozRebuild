<HTML>
<HEAD>
<TITLE>Platform Independent String Resources</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT=0 MARGINWIDTH=0>

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="284,5,424,54" HREF="http://www.mozilla.org/">
<AREA SHAPE=RECT COORDS="447,13,563,29"
HREF="http://developer.netscape.com/index_moz.html">
<AREA SHAPE=RECT COORDS="447,29,590,188"
HREF="http://developer.netscape.com/index_moz.html">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP ROWSPAN=2><IMG
SRC="../../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH=600 HEIGHT=58 VSPACE=0 HSPACE=0></TD></TR></TABLE>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=TOP><IMG ALT=""
SRC="../../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ROWSPAN=2>

<BR><TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../..//"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../mission.html"> Our Mission</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../about.html"> Who We Are</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../get-involved.html"> Getting Involved</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../community.html"> Community</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../advocacy.html"> Editorials</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../news.html"> What's New</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../projects.html"><B> Projects</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../blue-sky/"> Blue Sky</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../newlayout/"> New Layout</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../mailnews/"> Mail/News</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../ports/"> Ports</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../other-projects.html"> Other</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../source-code.html"><B> Source Code</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../source.html"> Getting It</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../docs/"> Documentation</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../NPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../bugs/"> Bugs</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../search"><B> Search</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../feedback.html"><B> Feedback</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="http://developer.netscape.com/index_moz.html"><B> DevEdge Online</B></A></TD></TR>
</TABLE><BR>

</TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=TOP><IMG ALT=""
SRC="../../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ROWSPAN=2>
<P><BR>



   



<CENTER>
<H1>
Platform Independent String Resources</H1></CENTER>

<CENTER>
<H2>
- About file include/allxpstr.h</H2></CENTER>

<CENTER>Draft: April 17,1998</CENTER>
<CENTER>Contact: Frank Tang 
&lt;<A HREF="mailto:ftang@netscape.com">ftang@netscape.com</A>&gt;</CENTER>



<CENTER>Discussion: <A HREF="news://news.mozilla.org/netscape.public.mozilla.i18n">netscape.public.mozilla.i18n</A> or 
<A HREF="mailto:mozilla-i18n@mozilla.org">mozilla-i18n@mozilla.org</A></CENTER>

<CENTER>
<HR WIDTH="100%"></CENTER>

<H2>
<A NAME="Introduction"></A>Abstract</H2>
Mozilla source code stores all the cross-platform localizable strings in
the file <TT>include/allxpstr.h </TT>. This paper discusses how to add
additional strings into it, how to access them from the run-time, and concludes
with the direction of future development.
<H2>
<A NAME="history"></A>History</H2>

<UL>
<LI>
1.1i: First added</LI>

<LI>
2.0: No Major change.</LI>

<LI>
3.0:</LI>

<UL>
<LI>
Changed Macintosh build process from calling a Perl script in MPW to build
it inside a Project file.</LI>

<LI>
The Windows resources are built into a separate resource DLL (RESDLL.DLL)
file. The location of the DLL is decided by a value in the registry.</LI>
</UL>

<LI>
4.0:</LI>

<UL>
<LI>
Added GetStringForHTML API to solve the "Subject:", "To:", "Cc:" problem
in Messenger.</LI>

<LI>
the Macintosh resources are built into a separate resource file ("Essential
Files:Netscape Resources").</LI>

<LI>
The location of the Windows DLL is no longer decided by a value in the
registry. The program simply uses the DLL in the same directory as the
executable.</LI>
</UL>

<LI>
Free Source:</LI>

<UL>
<LI>
The Macintosh resources file is renamed from "Netscape Resources" to "Mozilla
Resources"</LI>
</UL>
</UL>

<HR WIDTH="100%">
<H2>
<A NAME="howitwork"></A>How It Works</H2>

<H3>
<A NAME="WhatShouldBePutIntoThisFile"></A>What Should Be Put Into This
File?</H3>
All the <A HREF="#Cross-platform">cross-platform</A> <A HREF="#Human Readable">human
readable text </A>displayed by the Mozilla user interface should be put
into ns/include/allxpstr.h:
<UL>
<LI>
<A NAME="Cross-platform"></A><U>Cross-platform text</U>: This file contains
all the text used in cross-platform code. Only cross-platform strings should
be put in this file.</LI>

<LI>
<A NAME="Human Readable"></A><U>Human readable text</U>: This file contains
only human readable text. It is recommended to put English-like protocol
code into this file if Mozilla needs to display it to the user (such as
"Subject:", "Date:", "To:" in RFC822). The display to screen code should
map the protocol code into human readable text (even if the protocol code
and human readable text are the same in English) by using the platform
independent string resource facility to achieve the goal of user friendliness.
However, it should send the protocol code to the wire directly without
mapping.</LI>

<LI>
<U>Whole sentences</U>: See <A HREF="http://lemming/client/pub/l12yGuidelines.html">"Mozilla
Localizability Guidelines"</A> for details.</LI>
</UL>

<H3>
What Should Not Be Put Into This File?</H3>

<UL>
<LI>
<U>Front-End only text</U>: Text used by only one platform should not be
put into this file. They should put into platform dependent resource formats.
Otherwise, these strings will be built into each platform's binary, unecessarily
increasing the size of that binary.</LI>

<LI>
<U>Protocol code</U>: Protocol code (such as "Content-Type" in HTTP header)
should not be put into allxpstr.h so translators won't accidentally change
the protocol by changing the protocol code (in other words, prevent over-translation).</LI>

<LI>
<U>Partial sentences</U>: See <A HREF="http://lemming/client/pub/l12yGuidelines.html">"Mozilla
Localizability Guidelines"</A> for details.</LI>
</UL>

<H3>
<A NAME="model"></A>Development Model</H3>

<UL>
<LI>
<U>Development</U>: Developers working on the cross-platform code should
make their code localizable by first putting all the human readable text
into this file with a unique id. Then they should use the function XP_GetString
(or XP_GetStringForHTML) in their cross-platform code to access this text.
In the build process, this file is compiled into platform dependent resource
files.</LI>

<LI>
<U>Localization</U>: Translators may either translate this file directly
into different language, or they may work on the compiled version in each
platform's binary resource files. (Currently, for Windows and Macintosh,
localization is done on the platform specific binary resource file, using
leveraging tools and resource editing tools to help them.)</LI>

<LI>
<U>Run-Time</U>: In the run-time, the functions XP_GetString and XP_GetStringForHTML
access the compiled resource file by calling underlying platform dependent
functions. These will access the different language version resources depending
on which localized Mozilla they installed. In Unix, this also depends on
which Locale the user selected before launching Mozilla. (Users can install
multiple language versions of resource file.)</LI>
</UL>

<H3>
<A NAME="HowToPutIntoIt"></A>How To Put The Text Into It?</H3>
The <TT>include/allxpstr.h</TT> file is divided into several sections.
Each section contains
<OL>
<LI>
One and only one <TT>RES_START</TT></LI>

<LI>
One and only one <TT>BEGIN_STR(<A HREF="#section_name">section_name</A>)</TT></LI>

<LI>
Several <TT>ResDef(<A HREF="#MESSAGE_ID">MESSAGE_ID</A>, <A HREF="#msg_number">msg_number</A>,
<I><A HREF="#msg">msg</A></I>). </TT>This is where you add your human readable
text.</LI>

<LI>
One and only <TT>END_STR(<A HREF="#section_name">section_name</A>)</TT></LI>
</OL>
where
<UL>
<LI>
<A NAME="section_name"></A><I><TT>section_name </TT></I>is a unique name
representing this section. This <I><TT>section_name </TT></I>is needed
later in the build process. You don't need to refer to it in the C/C++
source file. In most cases, you should put your message into the <TT>mcom_include_xp_msg_i_strings</TT>
section.</LI>

<LI>
<A NAME="MESSAGE_ID"></A><I><TT>MESSAGE_ID </TT></I>is a unique name. Used
this id in the C/C++ source file when you call the function <TT>XP_GetString
</TT>or <TT><NOBR>XP_GetStringForHTML</NOBR></TT>.</LI>

<LI>
<A NAME="msg_number"></A><TT>msg_number </TT>is a sequential number. You
don't need to refer to it in the C/C++ source file.</LI>

<LI>
<A NAME="msg"></A><I><TT>msg </TT></I>is the referenced English message.
Translators produce different language versions of allxpstr.h by translating
this reference English. If you are using <TT><NOBR>XP_GetStringForHTML()
</NOBR></TT>, you should make sure this is the same as the third argument
<I><TT>EnglishMessage</TT></I> you put into <TT><NOBR>XP_GetStringForHTML()</NOBR></TT>
.</LI>
</UL>

<H3>
<A NAME="HowToAccessIt"></A>How To Access This Text From C/C++ Source File?</H3>

<OL>
<LI>
In the beginning of the C/C++ source file, add the line</LI>

<BR>
<PRE>
    #include "xpgetstr.h"
</PRE>
<LI>
In the beginning of the C/C++ source file, put down: (Note: in C++ file,
remember to put <TT>extern "C" {</TT> and <TT>}</TT> around the include
statement )</LI>

<PRE>
    #define WANT_ENUM_STRING_IDS
    #include "allxpstr.h"
    #undef WANT_ENUM_STRING_IDS
</PRE>

<LI>
In the place where you need to refer to the human readable text, call</LI>

<BR><TT><A NAME="XP_GetString"></A>XP_GetString(<I><A HREF="#MESSAGE_ID">MESSAGE_ID</A></I>)</TT>
<BR>This function will return a pointer to a global buffer which contains
the human readable string. The caller should make a copy of that string
if it needs to use it later. The caller should not free the memory returned
by the function. See the XP_GetString on-line documentation [ADD LINK HERE]
for details.
<LI>
If the text will be generated into HTML and mixed with content gotten from
server, call</LI>

<BR><TT><NOBR><A NAME="XP_GetStringForHTML"></A>XP_GetStringForHTML(</NOBR><I><A HREF="#MESSAGE_ID">MESSAGE_ID</A><NOBR>,
CharSetID, EnglishMessage</NOBR></I><NOBR>)</NOBR></TT>
<BR>instead. The reason is the charset used by the server content may not
be the same as the one in the localized resource string. This function
will compare the <I><TT>CharSetID</TT></I> with the charset used by the
localized message (returned by <TT>INTL_ResourceCharSet()</TT> ). It will
return the localized message if the charsets agree with each other, otherwise,
the <I><TT>EnglishMessage</TT></I> will be used.</OL>

<H3>
<A NAME="example"></A>Example: (ns/lib/libnet/cvmime.c)</H3>
In the following example, the code displays a warning message <TT><NOBR><FONT COLOR="#000000">"Cannot
edit non-HTML documents!"</FONT></NOBR></TT> to the user. The text is put
into <TT>ns/include/allxpstr.h</TT> as:

<PRE>
    ...
    <FONT COLOR="#FF0000">ResDef(XP_EDITOR_NON_HTML, XP_MSG_BASE + 647, "Cannot edit non-HTML documents!")</FONT>
    ...
</PRE>

In <TT>ns/lib/libnet/cvmime.c</TT>, the accessing code looks like:
<PRE>
    ...
    <FONT COLOR="#FF0000">#include "xpgetstr.h"</FONT>
    <FONT COLOR="#FF0000">extern int XP_EDITOR_NON_HTML;</FONT>
    ...
        FE_Alert(window_id, <FONT COLOR="#FF0000">XP_GetString(XP_EDITOR_NON_HTML)</FONT>);
    ...
</PRE>



<H2>

<HR WIDTH="100%">Platform Details:</H2>

<H3>
Macintosh:</H3>

<UL>
<LI>
The text in this file is built as "STR " resource types in the "Essential
Files:Mozilla Resources" file.</LI>
</UL>

<H3>
Window:</H3>

<UL>
<LI>
The text in this file is built as STRINGTABLE resource types in the "PROGRAM/resdll.dll"
file.</LI>
</UL>

<H3>
Unix:</H3>

<UL>
<LI>
The text in this file is built as X Window's resources in the Mozilla.ad
file.</LI>
</UL>

<H2>

<HR WIDTH="100%">Misc.:</H2>

<H3>
<A NAME="gettext"></A>Why Not Using GETTEXT in Unix ?</H3>
For Unix, some people have asked us to use GETTEXT, instead of the X Window's
Resource Manager. The reason we decided not to use GETTEXT is the lack
of a standard binary format, lack of standard resource compiler usage,
and lack of standard installation tools across different variation of Unix.
Currently, the X Window's Resource Manager is standard and widely available
on all the UNIX platforms upon which we build. We had a similar answer
for requests to use the message system in XPG (catopen/catclose/catgets)
<BR>
<H2>

<HR WIDTH="100%"><A NAME="whereitheaded"></A>Where It's Headed</H2>
We have discussed changing the current implementation for years. Unfortunately,
we still haven't changed it. Why? Maybe because we are too busy to fix
other *NEW THINGS*, when this platform independent string resources system
is in an *OK* stage.

<P>We know the current implementation has the following problems. If you
are interested in enhancing the system, consider these issues:
<UL>
<LI>
This file has become a hot spot. Everyone who works on the cross-platform
code needs to touch this file. Conflicting number assignment in our parallel
development environment causes a lot of problems. It will be worse in the
open source development environment.</LI>

<LI>
The final result is not 100% sharable across platforms.</LI>

<LI>
Only one level of indexing. It is difficult to store a list of name-value
pairs.</LI>

<LI>
It is difficult to switch languages on-the-fly. This is indirectly related
to the issue above.</LI>
</UL>
As we know, there are some risks to changing the current system.
Consider these when you think you can improve it:
<UL>
<LI>
We currently have in-house leveraging tools which reduce the cost of translation
across versions. Changing the system means it is also necessary to change
the leveraging tools.</LI>

<LI>
It is difficult to educate English speaking developers to externalize text
from code. Changing the system in a complex way may discourage them to
do it.</LI>
</UL>
<HR>
<CENTER>Copyright &copy; 1998 <A HREF="http://home.netscape.com/misc/contact_info.html">Netscape
Communications Corporation</A></CENTER>

<HR>




<P><BR>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>
<TR>


<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM><IMG ALT=""
SRC="../../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=BOTTOM><IMG ALT=""
SRC="../../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>
</TR>

<TR>

<TD BGCOLOR="#000000" COLSPAN=6><BR></TD>

<TD BGCOLOR="#000000" VALIGN=TOP>

<FONT COLOR="#AAAAAA" SIZE="-1">
Copyright &copy; 1998 Netscape Communications Corporation.
</FONT>
</FONT>
</TD>

<TD BGCOLOR="#000000" COLSPAN=2><BR></TD>
</TR>

</TABLE>
<P>
</BODY>
</HTML>
