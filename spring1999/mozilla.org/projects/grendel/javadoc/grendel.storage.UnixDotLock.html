<HTML>
<HEAD>
<TITLE>mozilla.org</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT=0 MARGINWIDTH=0>

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP ROWSPAN=2><IMG
SRC="../../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH=600 HEIGHT=58 VSPACE=0 HSPACE=0></TD></TR></TABLE>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">

<TR>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>



<TD BGCOLOR="#DDDDDD" VALIGN=TOP COLSPAN=2><IMG ALT=""
SRC="../../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP><IMG ALT=""
SRC="../../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>


<TR>

<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP COLSPAN=3>

<BR><TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../..//"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../mission.html"> Our Mission</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../about.html"> Who We Are</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../get-involved.html"> Getting Involved</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../community.html"> Community</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../advocacy.html"> Editorials</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../news.html"> What's New</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../development.html"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../blue-sky/"> Blue Sky</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../projects.html"> Projects</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../status/"> Status</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../tools.html"> Tools</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../products.html"><B> Products</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../source.html"> Source Code</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../binaries.html"> Binaries</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../docs/"> Documentation</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../NPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../bugs/"> Bug Reports</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../../quality/"> Quality</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../search.html"><B> Search</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../../feedback.html"><B> Feedback</B></A></TD></TR>
</TABLE><BR>
</TD>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD VALIGN=TOP>
<P><BR>

<!-- Automatically generated with polardoc Version 1.0.4 on Tue Sep 08 11:22:09 PDT 1998 -->
<!-- grendel.storage.UnixDotLock | Do not remove or edit this line! -->


<TITLE>
  Class grendel.storage.UnixDotLock
</TITLE>


<A NAME="_Top_"></A>
<PRE>
<A HREF="Packages.html">All Packages</A>  <A HREF="Package-grendel.storage.html">This Package</A>  <A HREF="Tree.html">Class Hierarchy</A>  <A HREF="Search.html">Class Search</A>  <A HREF="AllNames.html">Index</A>
</PRE>
<HR SIZE=1 ALIGN=left WIDTH="98%">
<H1>
     Class grendel.storage.UnixDotLock
</H1>
<PRE>
<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.Object.html#_Top_">java.lang.Object</A>
   |
   +----grendel.storage.UnixDotLock
</PRE>
<DL>
<P>
Implements Unix-style dot-locking (locking file <TT>"FOO"</TT> by using an
    atomically-created file in the same directory named <TT>"FOO.lock"</TT>.)

    <P> Use it like this:

    <P><UL>
 <TT>UnixDotLock lock = new UnixDotLock(file);&nbsp; // </TT><I>this blocks</I>
 <BR><TT>// </TT><I>... long-running manipulations of file</I>
 <BR><TT>lock.unlock();</TT>
    </UL>

    <P> All the lock-retrying and lock-date-maintenance happens under
    the covers.

    <P> See also the
    <A HREF="http://home.netscape.com/eng/mozilla/2.0/relnotes/demo/movemail.html#movemail">
    description of movemail</A>.

   <P><B>Implementation details:</B>
   <BLOCKQUOTE>
    <P>The protocol for getting a lock on some file <TT>"FOO"</TT> is
    as follows:

    <P><OL>
     <LI> Create a file <TT>"FOO.1234"</TT> (random unused name.)<P>

     <LI> Hard-link <TT>"FOO.1234"</TT> to <TT>"FOO.lock"</TT>.<BR>
          (this is the trick, because <TT>link()</TT> happens to be
          one of the few atomic, synchronized operations over NFS.)<P>

     <LI> Unlink <TT>"FOO.1234"</TT><BR>
          (regardless of whether step 2 succeeded; now either we have
          a <TT>"FOO.lock"</TT> file or we don't.)<P>

     <LI> If we obtained the lock (the <TT>link()</TT> call in
          step #2 succeeded), then we're done.<P>

     <LI> Else if the creation-time of <TT>"FOO.lock"</TT> is more
          than 60 seconds in the past, then smash the lock (unlink
          <TT>"FOO.lock"</TT>) and goto step #1.)<P>

     <LI> Else, the lock is held and current.  Wait a second, then
          goto step #1 and try again.
    </OL>
    <P>
    One thing implied by this is that if one wants to hold a lock for longer
    than 60 seconds (which we do in some cases) then one must maintain the
    lock file: its modification-date must be updated every less-than-60
    seconds.  We do this by having a ``heartbeat'' thread that wakes up
    periodically and updates all held locks.
   </BLOCKQUOTE>
<P>
</DL>
<HR SIZE=1 ALIGN=left WIDTH="98%">
<A NAME="_Summary_"></A>
<PRE>
public class  <STRONG>UnixDotLock</STRONG>
     extends java.lang.<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.Object.html#_Top_">Object</A>
{
          // Fields 7
     private static final int <A HREF="#File_lastModified_scale">File_lastModified_scale</A>;
     private static Vector <A HREF="#active_locks">active_locks</A>;
     private static final boolean <A HREF="#debug">debug</A>;
     static final int <A HREF="#heart_rate">heart_rate</A>;
     private static Thread <A HREF="#lock_heartbeat_thread">lock_heartbeat_thread</A>;
     private File <A HREF="#locked_file">locked_file</A>;
     private static final int <A HREF="#maximum_lock_age">maximum_lock_age</A>;

          // Constructors 1
     public <A HREF="#UnixDotLock(java.io.File)">UnixDotLock</A>(File) throws SecurityException, IOException, InterruptedException;

          // Methods 11
     private void <A HREF="#createDiskLock(java.io.File)">createDiskLock</A>(File) throws SecurityException, IOException, InterruptedException;
     protected synchronized void <A HREF="#finalize()">finalize</A>() throws Throwable;
     private File <A HREF="#gentemp(java.io.File)">gentemp</A>(File);
     static synchronized void <A HREF="#globalHeartbeat()">globalHeartbeat</A>();
     private synchronized void <A HREF="#heartbeat()">heartbeat</A>() throws IOException;
     public static final void <A HREF="#main(java.lang.String[])">main</A>(String[]) throws SecurityException, IOException, InterruptedException;
     private File <A HREF="#makeLockName(java.io.File)">makeLockName</A>(File);
     private void <A HREF="#removeDiskLock(java.io.File)">removeDiskLock</A>(File);
     private synchronized void <A HREF="#setLocked(java.io.File)">setLocked</A>(File) throws InterruptedException;
     public void <A HREF="#unlock()">unlock</A>();
     private static synchronized void <A HREF="#updateLockList(grendel.storage.UnixDotLock)">updateLockList</A>(UnixDotLock);
}
</PRE>
<P>
<HR SIZE=1 ALIGN=left WIDTH="98%">
<CENTER><BR><H2>Fields</H2></CENTER>
<BR><H3> <A NAME="debug"><FONT COLOR="#0000FF">&#149;</FONT> debug</A></H3>
<PRE>
   private static final boolean debug
</PRE>
<BLOCKQUOTE>
<BR>
Turn this on to cause activity to be logged to System.err.
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="lock_heartbeat_thread"><FONT COLOR="#0000FF">&#149;</FONT> lock_heartbeat_thread</A></H3>
<PRE>
   private static <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.Thread.html#_Top_">Thread</A> lock_heartbeat_thread
</PRE>
<BLOCKQUOTE>
<BR>
Holds the (one) thread that updates the lock date every <60 seconds.
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="active_locks"><FONT COLOR="#0000FF">&#149;</FONT> active_locks</A></H3>
<PRE>
   private static <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.util.Vector.html#_Top_">Vector</A> active_locks
</PRE>
<BLOCKQUOTE>
<BR>
List of locked locks.  The vector holds UnixDotLock objects.
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="maximum_lock_age"><FONT COLOR="#0000FF">&#149;</FONT> maximum_lock_age</A></H3>
<PRE>
   private static final int maximum_lock_age
</PRE>
<BLOCKQUOTE>
<BR>
After someone else's lock is 60 seconds old, we assume it has been left
      dangling, and smash it.  This is a part of the de-facto dot-locking
      protocol, folks: I wouldn't make this stuff up.  The way you hold a
      lock for longer than 60 seconds is by periodically updating the
      modification date of the lock file to prove that you're still alive.
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="heart_rate"><FONT COLOR="#0000FF">&#149;</FONT> heart_rate</A></H3>
<PRE>
   static final int heart_rate
</PRE>
<BLOCKQUOTE>
<BR>
How often to update the write-date on a lock file.  If we want to
      hold a lock for longer than 60 seconds, we need to update its
      write date, and this is how often we do that.  This should be
      less than `maximum_lock_age' by enough to be comfortable that
      system load and thread starvation won't cause the heartbeat
      thread to fail to update the lock file date in time.
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="File_lastModified_scale"><FONT COLOR="#0000FF">&#149;</FONT> File_lastModified_scale</A></H3>
<PRE>
   private static final int File_lastModified_scale
</PRE>
<BLOCKQUOTE>
<BR>
<B>System dependency:</B> multiply the result of File.lastModified() by
      this to convert it to seconds.  Java doesn't specify the units in which
      File.lastModified() measures time, but we need to be able to add N
      seconds to it, to tell when a file is more than N seconds old.  It
      happens that, with JDK 1.1.3 on Irix, this scale is 1000.  We must
      assume that all other Unixen behave the same.  If this changes in some
      future Java implementation, we're fucked.
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="locked_file"><FONT COLOR="#FF00FF">&#149;</FONT> locked_file</A></H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> locked_file
</PRE>
<BLOCKQUOTE>
<BR>
The name of the file for which this lock is being held.
<P> </BLOCKQUOTE>

<P>
<HR SIZE=1 ALIGN=left WIDTH="98%">

<CENTER><BR><H2>Constructors</H2></CENTER>
<BR><H3><A NAME="UnixDotLock"><FONT COLOR="#FFCC00">&#149;</FONT></A>
<A NAME="UnixDotLock(java.io.File)">UnixDotLock</A> </H3>
<PRE>
   public UnixDotLock(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> file)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.SecurityException.html#_Top_">SecurityException</A>, <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A>, <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.InterruptedException.html#_Top_">InterruptedException</A></PRE>
<BLOCKQUOTE>
<DL>
<P>
Lock the named file.  Unlock it by calling the unlock() method.
      If you do not call unlock() before discarding the UnixDotLock object,
      the file will remain locked!
<P>
<DT> <B>Throws:</B> <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.SecurityException.html">SecurityException</A>
<DD> the lock file could not be created
                                        (file permission problems?)
<DT> <B>Throws:</B> <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html">IOException</A>
<DD> a disk I/O error occurred.
<DT> <B>Throws:</B> <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.InterruptedException.html">InterruptedException</A>
<DD> this thread was killed while waiting
                                        for the lock.
</DL>
</BLOCKQUOTE> <BR>

<HR SIZE=1 ALIGN=left WIDTH="98%">

<CENTER><BR><H2>Methods</H2></CENTER>
<BR><H3><A NAME="unlock"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="unlock()">unlock</A> </H3>
<PRE>
   public void unlock() </PRE>
<BLOCKQUOTE>
<DL>
<P>
Unlock the file.  This must be called before discarding the UnixDotLock
      object, and may be called only once.  The UnixDotLock object must not
      be used again after calling this.
<P>
<DT> <B>Throws:</B> <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.InterruptedException.html">InterruptedException</A>
<DD> this thread was killed while waiting
                                        for the lock.
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="makeLockName"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="makeLockName(java.io.File)">makeLockName</A> </H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> makeLockName(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> file) </PRE>
<BLOCKQUOTE>
<DL>
<P>
Create a lock file name for the given file (append ".lock" to it.)
<P>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="gentemp"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="gentemp(java.io.File)">gentemp</A> </H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> gentemp(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> prefix) </PRE>
<BLOCKQUOTE>
<DL>
<P>
Create the name of a new file in the same directory as the given file.
      This picks a random name and then checks to make sure it doesn't
      already exist.  It doesn't actually create the file (so there's a
      very slight race here.)
<P>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="createDiskLock"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="createDiskLock(java.io.File)">createDiskLock</A> </H3>
<PRE>
   private void createDiskLock(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> file)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.SecurityException.html#_Top_">SecurityException</A>, <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A>, <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.InterruptedException.html#_Top_">InterruptedException</A></PRE>
<BLOCKQUOTE>
<DL>
<P>
Attempt to lock the file, using the hairy dot-locking protocol.
      Does not return until the lock has been obtained.
<P>
<DT> <B>Throws:</B> <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.SecurityException.html">SecurityException</A>
<DD> the lock file could not be created
                                        (file permission problems?).
<DT> <B>Throws:</B> <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html">IOException</A>
<DD> a disk I/O error occurred.
<DT> <B>Throws:</B> <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.InterruptedException.html">InterruptedException</A>
<DD> this thread was killed while waiting
                                        for the lock.
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="removeDiskLock"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="removeDiskLock(java.io.File)">removeDiskLock</A> </H3>
<PRE>
   private void removeDiskLock(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> file) </PRE>
<BLOCKQUOTE>
<DL>
<P>
Assumes that this process had at some point obtained a lock on the
      given file, and removes that lock.  Calling this without having
      obtained the lock will smash someone else's lock, and you don't
      want to do that.
<P>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="setLocked"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="setLocked(java.io.File)">setLocked</A> </H3>
<PRE>
   private synchronized void setLocked(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> file)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.InterruptedException.html#_Top_">InterruptedException</A></PRE>
<BLOCKQUOTE>
<DL>
<P>
Marks the object as locked or unlocked.  Manages the heartbeat
      thread (creating or killing it, as appropriate.)
<P>
<DT> <B>Throws:</B> <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.InterruptedException.html">InterruptedException</A>
<DD> this thread was killed while waiting
                                        for the lock.  This can only be thrown
                                        when locking, not when unlocking.
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="heartbeat"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="heartbeat()">heartbeat</A> </H3>
<PRE>
   private synchronized void heartbeat()  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
<P>
If we currently own a lock file, update its modification time.
      This is a way of informing other processes that this process is
      still alive, and still desires to hold the lock.
<P>
<DT> <B>Throws:</B> <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html">IOException</A>
<DD> a disk I/O error occurred.
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="globalHeartbeat"><FONT COLOR="#00DD00">&#149;</FONT></A>
<A NAME="globalHeartbeat()">globalHeartbeat</A> </H3>
<PRE>
   static synchronized void globalHeartbeat() </PRE>
<BLOCKQUOTE>
<DL>
<P>
Call the heartbeat() method on every UnixDotLock in `active_locks'.
<P>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="updateLockList"><FONT COLOR="#00DD00">&#149;</FONT></A>
<A NAME="updateLockList(grendel.storage.UnixDotLock)">updateLockList</A> </H3>
<PRE>
   private static synchronized void updateLockList(<A HREF="grendel.storage.UnixDotLock.html#_Top_">UnixDotLock</A> lock) </PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="finalize"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="finalize()">finalize</A> </H3>
<PRE>
   protected synchronized void finalize()  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.Throwable.html#_Top_">Throwable</A></PRE>
<BLOCKQUOTE>
<DL>
<P>
If this object becomes reclaimed without unlock() having been called,
      then call it (thus unlocking the underlying disk file.)
<P>
<DT><B>Overrides:</B>
<DD><A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.Object.html#finalize()">finalize</A> in class <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.Object.html#_Top_">Object</A>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="main"><FONT COLOR="#00DD00">&#149;</FONT></A>
<A NAME="main(java.lang.String[])">main</A> </H3>
<PRE>
   public static final void main(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A>[] arg)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.SecurityException.html#_Top_">SecurityException</A>, <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A>, <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.InterruptedException.html#_Top_">InterruptedException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<HR SIZE=1 ALIGN=left WIDTH="98%">

<PRE>
<A HREF="Packages.html">All Packages</A>  <A HREF="Package-grendel.storage.html">This Package</A>  <A HREF="Tree.html">Class Hierarchy</A>  <A HREF="Search.html">Class Search</A>  <A HREF="AllNames.html">Index</A>
</PRE>
<FONT SIZE=-1>
<I>Freshly brewed Java API Documentation automatically generated with <A HREF="http://www.ualberta.ca/~tgee/polardoc">polardoc</A> Version 1.0.4
<BR>
</I></FONT>




<P><BR>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>


<TR>


<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM COLSPAN=2><IMG ALT=""
SRC="../../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=BOTTOM COLSPAN=2><IMG ALT=""
SRC="../../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>
</TR>

<TR>

<TD BGCOLOR="#000000" COLSPAN=6><BR></TD>

<TD BGCOLOR="#000000" VALIGN=TOP>

<FONT COLOR="#AAAAAA" SIZE="-1">
Copyright &copy; 1998 The Mozilla Organization.
</FONT>

</TD>

<TD BGCOLOR="#000000" COLSPAN=2><BR></TD>
</TR>

</TABLE>
<P>
</BODY>
</HTML>
