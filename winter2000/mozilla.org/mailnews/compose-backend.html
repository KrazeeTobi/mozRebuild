<HTML>
<HEAD>
<TITLE>Mail Composition Back End</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT="0" MARGINWIDTH="0">

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" ALT="" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP><IMG
SRC="../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH="600" HEIGHT="58" VSPACE="0" HSPACE="0"></TD></TR></TABLE>

<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">


<TR>


<TD VALIGN="TOP" >
<TABLE BORDER="0" ><TR><TD BGCOLOR="#000000" VALIGN="TOP">
<TABLE BORDER="0" CELLSPACING="3"><TR><TD BGCOLOR="#DDDDDD" VALIGN="TOP">
<TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD NOWRAP COLSPAN=2><A HREF=".././"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../mozorg.html"> At A Glance</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../feedback.html"> Feedback</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../get-involved.html"> Get Involved</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../community.html"> Newsgroups</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../MPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://www.mozilla.org/newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../docs/"><B> Developer Docs</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../projects/"> Projects</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../ports/"> Ports</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../hacking/"> Hacking</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../source.html"> Get the Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../build/"> Build It</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../quality/"><B> Testing</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../binaries.html"> Download</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../bugs/"> Bugzilla</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="../quality/bug-writing-guidelines.html"> Bug Writing</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../tools.html"><B> Tools</B></A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://lxr.mozilla.org/seamonkey/"> View Source</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey"> Tree Status</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://cvs-mirror.mozilla.org/webtools/bonsai/cvsquery.cgi?treeid=default&amp;module=SeaMonkeyAll&amp;branch=HEAD&amp;branchtype=match&amp;dir=&amp;file=&amp;filetype=match&amp;who=&amp;whotype=match&amp;sortby=Date&amp;hours=2&amp;date=day&amp;mindate=&amp;maxdate=&amp;cvsroot=%2Fcvsroot"> New Checkins</A></TD></TR>
<TR><TD></TD><TD NOWRAP><A HREF="http://bugzilla.mozilla.org/"> Submit A Bug</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=3 - 1><B></B></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="../faq.html"><B> FAQ</B></A></TD></TR>
<TR><TD NOWRAP COLSPAN=2><A HREF="http://www.mozilla.org/search.html"><B> Search</B></A></TD></TR>
</TABLE>
</TD></TR></TABLE>
</TD></TR></TABLE>
</TD>


<TD VALIGN="TOP">




   
   
   
<!-- created by rhp -->



<center><b><font color="#000000"><font size=+2>Mail Composition "Back End"</font></font></b>
<br><b><font color="#000000">by Richard H. Pizzarro &lt;<a href="mailto:rhp@netscape.com">rhp@netscape.com</a>></font></b></center>
<b><font color="#000000"><font size=+2>Contents</font></font></b>
<ul>
<li>
<a href="#OVER">Overview</a></li>

<li>
<a href="#SENDING">Sending Messages</a></li>

<ul>
<li>
<a href="#SENDING">nsIMsgSend</a></li>
</ul>

<li>
<a href="#LISTENER">Sending Listener Interfaces</a></li>

<ul>
<li>
<a href="#NSIMSGSENDLISTENER">nsIMsgSendListener</a></li>

<li>
<a href="#NSIMSGCOPYSERVICELISTENER">nsIMsgCopyServiceListener</a></li>
</ul>

<li>
<a href="#API">Copy Operations</a></li>

<ul>
<li>
<a href="#COPYSENT">Copy to Sent Folder</a></li>

<li>
<a href="#DRAFTS">Drafts</a></li>

<li>
<a href="#TEMPLATES">Templates</a></li>

<li>
<a href="#TEMPLATES">"Send Later"</a></li>
</ul>

<li>
<a href="#SENDUNSENT">Sending Unsent Messages</a></li>

<li>
<a href="#SENDUNSENTLISTENER">Sending Unsent Messages Listener</a></li>

<li>
<a href="#QUOTING">Quoting</a></li>

<li>
<a href="#SAMPLES">Sample Programs</a></li>
</ul>
<a NAME="OVER"></a><b><font color="#000000"><font size=+2>Overview</font></font></b>
<br><font color="#000000">I've done considerable work in the past few weeks
reorganizing the Mail Composition back end, so I thought it would be helpful
to put together a small doc on the new interfaces and how one can use them.
The Mail Composition back end is responsible for the assembly and creation
of RFC822 messages to be delivered either via SMTP or NNTP services. You
also have the ability to save RFC822 files to disk, should you need this
data for some reason. Included in this functionality is the code to copy
the messages to the appropriate locations after delivery (i.e. a "Sent"
folder) as well as the ability to store messages for features like "Drafts"
and "Templates". Several (but not all) of these interfaces are specified
in IDL. This will change in the coming weeks and allow for developers to
write JavaScript to take advantage of the back end services. Also, I will
talk about some features though they may not be complete as of yet. I will
try to make comments for these exceptions.</font>
<p><a NAME="SENDING"></a><b><font color="#000000"><font size=+2>Sending
Messages</font></font></b>
<br>The primary responsibility of the back end is for the creation and
sending of RFC822 messages. The interface that accomplishes this task is
the <b>nsIMsgSend </b>interface. The feedback mechanism is provided by
a <b>nsIMsgSendListener</b> which is implemented by the caller. The caller
has the ability to add or remove listener interfaces to the <b>nsIMsgSend</b>
object and the interface can support multiple listeners. (For detailed
information on the listener interfaces, see the <a href="#LISTENER">Listener
Interfaces</a> section of this document)
<p><a NAME="NSIMSGSEND"></a><b><font color="#000000"><font size=+1>nsIMsgSend</font></font></b>
<br>The following describes the methods of the <b>nsIMsgSend</b> interface.
All of these methods are asynchronous operations.
<p>The <b>CreateAndSendMessage </b>method will create an RFC822 message
and send it all in one operation as well as providing the ability to save
disk files for later use. The mode of delivery can also be specified for
the "Send Later", "Drafts" and "Templates" operations. <font color="#FF0000">(NOTE:
This method could easily be broken in to a few different calls. Currently,
this method does several functions depending on the arguments passed in,
but this could easily lead to confusion. This is something that very well
may change as time allows).</font>
<p><tt><font color="#FF0000">&nbsp;</font><font color="#000099"> NS_IMETHOD
<b>CreateAndSendMessage</b>(</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIEditorShell&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*aEditor,</font></tt>
<br><font color="#CC0000">- the editor object for the mail compose operation.
If this is not null, the body will be extracted from this object and any
embedded objects or links will be sent as part of the message in MHTML</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIMsgIdentity&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*aUserIdentity,</font></tt>
<br><font color="#CC0000">- the user identity for the person doing the
send operation. This will be needed to determine the appropriate folder
for copy operations.</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIMsgCompFields&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*fields,</font></tt>
<br><font color="#CC0000">- the message composition fields. This will contain
all of the relevant header information for message creation</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRBool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
digest_p,</font></tt>
<br><font color="#CC0000">- this is a flag that says that most of the documents
we are attaching are themselves messages, and so we should generate a multipart/digest
container instead of multipart/mixed.&nbsp; (It's a minor difference.)</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRBool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
dont_deliver_p,</font></tt>
<br><font color="#CC0000">- If "dont_deliver_p" is false, then we actually
deliver the message to the SMTP and/or NNTP server</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsMsgDeliverMode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
mode,</font></tt>
<br><font color="#CC0000">- mode is the delivery mode. This can be set
for the various modes of delivery. These can include nsMsgDeliverNow, nsMsgQueueForLater,
nsMsgSave, nsMsgSaveAs, nsMsgSaveAsDraft, nsMsgSaveAsTemplate.</font>
<br><font color="#CC0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

</font><tt><font color="#000099">nsIMessage&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*msgToReplace,</font></tt>
<br><font color="#CC0000">- if the delivery mode is set to nsMsgSaveAsDraft,
this is a pointer to the the nsIMessage object for the message that needs
to be replaced</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*attachment1_type,</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*attachment1_body,</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRUint32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
attachment1_body_length,</font></tt>
<br><font color="#CC0000">- the full text of the first attachment is provided
via `attachment1_type' `attachment1_body' and `attachment1_body_length'.&nbsp;
These may all be 0 if all attachments are provided externally.</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const struct nsMsgAttachmentData&nbsp; *attachments,</font></tt>
<br><font color="#CC0000">- Subsequent attachments are provided as URLs
to load, described in the nsMsgAttachmentData structures.</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const struct nsMsgAttachedFile&nbsp;&nbsp;&nbsp; *preloaded_attachments,</font></tt>
<br><font color="#CC0000">- attachments that are already locally stored
on disk (note: both attachments and preloaded_attachments cannot be specified
on a single call</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*relatedPart /* nsMsgSendPart&nbsp; */,</font></tt>
<br><font color="#CC0000">- a related part for multipart related operations</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIMsgSendListener&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
**aListenerArray) = 0;</font></tt>
<br><font color="#CC0000">- an array of listeners for the send operation.
this can be nsnull if you want to do the delivery operation "blind"</font>
<br>&nbsp;
<p>The <b>SendMessageFile </b>method will let the caller send a message
that has been created by another process (Note: CreateAndSendMessage can
accomplish this task).
<p><tt><font color="#000099">&nbsp; NS_IMETHOD&nbsp; <b>SendMessageFile</b>(</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIMsgIdentity&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*aUserIdentity,</font></tt>
<br><font color="#CC0000">- the user identity for the person doing the
send operation. This will be needed to determine the appropriate folder
for copy operations.</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIMsgCompFields&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*fields,</font></tt>
<br><font color="#CC0000">- the message composition fields. This will contain
all of the relevant header information for message delivery</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsFileSpec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*sendFileSpec,</font></tt>
<br><font color="#CC0000">- the file spec for the message being sent</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRBool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
deleteSendFileOnCompletion,</font></tt>
<br><font color="#CC0000">- tell the back end if it should delete the file
upon successful completion</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRBool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
digest_p,</font></tt>
<br><font color="#CC0000">- this is a flag that says that most of the documents
we are attaching are themselves messages, and so we should generate a multipart/digest
container instead of multipart/mixed.&nbsp; (It's a minor difference.)</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsMsgDeliverMode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
mode,</font></tt>
<br><font color="#CC0000">- mode is the delivery mode. This can be set
for the various modes of delivery. These can include nsMsgDeliverNow, nsMsgQueueForLater,
nsMsgSave, nsMsgSaveAs, nsMsgSaveAsDraft, nsMsgSaveAsTemplate.</font>
<br><font color="#CC0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

</font><tt><font color="#000099">nsIMessage&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*msgToReplace,</font></tt>
<br><font color="#CC0000">- if the delivery mode is set to nsMsgSaveAsDraft,
this is a pointer to the the nsIMessage object for the message that needs
to be replaced</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIMsgSendListener&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
**aListenerArray) = 0;</font></tt>
<br><font color="#CC0000">- an array of listeners for the send operation.
this can be nsnull if you want to do the delivery operation "blind"</font>
<p>The <b>SendWebPage </b>method is a convenience function that will let
the caller send a web page by specifying a URI. NOTE: This can be any valid
URI so one can send local disk files by specifying a <b>file://</b> URI.
<p><tt><font color="#000099">&nbsp; NS_IMETHOD&nbsp; <b>SendWebPage</b>(</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIMsgIdentity&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*aUserIdentity,</font></tt>
<br><font color="#CC0000">- the user identity for the person doing the
send operation. This will be needed to determine the appropriate folder
for copy operations.</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIMsgCompFields&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*fields,</font></tt>
<br><font color="#CC0000">- the message composition fields. This will contain
all of the relevant header information for message delivery</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIURI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*url,</font></tt>
<br><font color="#CC0000">- the URI of the message composition fields.
This will contain all of the relevant header information for message delivery</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsMsgDeliverMode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
mode,</font></tt>
<br><font color="#CC0000">- mode is the delivery mode. This can be set
for the various modes of delivery (i.e. send later, drafts, templates or
send the message now)</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIMsgSendListener&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
**aListenerArray) = 0;</font></tt>
<br><font color="#CC0000">- an array of listeners for the send operation.
this can be nsnull if you want to do the delivery operation "blind"</font>
<p>The <b>AddListener/RemoveListener </b>methods let the caller add and
remove listeners to the sending interface.
<p><tt><font color="#000099">&nbsp; NS_IMETHOD&nbsp; <b>AddListener</b>(nsIMsgSendListener
*aListener) = 0;</font></tt>
<br><tt><font color="#000099">&nbsp; NS_IMETHOD&nbsp; <b>RemoveListener</b>(nsIMsgSendListener
*aListener) = 0;</font></tt>
<br>&nbsp;
<p><a NAME="LISTENER"></a><b><font color="#000000"><font size=+2>Sending
Listener Interfaces</font></font></b>
<br>The <b>nsIMsgSendListener </b>interface will let a caller keep track
of the progress and any status of a send operation. These are critical
for message delivery since message sending is asynchronous. It is the only
way to determine if the operation was successful or not. An important item
to note is the fact that this interface should also implement the <b>nsIMsgCopyServiceListener</b>
interface if it wants to be notified of the progress and completion of
the copy operation.
<p><a NAME="NSIMSGSENDLISTENER"></a><b><font color="#000000"><font size=+1>nsIMsgSendListener</font></font></b>
<br>The following describes the methods of the <b>nsIMsgSendListener</b>
interface:
<p>The <b>OnStartSending</b> interface is called when the sending operation
has begun. This is called after messages creation has completed. If message
creation fails, the nsIMsgSend operation will return an NS_FAILED() return
code.
<p><tt><font color="#000099">&nbsp;NS_IMETHOD <b>OnStartSending</b>(const
char *aMsgID,</font></tt>
<br><font color="#CC0000">- the message ID for the message being sent</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRUint32 aMsgSize) = 0;</font></tt>
<br><font color="#CC0000">- the total message size for the message being
sent</font>
<p>The <b>OnProgress</b> interface is called with progress notification
on the send operation.
<p><tt><font color="#000099">&nbsp;NS_IMETHOD <b>OnProgress</b>(const char
*aMsgID,</font></tt>
<br><font color="#CC0000">- the message ID for the message being sent</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRUint32 aProgress,</font></tt>
<br><font color="#CC0000">- the progress so far</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRUint32 aProgressMax) = 0;</font></tt>
<br><font color="#CC0000">- the maximum progress (aProgress should be used
as a numerator and aProgressMax as a denominator for a message sent percentage)</font>
<p>The <b>OnStatus</b> gives the listener status updates for the current
operation.
<p><tt><font color="#000099">&nbsp; NS_IMETHOD <b>OnStatus</b>(const char
*aMsgID,</font></tt>
<br><font color="#CC0000">- the message ID for the message being sent</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const PRUnichar *aMsg) = 0;</font></tt>
<br><font color="#CC0000">- a message concerning the status of the send
operation</font>
<p>The <b>OnStopSending </b>interface is called when the sending operation
has completed. This will be called in the case of both success and failure.
<p><tt><font color="#000099">&nbsp; NS_IMETHOD <b>OnStopSending</b>(const
char *aMsgID,</font></tt>
<br><font color="#CC0000">- the message ID for the message being sent</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsresult aStatus,</font></tt>
<br><font color="#CC0000">- the resulting status for the send operation</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const PRUnichar *aMsg,</font></tt>
<br><font color="#CC0000">- a message concerning the status of the send
operation</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIFileSpec *returnFileSpec) = 0;</font></tt>
<br><font color="#CC0000">- an nsIFileSpec which will specify the file
that was created (this is used if the </font><tt><font color="#000099">dont_deliver_p
</font></tt><font color="#CC0000">argument
is set to PR_TRUE)</font>
<p><a NAME="NSIMSGCOPYSERVICELISTENER"></a><b><font color="#000000"><font size=+1>nsIMsgCopyServiceListener</font></font></b>
<br>The <b>nsIMsgCopyServiceListener</b> interface will notify the implementor
or the progress and completion of the copy operation that follows successful
send operations.
<p>The <b>OnStartCopy </b>interface is called when the copy operation has
begun.
<p><tt><font color="#000099">&nbsp;NS_IMETHOD <b>OnStartCopy</b>(</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsISupports *listenerData) = 0;</font></tt>
<br><font color="#CC0000">- the nsISupports pointer passed in to the original
copy operation</font>
<p>The <b>OnProgress</b> interface is called with progress notification
for the copy operation.
<p><tt><font color="#000099">&nbsp;NS_IMETHOD <b>OnProgress</b>(</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRUint32 aProgress,</font></tt>
<br><font color="#CC0000">- the progress so far</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRUint32 aProgressMax) = 0;</font></tt>
<br><font color="#CC0000">- the maximum progress (aProgress should be used
as a numerator and aProgressMax as a denominator for a message sent percentage)</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsISupports *listenerData) = 0;</font></tt>
<br><font color="#CC0000">- the nsISupports pointer passed in to the original
copy operation</font>
<p>The <b>OnStopCopy </b>interface is called when the copy operation has
completed. This will be called in the case of both success and failure.
<p><tt><font color="#000099">&nbsp; NS_IMETHOD <b>OnStopCopy</b>(</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsresult aStatus,</font></tt>
<br><font color="#CC0000">- the resulting status for the send operation</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsISupports *listenerData) = 0;</font></tt>
<br><font color="#CC0000">- the nsISupports pointer passed in to the original
copy operation</font>
<p><a NAME="COPY"></a><b><font color="#000000"><font size=+2>Copy Operations</font></font></b>
<br>There are various copy operations that can result as a part of message
creation and delivery. These are all controlled by the caller in various
way. The following details the specific copy operations that can occur
in a message send call.
<p><a NAME="COPYSENT"></a><b><font color="#000000"><font size=+2>Copy to
Sent Folder</font></font></b>
<br>Copying to the "Sent" folder is controlled by a setting in the <tt><font color="#000099">nsIMsgCompFields</font></tt>
interface. The SetFcc() and GetFcc() methods are used by the caller to
control if a message should be copied to the defined "Sent" folder if the
sending operation was successful. Currently, this pref is a "char *" which
is the specific name of the folder, but this will more than likely change
to a PRBool (boolean) preference. The determiniation of which folder is
the "Sent" folder for the user is done by a call to <b>GetFoldersWithFlag()</b>
and the message store will control this user defined preference. If the
setting for GetFcc() is set to true, the copy operation is automatically
performed after a successful send operation.
<p><a NAME="DRAFTS"></a><b><font color="#000000"><font size=+2>Drafts</font></font></b>
<br>Saving a message as a draft is controlled by the "<tt><font color="#000099">nsMsgDeliverMode&nbsp;
mode" </font></tt>argument of the <b>CreateAndSendMessage </b>and <b>SendMessageFile
</b>methods.
If the caller passes in <font color="#CC0000">nsMsgSaveAsDraft,
</font>the
file created or passed in will be stored as a draft in the user specified
"Drafts" folder.
<p><a NAME="TEMPLATES"></a><b><font color="#000000"><font size=+2>Templates</font></font></b>
<br>Like Drafts, saving a message as a template is controlled by the "<tt><font color="#000099">nsMsgDeliverMode&nbsp;
mode" </font></tt>argument of the <b>CreateAndSendMessage </b>and <b>SendMessageFile
</b>methods.
If the caller passes in <font color="#CC0000">nsMsgSaveAsTemplate,
</font>the
file created or passed in will be stored as a draft in the user specified
"Templates" folder.
<p><a NAME="SENDLATER"></a><b><font color="#000000"><font size=+2>Send
Later</font></font></b>
<br>Developers also have the ability to do "Send Later" operations. This
will store messages in the user defined "Unsent Messages or Drafts" folder.
This simply does a save operation similar to Drafts and Templates. Send
Later operations are controlled by the "<tt><font color="#000099">nsMsgDeliverMode&nbsp;
mode" </font></tt>argument of the <b>CreateAndSendMessage </b>and <b>SendMessageFile
</b>methods.
If the caller passes in <font color="#CC0000">nsMsgQueueForLater</font>.
<p><a NAME="SENDUNSENT"></a><b><font color="#000000"><font size=+2>Sending
Unsent Messages</font></font></b>
<br>The back end has the ability to send all messages that are currently
stored in the user defined "Unsent Messages or Drafts" folder. (See <a href="#SENDLATER">Send
Later</a> above) The <b>nsIMsgSendLater </b>is the interface that allows
the caller to send all of the files previously stored. The caller will
implement an <b>nsIMsgSendLaterListener </b>interface to monitor the progress
of the send operations.
<p>The following describes the methods of the <b>nsIMsgSendLater</b> interface.
This method is performs the send operations asynchronously.
<p>The <b>SendUnsentMessages</b> method will send all queued messages.
<p><tt><font color="#000099">&nbsp; NS_IMETHOD&nbsp; <b>SendUnsentMessages</b>(nsIMsgIdentity&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*identity,</font></tt>
<br><font color="#CC0000">- the user identity for the person doing the
send operation. This will be needed to determine the appropriate folder
for copy operations.</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIMsgSendLaterListener&nbsp; **listenerArray) = 0;</font></tt>
<br><font color="#CC0000">- an array of listeners for the send operation.
this can be nsnull if you want to do the delivery operations "blind"</font>
<p>The <b>AddListener &amp; RemoveListener</b> methods will add and remove
listeners from the <b>nsIMsgSendLater </b>object.
<p><tt><font color="#000099">&nbsp; NS_IMETHOD&nbsp; <b>AddListener</b>(nsIMsgSendLaterListener
*aListener) = 0;</font></tt>
<br><tt><font color="#000099">&nbsp; NS_IMETHOD&nbsp; <b>RemoveListener</b>(nsIMsgSendLaterListener
*aListener) = 0;</font></tt>
<p><a NAME="SENDUNSENTLISTENER"></a><b><font color="#000000"><font size=+2>Sending
Unsent Messages Listener</font></font></b>
<br>The <b>nsIMsgSendLaterListener</b> interface will notify the implementor
of the progress and completion of the send later operations.
<p>The <b>OnStartSending </b>interface is called when the send later operation
has begun.
<p><tt><font color="#000099">&nbsp; NS_IMETHOD <b>OnStartSending</b>(</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRUint32 aTotalMessageCount) = 0;</font></tt>
<br><font color="#CC0000">- the total messages to be sent</font>
<p>The <b>OnProgress</b> interface is called with progress notification
of the send later operation.
<p><tt><font color="#000099">&nbsp; NS_IMETHOD <b>OnProgress</b>(</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRUint32 aCurrentMessage,</font></tt>
<br><font color="#CC0000">- the current message being sent</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRUint32 aTotalMessage) = 0;</font></tt>
<br><font color="#CC0000">- the total messages to be sent</font>
<p>The <b>OnStatus</b> gives the listener status updates for the current
operation.
<p><tt><font color="#000099">&nbsp; NS_IMETHOD <b>OnStatus</b>(</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const PRUnichar *aMsg) = 0;</font></tt>
<br><font color="#CC0000">- the progress so far</font>
<p>The <b>OnStopSending </b>interface is called when the send later operation
has completed.
<p><tt><font color="#000099">&nbsp; NS_IMETHOD <b>OnStopSending</b>(</font></tt>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsresult aStatus,</font></tt>
<br><font color="#CC0000">- the resulting status for the send operation</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const PRUnichar *aMsg,</font></tt>
<br><font color="#CC0000">- a status message</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRUint32 aTotalTried,</font></tt>
<br><font color="#CC0000">- the total messages that were attempted</font>
<br><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PRUint32 aSuccessful) = 0;</font></tt>
<br><font color="#CC0000">- the number of successful messages</font>
<p><a NAME="QUOTING"></a><b><font color="#000000"><font size=+2>Quoting</font></font></b>
<br>Quoting a mail message is made possible via the <b>nsIMsgQuote</b>
interface. It is a simple interface that takes a consumer output stream
for the quoted data. The message will be output in HTML form and it is
up to the caller to handle plain text conversion.
<p>The <b>QuoteMessage</b> method is the primary interface for message
quoting.
<p><tt><font color="#3333FF">&nbsp; NS_IMETHOD QuoteMessage(</font></tt>
<br><tt><font color="#3333FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
const PRUnichar *msgURI,</font></tt>
<br><font color="#CC0000">- the URI of the message to be quoted</font>
<br><tt><font color="#3333FF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nsIOutputStream *outStream) = 0;</font></tt>
<br><font color="#CC0000">- the consumer output stream for the quoted data</font>
<p><a NAME="SAMPLES"></a><b><font color="#000000"><font size=+2>Sample
Programs</font></font></b>
<br>The <a href="http://lxr.mozilla.org/mozilla/source/mailnews/compose/tests">mozilla/mailnews/compose/tests/</a>
directory contains sample test programs for all of the above described
interfaces.
<ul>
<li>
<a href="http://lxr.mozilla.org/mozilla/source/mailnews/compose/tests/compose/">compose</a>
- this program shows the use of the <b>CreateAndSendMessage</b> interface
(<b>CreateAndSendMessage</b>)</li>

<li>
<a href="http://lxr.mozilla.org/mozilla/source/mailnews/compose/tests/compose2/">compose2</a>
- this program shows the use of the <b>CreateAndSendMessage</b> interface
(<b>SendMessageFile</b>)</li>

<li>
<a href="http://lxr.mozilla.org/mozilla/source/mailnews/compose/tests/sendlater/">sendlater</a>
- this program shows the use of the <b>nsIMsgSendLater </b>interface</li>

<li>
<a href="http://lxr.mozilla.org/mozilla/source/mailnews/compose/tests/sendpage/">sendpage&nbsp;</a>
- this program shows the use of the <b>CreateAndSendMessage</b> interface
(<b>SendWebPage</b>)</li>
</ul>

<hr><font size=-1>

<!-- hhmts start -->
Last modified: Tue Sep 28 23:17:57 PDT 1999
<!-- hhmts end -->
<a href="mailto:rhp@netscape.com">rhp@netscape.com</a></address>




</TD>

</TR>
<TR>

<TD COLSPAN="2" ALIGN="RIGHT" VALIGN="TOP">
<FONT SIZE="-1">
Copyright &copy; 1998-2000 The Mozilla Organization.
<BR>
<A HREF="http://www.mozilla.org/webtools/bonsai/cvslog.cgi?file=mozilla-org/html/mailnews/compose-backend.html&amp;rev=&amp;root=/cvsroot/">Last modified September 29,  1999</A>.
</FONT>
</TD>
</TR>

</TABLE>
</BODY>
</HTML>
