<HTML>
<HEAD>
<TITLE>String Resources</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT=0 MARGINWIDTH=0>

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP ROWSPAN=2><IMG
SRC="../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH=600 HEIGHT=58 VSPACE=0 HSPACE=0></TD></TR></TABLE>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">

<TR>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>



<TD BGCOLOR="#DDDDDD" VALIGN=TOP COLSPAN=2><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>


<TR>

<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP COLSPAN=3>

<BR><TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../..//"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../mission.html"> Our Mission</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../about.html"> Who We Are</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../get-involved.html"> Getting Involved</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../community.html"> Community</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../advocacy.html"> Editorials</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../news.html"> What's New</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../newsbot/"> Newsbot</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../development.html"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../blue-sky/"> Blue Sky</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../projects.html"> Projects</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../status/"> Status</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../tools.html"> Tools</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../products.html"><B> Products</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../source.html"> Source Code</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../binaries.html"> Binaries</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../docs/"> Documentation</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../NPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../bugs/"> Bug Reports</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../quality/"> Quality</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../search.html"><B> Search</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../feedback.html"><B> Feedback</B></A></TD></TR>
</TABLE><BR>
</TD>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD VALIGN=TOP>
<P><BR>



<P ALIGN=CENTER><B><FONT SIZE="+3">string resources</FONT><BR>
by Erik van der Poel
&lt;<A HREF="mailto:erik@netscape.com">erik@netscape.com</A>&gt;<BR>
Last Modified: Apr. 26, '99</B></P>

<h3>Introduction</h3>

Many modules use human-readable strings that are normally translated into
other languages as part of the localization process.
However, the practice of "hardcoding" these strings inside your program code
<A HREF="http://www.mozilla.org/docs/refList/i18n/l12yGuidelines.html">
makes localization quite difficult</A>,
if not impossible. Therefore, you should store your
localizable text resources in separate files.
This document describes
the APIs used to obtain such strings from resource files. It also describes
the format of the resource files.

<p>This document does not discuss UI resource files. (See
<a href="http://www.mozilla.org/xpfe/dialogs.html">XUI Window Language</a>.)

<h3>API</h3>

First, you create an instance of the string bundle factory.
See <tt>mozilla/intl/strres/tests</tt> for some sample code.

<p>
Next, you get a bundle of strings using the following method (rewrite in
<a href="http://www.mozilla.org/scriptable/xpidl/">XPIDL</a>?):

<pre>
    class nsIStringBundleService : public nsISupports
    {
    public:
      NS_IMETHOD CreateBundle(nsIURL* aURL, nsILocale* aLocale,
                              nsIStringBundle** aResult) = 0;
    };
</pre>

<p>The URL argument can be local or remote (e.g. <tt>resource:</tt> or
<tt>http:</tt>).

<p>
See the
<a href="http://www.mozilla.org/projects/intl/locale-model.html">locale spec</a>
for details about nsILocale.
We will probably obtain the Accept-Language property from the locale object,
and use that to look up string resource files.
The precise fallback mechanism (to deal with the list of languages) still
needs to be designed.

<p>This is how you get individual strings from the bundle:

<pre>
    class nsIStringBundle : public nsISupports
    {
    public:
      NS_IMETHOD GetStringFromID(PRInt32 aID, nsString& aResult) = 0;
      NS_IMETHOD GetStringFromName(const nsString& aName,
                                   nsString& aResult) = 0;
    };
</pre>

<h3>String Resource File Format</h3>

We will use the Java property file format. Here is an example using string
IDs:

<pre>
    # arbitrary comment
    ## @loc a comment for the localizer (translator)
    ## @doc a comment by the documentation group
    cannotFindFile = Netscape is unable to find the file or directory named %s.
</pre>

<p>The ## stuff is similar to Java's /** (JavaDoc). All lines beginning with #
are removed by a tool to produce the final, compact deliverable.

<p>And here is the same example using integer IDs:

<pre>
    # arbitrary comment
    ## @name NAV_CANNOT_FIND_FILE
    ## @loc a comment for the localizer (translator)
    ## @doc a comment by the documentation group
    1234 = Netscape is unable to find the file or directory named %s.
</pre>

<p>The @name attribute can be used to generate #define's for
C/C++ programmers to use in their source code, for readability.

<p>Note that the order of subject, verb and object in a sentence depends
on the language, and that it is better to use numbered arguments if using
<a href="message-format.html">printf-style formatting</a>.

<p>The resource file must be in US-ASCII (all bytes less than 127). Non-ASCII
characters are represented as \uXXXX, where XXXX is a 4-digit hexadecimal
number in Unicode (UTF-16). Non-ASCII characters are only permitted on the
right hand side of the equals (=) sign.

<h3>File Naming Convention</h3>

<p>Java uses file names like awtLocalization_ja.properties. The extension
(.properties) is unchanged, since some may depend on this. So the language is
inserted before the extension, after an underscore (_). For US English property
files, please use names like foo_en.properties.

<p>Should we follow Java's lead? Or create subdirectories for languages? Should
there be any difference between http: and file: (or resource:) URLs?

<h3>Leveraging Old Translations</h3>

We are considering writing a tool to migrate some of the strings from the
old versions of the product. This tool would also generate some info that
a leveraging tool could use to reuse the translations of the old versions.
For example:

<pre>
    ## @oldid 1234
    cannotFindFile = Netscape is unable to find the file or directory named %s.
</pre>

<p>This would certainly work for all the strings in the old allxpstr.h. It
may even be possible to do this for the WINFE-specific XP_GetString strings
and the WINFE dialog strings. This needs to be investigated.

<p>This would also allow some modules to continue to use the old <tt>XP_GetString</tt>
in the short term, migrating to the new API in the long term.

<h3>String vs Integer IDs</h3>

<p>The benefits of integers IDs:

<ul>
<li>speed: array indexing is faster than hash tables</li>
<li>size: integers are smaller than readable strings</li>
</ul>

<p>The benefits of string IDs:

<ul>
<li>groupability: e.g. connect.refused, connect.timeout</li>
<li>insertability: can insert new string without changing IDs</li>
</ul>

<h3>Can We Get the Best of Both Worlds?</h3>

<p>It should be possible to write a tool that works with a file format that
gives us groupability and insertability, while retaining speed and
compactness in the code. For example:

<pre>
    connect.refused = Connection was refused
    connect.refused.id = 1234
    connect.timeout = Connection timed out
    connect.timeout.id = 5678
</pre>

<p>The human inserts new strings in the desired location, and a tool later
finds the next available integer ID, and inserts it (*.id). Then, another tool
generates the integer-ID based file for product delivery:

<pre>
    ...
    1234=Connection was refused
    ...
    5678=Connection timed out
</pre>

<p>The tool could also generate a header file for C/C++ programmers:

<pre>
    ...
    #define NET_CONNECT_REFUSED 1234L
    ...
    #define NET_CONNECT_TIMEOUT 5678L
</pre>

<p>Tools can be written in a ubiquitous language like Perl for local execution,
or maybe Web-based tools could be provided for remote execution (e.g. CGI).

<p>People that don't want to use or wait for such tools can do it manually.

<p>There are also some logistical problems with such tools. What if several
programmers are working on one file at the same time? Their tools might
generate the same integer ID for different strings. I am sure we could come up
with some system to manage such a process and avoid collisions, but do we want
to go there?

<p>Tools also add complexity. We may want to stick to simple text editors.

<h3>Questions</h3>

Do we really want to pass a URL as an argument? How does this mesh with
DCOM?

<p>Do we really want to return the bundle as an interface? If we ever decide
to use DCOM, that means that we need to go across the Net for individual
strings.

<p>What is the philosophy behind <tt>resource:</tt> URLs? Are they always
equivalent to <tt>file:</tt> URLs? Or are they sometimes remote resources?

<p>Do we need the concept of a "path"? Like Java's CLASSPATH, X Windows'
file search path, etc?

<p>What are the XUI folks planning to do? Will they use <tt>resource:</tt>
URLs, etc?

<p>Use XPCOM for the GetBundle API, but non-XPCOM for GetString API since
XPCOM is heavyweight?




<P><BR>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT>
</TD>


<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>


<TR>


<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM COLSPAN=2><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=BOTTOM COLSPAN=2><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>
</TR>

<TR>

<TD BGCOLOR="#000000" COLSPAN=6><BR></TD>

<TD BGCOLOR="#000000" VALIGN=TOP>

<FONT COLOR="#AAAAAA" SIZE="-1">
Copyright &copy; 1998 The Mozilla Organization.
</FONT>

</TD>

<TD BGCOLOR="#000000" COLSPAN=2><BR></TD>
</TR>

</TABLE>
<P>
</BODY>
</HTML>
