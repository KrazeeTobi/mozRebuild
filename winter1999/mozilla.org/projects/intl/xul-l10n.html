<HTML>
<HEAD>
<TITLE>XUL Localizability issues</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000"
LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000"
MARGINHEIGHT=0 MARGINWIDTH=0>

<MAP NAME="banner">
<AREA SHAPE=RECT COORDS="300,11,558,44" HREF="http://www.mozilla.org/">
</MAP>

<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR><TD BGCOLOR="#000000" VALIGN=TOP ROWSPAN=2><IMG
SRC="../../images/mozilla-banner.gif"
ALT="" BORDER=0 USEMAP="#banner"
WIDTH=600 HEIGHT=58 VSPACE=0 HSPACE=0></TD></TR></TABLE>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
<TR>


<TD BGCOLOR="#000000" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=TOP><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ROWSPAN=2>

<BR><TABLE CELLPADDING=0 CELLSPACING=3 BORDER=0>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../..//"><B> The Mozilla<BR>Organization</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../mission.html"> Our Mission</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../about.html"> Who We Are</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../get-involved.html"> Getting Involved</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../community.html"> Community</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../advocacy.html"> Editorials</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../news.html"> What's New</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../development.html"><B> Development</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../roadmap.html"> Roadmap</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../owners.html"> Module Owners</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../blue-sky/"> Blue Sky</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../projects.html"> Projects</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../status/"> Status</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../tools.html"> Tools</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../products.html"><B> Products</B></A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../source.html"> Source Code</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../binaries.html"> Binaries</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../docs/"> Documentation</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../NPL/"> License Terms</A></TD></TR>
<TR><TD></TD><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=18><A HREF="../../bugs/"> Bug Reports</A></TD></TR>
<TR><TD NOWRAP VALIGN=TOP COLSPAN=20><B></B></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../search.html"><B> Search</B></A></TD></TR>
<TR><TD VALIGN=TOP><IMG SRC="../../images/bullet1.gif" ALT="" WIDTH=8 HEIGHT=8 HSPACE=2 VSPACE=3></TD><TD NOWRAP COLSPAN=19><A HREF="../../feedback.html"><B> Feedback</B></A></TD></TR>
</TABLE><BR>

</TD>


<TD BGCOLOR="#DDDDDD" VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=TOP><IMG ALT=""
SRC="../../images/curve1.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=TOP ROWSPAN=2>
<P><BR>







<center>
<h1>
XUL Localizability issues</h1></center>

<center>by Tao Cheng&lt; <a href="mailto:tao@netscape.com">tao@netscape.com</a>
></center>

<h2>
Document History</h2>

<ul>
<li>02/26/99: Correct entity reference syntax.</li>
<li>02/19/99: Insert two XUL L12y solutions <a href="#pro4">""@.*;" + 
    property file"</a>, proposed by Daniel Matejka, and <a href="#pro5">
   "Using XLinks and XPointers for XUL Localisation"</a> by Daniel McGowan.
   </li>
<li>02/17/99: At last, a consensus of the solution for XUL localizability has been reached. The <a href="#pro1">"XUL + language-specific DTD"</a> is adopted.  </li>
<li>02/10/99: In solution #2, relax the rule that the content data must
    be a text attribute value; instead, treat content data as the element
    content. See the samples in solution #2.</li>
<li>02/09/99: Add explanation of the "default string" to solution #2.</li>
<li>02/08/99: Add "How to locate the language-specific file" section.</li>
<li>02/08/99: Take out all out-dated sections.</li>
<li>02/08/99: Re-evaluate solution #1 and #2 in the comparison table.</li>
<li>02/08/99: Revised solution #2 to reduce the number of IDs needed for
    resources identification. In the revised version, resources are uniquely 
    identified by the combination of widget ID and resource tag. 
    Java-property file format is also extended to support structuralized
    resources.</li>
<li>02/05/99: Revamp the "Candidates of the final solution" section and
    add a table of comparison.</li>
<li>02/05/99: Compile for final review; record more discussion.</li>
<li>01/29/99: Record more discussion.</li>

<li>01/28/99: Added two sections: "Ideas" and "Candidates of the final 
 solution".</li>

<li>01/28/99: Compiled feedback from Daniel Matejka.</li>

<li>
01/25/99: Feedback from Daniel Matejka in <font color="#FF0000"><i>red</i>.</font><font color="#000000"></li>

<li>
01/25/99: Post this document to newsgroup, 
news://news.mozilla.org/netscape.public.mozilla.xpfe,
for broader audience and discussion.</li>

<li>
01/25/99: Per Scott Collins, http://www.meer.net/ScottCollins/, not all
UI widgets can be described in XUL file. Q: does this mean we need another
mechanism to solve the non-XUL UI components?</li>

<li>
01/20/99: Add a new section, "How does the XUL concept work?"</li>

<li>
01/20/99: In the "XUL Localizability issues" held today, it's proposed
that</li>

<ul>
<p><li>
Get more up-to-date documents on XUL spec architecture so
that we can come up with a solution.</li>
<li>
Need get a workable sample XUL application so that we can identify the
problem better.</li>

<li>
Choose from option #1 and #2 to embed localization
information in XUL. Then combine the strength of option #3, String Resources,
option #4, gettext() as the underlying mechanism to retrieve text strings.
We may load the string resources from a locale suffixed property file and 
fall back to the default strings, as described in gettext(), when needed.</li>

<font color="#FF0000"><i>
<p>1 and 2 are mostly headaches for localization and build people, 
and I can't really speak for them.  But both numbers 3 and 4 demand extra 
implementation work.</i>
</i></font><font color="#000000">
</ul>

<p><li>
01/20/99: Incorporate Rob Thorne's comments and suggestions (in <font color="#3333FF">blue</font><font color="#000000">).</font></li>

<li>
01/19/99: Add reference to Erik's
 <a href="http://www.mozilla.org/projects/intl/string-resources.html">String
Resources</a> . We might be able to consolidate the idea presented there
with the gettext() scheme.</li>

<li>
01/16/99: First draft.</li>
</ul>

<h2>
Goals</h2>
This document serves the following purposes
<ul>
<li>
Identify the Internationalization and Localization requirements in the
Seamonkey project.</li>

<li>
Discuss the XUL Localizability issues in Seamonkey, 5.0.</li>

<li>
Record the proposed solutions, and their pros and cons.</li>

<li>
Keep track of the status of the related issues.</li>

<li>
Feature complete by first beta so it can be tested.</li>
</ul>

<h2>
Principles</h2>
Here are a list of principles the author intends to follow in seeking the
solution for this issue.

<ul>
<li>
<i>Simple</i>. Both core development and localization work will be easy
and less error prone. Win-win situation ;)</li>

<li>
<i>Leveragible</i>. Localization results shall be leveragible from release
to release. Localization costs money.</li>

<li>
<i>Consistent</i>. If possible, we shall seek a scheme that will work across
modules instead of within the XUL component only.</li>

<li>
<i>Portable</i>. The final solution will be achievable on all platforms
including Unix, Windows, Mac, and others.</li>

<li>
<i>Extensible</i>. The adopted solution will be flexible for customization
and future extension.</li>

<li>
<i>Dynamic binding</i>. Some of the items requiring translation may be 
 dynamic, usually because they require string composition 
 ("Installing item 5 of 10"). </li>

<li>
<i>Validatible</i>. Localizers/translators will be able to validate the
localization results.</li>

<li>
<font color="#3333FF"><i>Parseable</i>:&nbsp; It should be possible to
unambiguously and automatically determine which embedded items contain localizable
text, and what items need to be locked.</font></li>

<li>
<font color="#3333FF"><i>Invisible</i> (Internationalization). As much
as possible, the standard tools that create US UI should emit files that
already localizable, without requiring additional processing.</font></li>
</ul>


<h2>
Candidates of the final solution</h2>

<ol>
<p><b><li><a NAME="pro1">XUL + language-specific DTD. (adopted)</a></b>

  <p><i><b>Description:</b></i> 
  <ul>
     <li>Put all localizable resources in a language DTD file. Example of such
         resources are text strings, customizable icons, and URLs. Most of
         them can be described by <b>text/parsed entities</b>.</li>
     <li>Non locale sensitive resources shall not be in this DTD file.</li>
     <li>Use <b>SYSTEM</b> identifier to reference this DTD file.</li>
     <li>Need to implement locale sensitive file lookup for the language
         specific DTD file.</li>
     <li>Put format strings, such as "Item %d of %d", in text entities and
         compute the value in the application code such as MailCore or 
         BrowserCore.</li>
     <li>To dynamically switch languages, we need to reload the XUL and its 
         DTD (probably from a remote host). This is because once the DOM tree
         is created, the entities and DTDs have already been processed. 
   </ul>

  <p><i><b>Sample XUL: toolbar.xul</b></i> 
  <ol>
    <br>&lt;!DOCTYPE xui SYSTEM "toolbar.dtd">
	<br>
    <br>&lt;xul:toolbar>
    <ol>
         <br><b>&txtContentData;</b>
         <br>&lt;button cmd="nsCmd:BrowserBack"
                          style="background-color:rgb(192,192,192);">
         <ol>
             &lt;img src="resource:/res/toolbar/TB_Back.gif"/>
             <br><b>&txtBack;</b>
          </ol>
          &lt;/button>

          <br><br>&lt;button 
             cmd="nsCmd:BrowserForward" 
             style="background-color:rgb(192,192,192);">
         <ol>
              &lt;img src="resource:/res/toolbar/TB_Forward.gif"/>
             <br><b>&txtForward;</b>
          </ol>
          &lt;/button>

          <br><br>&lt;button 
             cmd="nsCmd:BrowserWizard" 
             style="background-color:rgb(192,192,192);">
         <ol>
              &lt;img src="<b>&iconWizard;</b>"/>
             <br><b>&txtWizard;</b>
          </ol>
          &lt;/button>
    </ol>
    <br>&lt;/xul:toolbar>

  </ol>

  <p><i><b>Sample DTD: toolbar.dtd</b></i> 
  <ol>
    <br>&lt;!ENTITY <b>txtContentData</b>    "Random content data">
    <br>&lt;!ENTITY <b>txtBack</b>    "Back to %s">
    <br>&lt;!ENTITY <b>txtForward</b> "Forward">
    <br>&lt;!ENTITY <b>iconWizard</b> "resource:/res/toolbar/TB_Wizard.gif">
    <br>&lt;!ENTITY <b>txtWizard</b>  "Wizard">
  </ol>

   <p><i><b>Pros:</b></i>
  <ul>
     <li>Already standard compliant; no new syntax names or tags need to be
         introduced.</li>
     <li>Only one minor tweak needed: escape "%" used in formatting string,
         such as "%d out of %d" for dynamic strings binding. For example,
         use a numeric character reference (NCR), '&#38;#37;' to escape
         '%'.</li>
     <li>Text replacement can be in either content or attribute values
         (but not in the attribute names).</li>     
   </ul>
   
   <p><i><b>Cons:</b></i>
  <ul>
     <li>The language-specific DTD file is not flat file. Need a DTD parser
         to extract localizable resources into a flat file for localizers.</li>
     <li>Two file formats to deal with: the property file and the DTD
         file.</li>
     <li>Hard to group text entity by UI component.</li>
     <li>We lose the information of text entities after parsing.</li>
     <li>In switching languages, we need to reload the XUL and its 
         DTD (probably from a remote host) and reconstruct the DOM tree. 
        <p>In the example of a dialog UI, if we used entities and DTDs, we
        would have to tear down the whole DOM tree and the dialog that sits
        on top of that, and then rebuild a new DOM tree and dialog. This
        would be wasteful, since our layout manager is able to resize
        elements dynamically, so we can "edit" the DOM tree and have the
        dialogs redraw themselves automatically.

        <p>However, we can live with this performance drag since the users
           might not switch language in runtime that often.
      </li>

   </ul>
</li>

<b><p><li><a NAME="pro2">Single XUL file with Java-like property file. 
         (ruled out due to technical difficulty)</a></b>

<p><i><b>Descriptions:</b></i>
<ul>
<li>Assign a <b>widgetID</b> to each widget in XUL file, and a 
    <b>resTag</b> to each localizable resource/attribute of a widget 
    in the widget code. 
    Then, call <b>gettext(widgetID, resTag, default_string)</b> to retrieve
    the resources from a Java-like property file in runtime. 
    For example, a label widget can be described as 
    &lt;label widgetID="345" text="label string"/> in a XUL file. Then, the 
    function call to retrieve localized text will be 
    gettext(345, RES_TEXT, "label string");</li>
<li>If the property file does not exist or the combination of widgetID and
    resTag does not resolve to a resource string, the default_string
    will be returned in instead.</li>
<li>All localizable resources must be stored in Java-like property file.</li>
<li>The resources replacement may happen as early as in parsing or
    as late as in widget initialization.</li>
<li>Reference to the property file will be declared as an external unparsed
    entity and stashed in the DOM tree for later use. See sample XUL 
    declaration below.</li>

</ul>

  <p><i><b>Sample XUL: toolbar.xul</b></i> 
  <ol>
    <br>&lt;!DOCTYPE xui SYSTEM "toolbar.dtd">
	<br>
    <br>&lt;!-- L10N-PTY type of data: file format can be found at
       http://www.netscape.com/PropertyFile -->
    <br>&lt;!NOTATION L10N-PTY SYSTEM "http://www.netscape.com/PropertyFile">

    <br><b>&lt;!ENTITY JFile 
		    SYSTEM "http://www.home.org/l10n.property" 
            NDATA L10N-PTY></b>

    <p>&lt;xul:toolbar>
    <ol>
         <br><b>&lt;label widgetID="8000">Random content data 
         &lt;label></b>
         <br>&lt;button widgetID="8001"
         <ol>
             cmd="nsCmd:BrowserBack"
             <br>style="background-color:rgb(192,192,192);"
             <br>img="resource:/res/toolbar/TB_Back.gif"><b>Back to &#38;#37;s</b>
          </ol>
          &lt;/button>

          <br><br>&lt;button widgetID="8002"
          <ol>
             cmd="nsCmd:BrowserForward" 
             <br>style="background-color:rgb(192,192,192);"
             <br>img="resource:/res/toolbar/TB_Forward.gif"><b>Forward</b>
          </ol>
          &lt;/button>

          <br><br>&lt;button widgetID="8003"
         <ol>
             cmd="nsCmd:BrowserWizard" 
             <br>style="background-color:rgb(192,192,192);"
             <br>img="resource:/res/toolbar/TB_Wizard.gif"><b>Wizard</b>
          </ol>
          &lt;/button>
       </ol>
      <br>&lt;/xul:toolbar>

     </ol>

  <p><i><b>Sample property file: property.toolbar</b></i> 
  <ol>
     <p>8000: Random content data
     <br>8001.img: resource:/res/toolbar/TB_Back.gif
     <br>8001: Back to &#38;#37;s
     <br>8002.img: resource:/res/toolbar/TB_Forward.gif
     <br>8002: Forward
     <br>8003.img: resource:/res/toolbar/TB_Wizard.gif
     <br>8003: Wizard
  </ol>

  <p><i><b>Sample resource tags definition</b></i> 
  <ol>
     <p> #define RES_TEXT  &nbsp;&nbsp;0x1234
     <br>#define RES_IMG   &nbsp;&nbsp;&nbsp;&nbsp;0x1235
  </ol>

  <p>To get the text string for a "Back" button's label, we call 
  <ol>
    <p>gettext(8001, RES_TEXT, "Back to &#38;#37;s")
  </ol>

<p><i><b>Pros</b></i>
<ul>
<li>All localizable resources are uniquely identified by the combination of 
    widgetID and the resource tags. The application/front end developers
    can easily update a UI element's attribute/resource.</li>
<li>Core development work will not be block by gettext() implementation. 
    However, we shall request the UI developers to put English string,
    localization notes, and comments in the property file.</li>
<li>The fallback mechanism allows the developers to work without the 
    presence of property files.</li>
<li>The English version of property file can be automatically generated 
    during XUL to DOM conversion.</li>
<li>Provide fallback mechanism to default strings.</li>
<li>The property file is flat and in clear text; easy to localize and 
    leverage.</li> 
<li>The implementation of nsStringBoundle interface is about to finish. The
    basic facilities of parsing the property file and retrieving text are
    ready to check in.</li>
<li>Consistent with the scheme in "String Resources"; only one file format
    to deal with.</li>
<li>Resources are grouped by widgets. This also makes the property file more
    readable.</li>
<li>Easy to leverage the property file. All resources are IDed and ready for
    comparision.</li>
</ul>

<p><i><b>Cons</b></i>
<ul>
<li>Need to treat content data as the text resource of a label widget. (So
    it can be identified and edited by application code.)
    </li>
<li>Need to implement a mechanism to automatically bind localizable resources
    to widgets. However, the amount of work can be reduced by performing
    the localized resources binding in widget initialization time since
    we need to bind the UI attributes in the DOM to the underlying widgets
    anyway.</li>
<li>Need to ensure the uniqueness of the widgetID. However, the appCore 
    developers need to have a way to uniquely identify a widget anyway.</li>
<li>Localizable resources strings are duplicated twice: one in XUL and the 
    other in property file.</li>
<li>Need to extend the Java-like property file to support structured 
    resources.</li>
<li><i><b>Technical difficulty:</b></i>once XUL has been converted to 
        DOM tree, the content can't be changed anymore.</li>
</ul>
</li>

<b><p><li><a NAME="pro3">Use text entities for content data and IDs for widget
   resources. (ruled out due to technical difficulty)</a></b>
  <p><i><b>Description:</b></i>
  With the marriage of #1 and #2, we can take the advantage of both
  worlds. The idea is to use text entities for content data to remedy the 
  awkwardness of the #2 approach in dealing with content data.

  <p><i><b>Pros:</b></i>
  <ul>
    <li>Reference to content data is XML standard compliant (general entity).
       </li>
    <li>All localizable resources are uniquely identified.</li>
    <li>UI developers will be able to specify widget resources directly in
       XUL. Extraction of localizable resources can be performed in client's
       build process. Localization is invisible to the UI developers.</li>
    <li>For UI that does not contain HTML data, we have only one file, the
       property file, to deal with.</li>
    <li>For those contain HTML data, we deal with them outside of XUL. This
       also helps us make the XUL file clean.</li>
  </ul>

  <p><i><b>Cons:</b></i>
  <ul>
    <li>Why not simply use the DTD approach?</li>
    <li><i><b>Technical difficulty:</b></i>once XUL has been converted to 
        DOM tree, the content can't be changed anymore.</li>
 </ul>
</li>

<p><b><li><a NAME="pro4">"@.*;" + property file</a></b>
  <p><i><b>Description:</b></i>
  Assuming the "timely access" problem can be overcome, we could get around 
  the "syntax constraint" problem by using an entity-like syntax of our own.
  That is, we invent something, say we use the "@" symbol like entities use
  the "&".  Then these things are used throughout the content just like 
  entities would have been used to do localization.
 
  This still assumes we have some way to get at the 
  language-specific-substitution text after parsing (so it can't be a parser
  directive; it may have to be some sort of special element that XUL will 
  recognize and not display). If all this worked, we'd be free to stick in 
  localizable text anywhere without constraining the element and attribute
  structure.  The above example 

  <p>&lt;element l10nID="100" text="english version"/> 

  <p>becomes 

  <p>&lt;element text="@100;"/> ( or &lt;element>@100;&lt;/element>, 
    if that's more appropriate for the widget). 

  <p>There just needs to be a single routine somewhere central that knows 
     where to find the table of localized text strings.  It finds "@.*;" 
     sequences and substitutes them.  We have to walk the content model 
     after parsing and hand every string to this routine, and widgets have
     to pass all their text strings through it before they do anything with
     them. 

 <p><i><b>Cons:</b></i>
  <ul>
  <li><b><i>The entity solution is more XML compliant and less work to implement.</i></b>
  </li>
  </ul>

</li>

<p><b><li><a NAME="pro5">Using XLinks and XPointers for XUL Localisation 
   (by Daniel McGowan) (ruled out due to technical difficulty)</a></b>

<p><b><u>Abstract:</u></b>
<br>Use XLink &amp; Xpointer to specifically referance text in a file that
is seperate from the base XUL file so that this text can be easily localised
and display this text to the end user in manner consistent with XPFE requirements.
<p><b><u>Pros:</u></b>
<br>Since it is all written in vanilla XML there is no need to create custom
file types and this system can accept anything the parser can handle. It
maintains the name value paring essential for localisation. It allows us
to add localisation and developer notes to the object (e.g. button) and
the localised text separately but maintain a direct link between the two.
The text is pulled into the UI elements when the XUL file is parsed. This
also addressed the goal of separating markup, style and content.
<br><b><u>Cons:</u></b>
<br>This does not leave us with a flat file solution. However the file
containing the text to be localised is of such a simple format that writing
a tool to parse it is a trivial exercise. We are going need some form of
tool to convert native encoding to unicode character references.
<br>There are 4 files to track! Actually the language specific DTD is complete
and valid as is so it could easily be declared inline in the language specific
XML file. The link-attributes has been entitised and could conceivably
be inherited from a higher level DTD.
<br><b><i>In reloading downloadble chrome, not all related files can be 
  blown away by the client.</i></b>
<p>Here is an example syntax needed for a button UI element.
<table BORDER WIDTH="795" >
<tr BGCOLOR="#FFFF99">
<td>
<center><b>UI.XUL</b></center>
</td>

<td>
<center><b>UI.DTD</b></center>
</td>
</tr>

<tr>
<td>
<br><tt>&lt;button <font color="#FF0000">href="&amp;locale/uilang.xml|id(1234).child(text)"</font>></tt>
<br><tt>&nbsp;&nbsp; &lt;content-info>Put comments on button</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
functionality here</tt>
<br><tt>&nbsp;&nbsp; &lt;/content-info></tt>
<p><tt>&nbsp; </tt><i>other xul markup</i>
<br><tt>&lt;/button></tt>
<p>&nbsp;</td>

<td><tt>&lt;!ENTITY&nbsp; % link-attributes</tt>
<br><tt>&nbsp; "<font color="#000000">xlink:form&nbsp;&nbsp;&nbsp;&nbsp;
CDATA&nbsp;&nbsp;&nbsp; #FIXED 'simple'</font></tt>
<br><tt>&nbsp;&nbsp; href&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CDATA&nbsp;&nbsp;&nbsp; #REQUIRED</tt>
<br><tt>&nbsp;&nbsp; content-info&nbsp;&nbsp; CDATA&nbsp;&nbsp;&nbsp; #IMPLIED</tt>
<br><tt>&nbsp;&nbsp; show&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CDATA&nbsp;&nbsp;&nbsp; #FIXED 'embed'</tt>
<br><tt>&nbsp;&nbsp; actuate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CDATA&nbsp;&nbsp;&nbsp; #FIXED 'auto'"</tt>
<br><tt>></tt>
<p><tt>&lt;!ELEMENT button (#PCDATA)></tt>
<br><tt>&lt;!ATTLIST button&nbsp;</tt>
<br><tt>&nbsp;&nbsp;&nbsp; %link-attributes;</tt>
<br><tt>&nbsp;&nbsp;&nbsp; </tt><i>other button specific attributes</i>
<br><tt>></tt>
<br>&nbsp;</td>
</tr>

<tr ALIGN=CENTER BGCOLOR="#FFFF99">
<td><b>UILANG.XML</b></td>

<td><b>UILANG.DTD</b></td>
</tr>

<tr>
<td><tt>&lt;loctext id = "1244"></tt>
<br><tt>&nbsp; &lt;text>Gallia est omnis divisa in partes tres,&nbsp;</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; quarum unam incolunt
Belgae, aliam Aquitani,&nbsp;</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tertiam qui ipsorum
lingua Celtae,&nbsp;</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nostra Galli appellantur.&nbsp;</tt>
<br><tt>&nbsp; &lt;/text></tt>
<br><tt>&nbsp; &lt;note>These are Ceasars first words on Gaul.</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This button soulld
be centered on&nbsp;</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; column 1 of the
dialog</tt>
<br><tt>&nbsp; &lt;/note></tt></td>

<td><tt>&lt;!ELEMENT loctext (text, note?)></tt>
<br><tt>&lt;!ATTLIST loctext id ID #REQUIRED></tt>
<br><tt>&lt;!ELEMENT text (#PCDATA)></tt>
<br><tt>&lt;!ELEMENT note (#PCDATA)></tt></td>
</tr>
</table>

<p>So, when<tt> &lt;button></tt> tag is parsed the "simple" xlink href
(which is #REQUIRED) is automatically (actuate = 'auto') embedded (show
= 'embed') with the text from the &lt;text> child element of the element
with id = 1234 in the file at URI location which is the value of &amp;locale(some
more globally set value)/UILANG.XML.
<p>OK so that is probably a bad explaination but I hope the code is clear
enough. If you have any questions don't hesitste to flame away.
<p>Daniel.

</li>

</ol>

<h2>Comparision (*****: excellent, *: show stopper)
</h2>

<table BORDER COLS=4 WIDTH="100%" NOSAVE >
<tr>
<td>Criteria to examine</td>

<td>XUL +&nbsp;Language-specific DTD</td>

<td>XUL + Language-specific property file</td>

<td>Description</td>
</tr>

<tr>
<td>Simple</td>

<td>*****</td>

<td>**** Need to define resources tags in widget code and widgetID in XUL 
    file.</td>

<td>Both core development and localization work shall be made  easy and 
    less error prone.</td>
</tr>

<tr>
<td>Leveragible</td>

<td>*** Need a parser to list, identify, and compare resources.</td>

<td>***** All resources are in property files which are flat and easier for
    leveraging.</td>

<td>Localization results shall be leveragible from release to release.</td>
</tr>

<tr>
<td>Consistent</td>

<td>*** Two file formats, DTD and property file, to deal with.</td>

<td>***** Only one file format, property file.</td>

<td>This scheme that will work across modules instead of within the XUL
component only.</td>
</tr>

<tr>
<td>Standard compliant</td>

<td>*****</td>

<td>**** (We can extend property file format to have similar syntax to
          X/MOTIF's application default file.)</td>

<td>Achievable on all platforms including Unix, Windows, Mac, and others.</td>
</tr>

<tr>
<td>Portable</td>

<td>*****</td>

<td>*****</td>

<td>Achievable on all platforms including Unix, Windows, Mac, and others.</td>
</tr>

<tr>
<td>Extensible</td>

<td>***** In the same direction as XML.</td>

<td>****  Need to treat content data as the text resource of a label widget.</td>

<td>The adopted solution will be flexible for customization and future
extension.&nbsp;</td>
</tr>

<tr>
<td>Dynamic binding</td>

<td>*** Resources binding mostly appens in XML parser.</td>

<td>***** Resources binding occurs at the last minute.</td>

<td>Some of the items requiring translation may be dynamic, usually because
they require string composition ("Installing item 5 of 10").</td>
</tr>

<tr>
<td>Validatible</td>

<td>*** (need a DTD parser)</td>

<td>***** (right on the scene)</td>

<td>Localizers/translators will be able to validate the localization
results.</td>
</tr>

<tr>
<td>Parsable</td>

<td>*** (DTD file contains XML tags, keywords, and others)</td>

<td>***** (localizable resources are easily identified)</td>

<td>It should be possible to unambiguously and automatically determine
    which embedded items contain localizable text, and what items need to be
    locked.</td>
</tr>

<tr>
<td>Invisible (Internationalization)</td>

<td>*** (entity defined in external DTD)</td>

<td>**** (developers need to assign an id to each resource; but the generation
          of the US/EN property file could be done by the XUL parser.)</td>

<td>As much as possible, the standard tools that create US UI should emit
    files that already localizable, without requiring additional 
    processing.</td>
</tr>

<tr>
<td>Identifiable</td>
<td>**** (entity names are unique; but we lose them after parsing.)</td>
<td>**** (all resources are identified by the combination of widgetID and
          resTag; but we must treat content data as the text resource of a
          label widget) </td>
<td>All resources shall be uniquely identifiable</td>

<tr>
<td>Dynamic Language Switching</td>
<td>*** Need to reload the XUL</td>
<td>**** We can design it to modify localizable attributes only.</td>
<td>Dynamically switch to different language and reflect it to UI. 
    (this does not happen quite often.)</td>
</tr>

</table>

<p>

<h2>How to locate the language-specific file</h2>

In general, we need two information to locate the language-specific file:
<ol>
<li>The reference to the location of the Java property files declared in the
    unparsed entities as described in the solution #2.</li>
<li>The locale information in the client.</li>
</ol> 

<p>For example, if we declare the entity as

<ol>
        <p>&lt;!ENTITY JFile SYSTEM "http://www.home.org/l10n-property.xxx" 
         NDATA L10N-PTY> 
</ol>

<p>And, the current locale is "ja". Then, our real URI is

<ol>
   "http://www.home.org/l10n-property<b>_ja</b>.xxx"
   <br>or
   <br>"http://www.home.org/<b>ja/</b>l10n-property.xxx"
</ol>

<p>The real location of the language-specific DTD file can be determined in a
similar fashion.


<h2>
References</h2>

<ul>
<p><li>
&nbsp;<a href="http://www.mozilla.org/xpfe/languageSpec.html">XUI Language
Spec</a> .</li>

<p><li>
&nbsp;<a href="http://www.mozilla.org/xpfe/aom/AOM.html#xul_intro">XPToolkit
Architecture</a> .</li>

<p><li>
&nbsp;<a href="http://www.mozilla.org/projects/intl/string-resources.html">String
resources</a></li>

</ul>





<P><BR>
</TD>


<TD VALIGN=TOP ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve3.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=TOP><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

</TR>
<TR>


<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#DDDDDD" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD VALIGN=BOTTOM><IMG ALT=""
SRC="../../images/curve2.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>


<TD VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/curve4.gif"
WIDTH=16 HEIGHT=16 HSPACE=0 VSPACE=0></TD>

<TD BGCOLOR="#000000" VALIGN=BOTTOM ALIGN=RIGHT><IMG ALT=""
SRC="../../images/bit.gif"
WIDTH=4 HEIGHT=16 HSPACE=0 VSPACE=0></TD>
</TR>

<TR>

<TD BGCOLOR="#000000" COLSPAN=6><BR></TD>

<TD BGCOLOR="#000000" VALIGN=TOP>

<FONT COLOR="#AAAAAA" SIZE="-1">
Copyright &copy; 1998 The Mozilla Organization.
</FONT>

</TD>

<TD BGCOLOR="#000000" COLSPAN=2><BR></TD>
</TR>

</TABLE>
<P>
</BODY>
</HTML>
